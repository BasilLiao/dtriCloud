<style>
	/*Table 寬度滾動*/
	#other_c .table-responsive {
		display: block;
		width: 100%;
		overflow-x: auto;
	}

	/*Table 自動隱藏*/
	#other_c .table-responsive th,
	#other_c .table-responsive td {
		text-overflow: ellipsis;
		white-space: nowrap;
		overflow: hidden;
	}

	/*Table 表格固定*/
	#other_c .fixedC1 {
		left: 0px;
		position: sticky;
	}

	#other_c .fixedCt {
		position: sticky;
		top: 0px;
		z-index: 5;
	}

	/*Table 每隔表格內_框線*/
	#other_c .table-bordered td,
	#other_c .table-bordered th {
		border: 1px solid #1b76fd;
		padding: 2px;
	}

	/*Table 表格外框線*/
	#other_c table {
		max-height: calc(100vh - 520px);
		min-height: 200px;
		border-collapse: separate;
		border-spacing: 0px;
	}

	/*Table 表格內 背景色*/
	#other_c .table-white {
		--bs-table-bg: #fff;
	}

	/*Table 滑鼠-覆寫換色*/
	.table-hover>tbody>tr:hover>* {
		--bs-table-accent-bg: #0d6efd40;
		color: var(--bs-table-hover-color);
	}

	/*標題色彩*/
	.bg_def {
		background-color: #cfe2ff;
	}

	/*標題色彩*/
	.bg-yellow {
		background-color: var(--bs-yellow);
	}

	/*標題色彩*/
	.bg-orange {
		background-color: var(--bs-orange);
	}

	.bg-teal {
		background-color: var(--bs-teal);
	}

	/*禁止使用*/
	.dontUse {
		pointer-events: none;
		opacity: 0.5;
	}

	/*直立式呈現邊字*/
	#other_c .wlr {
		writing-mode: vertical-lr;
		width: 20px;
	}

	/*checkbox_24*/
	#other_c .checkbox_24 {
		width: 24px;
		height: 24px;
	}

	#other_c .checkbox_20 {
		width: 20px;
		height: 20px;
	}

	#other_c .checkbox_16 {
		width: 16px;
		height: 16px;
	}

	/*指定標題色彩*/
	#other_Detail_BPM_open,
	#other_Detail_BPR_open .otherTitle {
		color: white;
	}

	/*鎖定*/
	.locked-do {
		pointer-events: none;
	}
</style>
<div id="other_c" class="row p-0 m-0">
	<!-- 查詢面板 -->
	<div id="other_c_item" class="col-12 p-1">
		<div class="col-12 p-0 m-0 lh-1 text-start rounded-top bg-success text-white">
			<i class="btn btn-outline-white p-0 pr-1 pl-1 bi bi-dash-square" data-bs-toggle="collapse"
				data-bs-target="#other_c_item_open" aria-expanded="false" style="width: 22px; height: 24px;"></i>
		</div>
		<div id="other_c_item_open" class="row m-0 collapse show">
			<b class="p-0 m-0 lh-1 wlr bg-success text-white"> Search </b>
			<div id="otherItemItem" class="col border border-primary  row m-0 p-0 shadow-sm">
				<div class="col-6 otherTextEx col-md-1 p-1 d-none">
					<div class=" border border-secondary rounded">
						<div class="otherTitle  fw-bolder rounded-top">Search1</div>
						<div class="p-1">
							<input class="col-12 m-0 p-1 border border-dark form-control" type=text id="oex_id"
								name="oex_name" placeholder="Ex:123" autofocus>
						</div>
					</div>
				</div>
				<div class="col-6 otherSelectEx col-md-1 p-1 d-none">
					<div class=" border border-secondary rounded">
						<div class="otherTitle  fw-bolder rounded-top">Search2</div>
						<div class="p-1">
							<select class="col-12 m-0 p-1 border border-dark form-select" id="oex_id2" name="oex_name2">
								<option class="selectEx" value="" selected="selected">select(請選擇)</option>
							</select>
						</div>
					</div>
				</div>
				<!--BBI(料BOM)-->
				<div id="BBI" class="col-12 col-lg-4 p-0 row m-0 collapse other_BBI_open">
				</div>
				<!--BPR(BOM規則)-->
				<div id="BPR" class="col-12 col-lg-4 p-0 row m-0 collapse other_BPR_open">
				</div>
				<!--BPM(BOM規格)-->
				<div id="BPM" class="col-12 col-lg-4 p-0 row m-0 collapse show other_BPM_open">
				</div>
			</div>
		</div>
	</div>
	<!-- 控制面板 -->
	<div id="other_c_controller" class="col-12 p-1 ">
		<div class="col-12 p-0 m-0 lh-1 text-start rounded-top bg-primary text-white">
			<i class="btn btn-outline-white p-0 pr-1 pl-1 bi bi-dash-square" data-bs-toggle="collapse"
				data-bs-target="#other_c_controller_open" aria-expanded="false" style="width: 22px; height: 24px;"></i>
		</div>
		<div id="other_c_controller_open" class="row m-0 collapse show">
			<b class="p-0 m-0 lh-1 wlr bg-primary text-white"> Console </b>
			<div class="col border border-primary row m-0 p-0 shadow-sm justify-content-between">
				<!--BBI(同步-BOM成品組成)-->
				<div class="col-12 col-lg-2 p-1 collapse other_BBI_open">
					<div class="border border-secondary rounded">
						<div class="bg-info fw-bolder rounded-top">ERP BOM</div>
						<div class="row m-0">
							<button id="btn_bbi_rules" type="button"
								class="lh-1 col p-1 m-1  btn btn-sm btn-outline-warning">
								<b>ERP BOM<br>to Rules
								</b>
							</button>
							<button id="btn_bbi_format" type="button"
								class="lh-1 col p-1 m-1  btn btn-sm btn-outline-success">
								<b>ERP BOM<br>to Format
								</b>
							</button>
						</div>
					</div>
				</div>
				<!--BPR(BOM產品規則)-->
				<div class="col-12 col-lg-4 p-1 collapse other_Detail_BPR_open">
					<div class="border border-secondary rounded">
						<div class="bg-yellow fw-bolder rounded-top">Rules BOM</div>
						<div class="row m-0">
							<button id="btn_bpr_detail" type="button"
								class="lh-1 col p-1 m-1 btn btn-sm btn-outline-warning">
								<b>Rules<br>Modify
								</b>
							</button>
							<button id="btn_bpr_back" type="button"
								class="lh-1 col p-1 m-1 btn btn-sm btn-outline-primary">
								<b>Rules<br>Update
								</b>
							</button>
							<button id="btn_bpr_save" type="button"
								class="lh-1 col p-1 m-1  btn btn-sm btn-outline-success">
								<b>Rules<br>Save(AC/AU/DD)
								</b>
							</button>
							<button id="btn_bpr_generate" type="button"
								class="lh-1 col p-1 m-1  btn btn-sm btn-outline-dark">
								<b>Rules<br>generate
								</b>
							</button>
						</div>
					</div>
				</div>
				<!--BPM(BOM產品管理)-->
				<div class="col-12 col-lg-4 p-1 collapse show other_Detail_BPM_open">
					<div class="border border-secondary rounded">
						<div class="bg-teal fw-bolder rounded-top">Format BOM</div>
						<div class="row m-0">
							<button id="btn_bpm_detail" type="button"
								class="lh-1 col p-1 m-1 btn btn-sm btn-outline-warning">
								<b>Format<br>Modify
								</b>
							</button>
							<button id="btn_bpm_back" type="button"
								class="lh-1 col p-1 m-1 btn btn-sm btn-outline-primary">
								<b>Format<br>Update
								</b>
							</button>
							<button id="btn_bpm_save" type="button"
								class="lh-1 col p-1 m-1 btn btn-sm btn-outline-success">
								<b>Format<br>Save(AC/AU/DD)
								</b>
							</button>
							<button id="btn_bpm_excel" type="button"
								class="lh-1 col p-1 m-1 btn btn-sm btn-outline-dark">
								<b>Export<br>Excel
								</b>
							</button>
						</div>
					</div>
				</div>
				<div class="col-6 col-lg-2 p-1">
					<div class=" border border-secondary rounded">
						<div class="bg_def fw-bolder rounded-top">Search</div>
						<div class="row m-0">
							<div class="lh-1 col p-1 m-1 border border-primary rounded">
								<input id="btn_other_send_auto" alt="" title="" type="checkbox"
									class="m-0 form-check-input checkbox_16 border border-dark"> <br> <b
									style="font-size: 12px;">Auto(30s)</b>
							</div>
							<button id="btn_send" type="button"
								class="lh-1 col p-1 m-1  btn btn-sm btn-outline-success">
								<b>Query<br>(AR)
								</b>
							</button>
							<button id="btn_clearAll" type="button"
								class="lh-1 col p-1 m-1  btn btn-sm btn-outline-warning">
								<b>Clear<br>all()
								</b>
							</button>
						</div>
					</div>
				</div>
			</div>
		</div>
	</div>
	<!-- 料BOM-查詢結果 -->
	<div id="other_BBI" class="col-12 m-0 p-1">
		<div class="col-12 p-0 m-0 lh-1 text-start rounded-top bg-info text-white">
			<i class="btn btn-outline-white p-0 pr-1 pl-1 bi bi-dash-square" data-bs-toggle="collapse"
				data-bs-target=".other_BBI_open" aria-expanded="false" style="width: 22px; height: 24px;"></i>
			From ERP BOM list
		</div>
		<div id="other_BBI_open" class="row m-0 collapse other_BBI_open">
			<b class="p-0 m-0 lh-1 wlr bg-info text-white"> Result </b>
			<table
				class="col m-0 p-0 border border-primary table table-striped table-hover table-sm table-bordered border-primary table-responsive table-style shadow-sm">
				<thead class="table-primary fixedCt">
					<tr>
						<th class="fixedC1" style="min-width: 40px;">
							<div>
								<button id="other_BBI_exthClearAll" type="button"
									class="lh-1 col p-1 m-0 btn btn-sm btn-outline-dark">
									<b>M</b>
								</button>
							</div>
						</th>
						<th class="exTheadth d-none" style="min-width: 100px;">N/A</th>
					</tr>
				</thead>
				<tbody class="table-white">
					<tr class="exTbodyTr">
						<th class="fixedC1 exTbodyTh" style="max-width: 40px;">
							<div>
								<input name="other_BBI_checkbox" disabled="disabled" alt="row_x" title="IKey_GKey"
									type="checkbox" class="m-0 form-check-input checkbox_24 border border-dark">
							</div>
						</th>
						<td class="exTbodytd d-none" style="max-width: 100px"></td>
					</tr>
				</tbody>
			</table>
		</div>
	</div>
	<!-- 規則BOM-查詢結果 -->
	<div id="other_BPR" class="col-12 m-0 p-1">
		<div class="col-12 p-0 m-0 lh-1 text-start rounded-top bg-warning text-white">
			<i class="btn btn-outline-white p-0 pr-1 pl-1 bi bi-dash-square" data-bs-toggle="collapse"
				data-bs-target=".other_BPR_open" aria-expanded="false" style="width: 22px; height: 24px;"></i>
			BOM Rules list
		</div>
		<div id="other_BPR_open" class="row m-0 collapse other_BPR_open">
			<b class="p-0 m-0 lh-1 wlr bg-warning text-white"> Result </b>
			<table
				class="col m-0 p-0 border border-primary table table-striped table-hover table-sm table-bordered border-primary table-responsive table-style shadow-sm">
				<thead class="table-primary fixedCt">
					<tr>
						<th class="fixedC1" style="min-width: 40px;">
							<div>
								<button type="button" class="lh-1 col p-1 m-0 btn btn-sm btn-outline-dark">
									<b>M</b>
								</button>
							</div>
						</th>
						<th class="exTheadth d-none" style="min-width: 100px;">N/A</th>
					</tr>
				</thead>
				<tbody class="table-white">
					<tr class="exTbodyTr">
						<th class="fixedC1 exTbodyTh" style="max-width: 40px;">
							<div>
								<input name="other_BPR_c_detail" disabled="disabled" alt="row_x" title="IKey_GKey"
									type="radio" class="m-0 form-check-input checkbox_24 border border-dark">
							</div>
						</th>
						<td class="exTbodytd d-none" style="max-width: 100px"></td>
					</tr>
				</tbody>
			</table>
		</div>
	</div>
	<!-- 查詢-細節結果-BPR -->
	<div id="other_Detail_BPR_od" class="col-12 m-0 p-1">
		<div class="col-12 p-0 m-0 lh-1 text-start rounded-top bg-warning text-white">
			<i class="btn btn-outline-white p-0 pr-1 pl-1 bi bi-dash-square" data-bs-toggle="collapse"
				data-bs-target=".other_Detail_BPR_open" aria-expanded="false" style="width: 22px; height: 24px;"></i>
			BOM Rules detail
		</div>
		<div id="other_Detail_BPR_open" class="row m-0 collapse other_Detail_BPR_open">
			<b class="p-0 m-0 lh-1 wlr bg-warning text-white"> Modify detail </b>
			<!--BOM項目規則-->
			<div class="col row m-0 p-0 border border-primary" style="width: 95%;">
				<!--BOM項目清單-->
				<div id="other_Detail_BPR" class="col-12 col-lg-7 m-0 p-1 row">
					<!---->
					<div id="od_bpr_status" class="col-2 m-0 p-0 border border-secondary rounded">
						<div class="otherTitle bg-success fw-bolder rounded-top">Status(狀態)</div>
						<div class="p-1 m-0 bpm_status text-secondary h3">
							<select class="col-12 m-0 p-1 border border-dark form-select">
								<option class="text-secondary h4" value="" selected>None</option>
								<option class="text-success h4" value="Add">Add(AC)</option>
								<option class="text-warning h4" value="Modify">Modify(AU)</option>
								<option class="text-danger h4" value="Delete">Delete(AD)</option>
							</select>
						</div>
					</div>
					<!--PM-->
					<div id="od_bpr_name" class="col-4 m-0 p-0 border border-secondary rounded">
						<div class="otherTitle bg-success fw-bolder rounded-top">bpr_name</div>
						<div class="p-1">
							<input class="col-12 m-0 p-1 border border-dark form-control" type=text name="bpm_nb"
								placeholder="Ex:90-123-123456">
						</div>
					</div>
					<div id="od_bpr_model" class="col-2 m-0 p-0 border border-secondary rounded">
						<div class="otherTitle bg-success fw-bolder rounded-top">bpr_model</div>
						<div class="p-1">
							<input class="col-12 m-0 p-1 border border-dark form-control" type=text name="bpm_model"
								placeholder="Ex:303KY Model">
						</div>
					</div>
					<div id="od_bpr_type" class="col-2 m-0 p-0 border border-secondary rounded">
						<div class="otherTitle bg-success fw-bolder rounded-top">bpr_type</div>
						<div class="p-1">
							<select class="col-12 m-0 p-1 border border-dark form-select" name="bpm_type">
								<option value="">請選擇</option>
								<option value="0">開發BOM</option>
								<option value="1">產品BOM</option>
								<option value="2">配件BOM</option>
								<option value="3">半品BOM</option>
								<option value="4">板階BOM</option>
							</select>
						</div>
					</div>
					<div id="od_bpr_sys_note" class="col-12 m-0 p-0  mt-1 border border-secondary rounded">
						<div class="otherTitle bg-success fw-bolder rounded-top">bpr_sys_note</div>
						<div class="p-1">
							<textarea rows="3" class="col-12 m-0 p-1 border border-dark form-control" name="sys_note"
								placeholder="Ex:Note"></textarea>
						</div>
					</div>
					<!---->
					<table style="min-height: 535px;"
						class="col m-0 p-0  mt-1 border border-primary table table-striped table-hover table-sm table-bordered border-primary table-responsive table-style shadow-sm">
						<thead class="table-success fixedCt">
							<tr>
								<th class="fixedC1" style="min-width: 40px;">
									<div>
										<i alt="row_x" title="other_Detail_BPR"
											class="btn btn-outline-success p-0 bi bi-plus-square"
											style="width: 24px; height: 24px;"></i>
									</div>
								</th>
								<th class="exTheadth d-none" style="min-width: 100px;">N/A</th>
							</tr>
						</thead>
						<tbody class="table-white">
							<tr class="exDetailTbodyTr d-none">
								<th class="fixedC1 exTbodyTh" style="max-width: 40px;">
									<div class="pt-1">
										<i alt="row_x" title="IKey_GKey"
											class="btn btn-outline-danger p-0 bi bi-dash-square "
											style="width: 24px; height: 24px;"></i>
									</div>
								</th>
								<td class="exTbodytd d-none" style="max-width: 100px">
									<input class="col-12 m-0 p-1 border border-dark form-control" disabled="disabled">
								</td>
							</tr>
						</tbody>
					</table>
				</div>
				<div id="other_Detail_BPR_info" class="col-12 col-lg-5 m-0 p-1">
					<!--bom_parameter_settings(用途:BOM產品參數)-->
					<div id="other_BPR_BPS" class="col-12 m-0 p-0 mt-1 border border-secondary rounded">
						<div class="otherTitle bg-info fw-bolder rounded-top">Product parameters(產品自訂參數).</div>
						<table style="max-height: 220px;"
							class="col m-0 p-0 border border-primary table table-striped table-hover table-sm table-bordered border-primary table-responsive table-style shadow-sm">
							<thead class="table-info fixedCt">
								<tr>
									<th class="fixedC1" style="min-width: 40px;">
										<div>
											<button type="button" class="lh-1 col p-1 m-0 btn btn-sm btn-outline-dark">
												<b>M</b>
											</button>
										</div>
									</th>
									<th class="exTheadth d-none" style="min-width: 100px;">N/A</th>
								</tr>
							</thead>
							<tbody class="table-white">
								<tr class="exTbodyTr">
									<th class="fixedC1 exTbodyTh bpscheck" style="max-width: 40px;">
										<div>
											<input name="other_BPS_Val" disabled="disabled" alt="row_x"
												title="IKey_GKey" type="checkbox"
												class="m-0 form-check-input checkbox_24 border border-dark">
										</div>
									</th>
									<td class="exTbodytd d-none" style="max-width: 100px"></td>
								</tr>
							</tbody>
						</table>
					</div>
				</div>
				<!--規則BOM物料細節-查詢結果-->
				<div id="other_BPR_BIS" class="col-12 col-lg-5 m-0 p-0 pt-1 d-none">
					<div class="otherTitle bg-orange fw-bolder rounded-top">
						Bom edit basic conditions
					</div>
					<div id="other_BPR_BIS_open" class="row m-0">
						<b class="p-0 m-0 lh-1 wlr bg-orange text-white"> Result </b>
						<div class="col m-0 p-0" style="width: 95%;">
							<table
								class="col m-0 p-0 border border-primary table table-striped table-hover table-sm table-bordered border-primary table-responsive table-style shadow-sm"
								style="height: 445px;min-height: 445px;">
								<thead class="table-warning  fixedCt">
									<tr>
										<th class="fixedC1" style="min-width: 40px;">
											<div>
												<i alt="row_x" title="IKey_GKey"
													class="btn btn-outline-success p-0 bi bi-plus-square"
													style="width: 24px; height: 24px;"></i>
											</div>
										</th>
										<th class="exTheadth d-none" style="min-width: 100px;">N/A</th>
									</tr>
								</thead>
								<tbody class="table-white">
									<tr class="exTbodyTr">
										<th class="fixedC1 exTbodyTh" style="max-width: 40px;">
											<div class="pt-1">
												<i alt="row_x" title="IKey_GKey"
													class="btn btn-outline-danger p-0 bi bi-dash-square "
													style="width: 24px; height: 24px;"></i>
											</div>
										</th>
										<td class="exTbodytd d-none" style="max-width: 100px">
											<input class="col-12 m-0 p-1 border border-dark form-control">
										</td>
									</tr>
								</tbody>
							</table>
						</div>
					</div>
				</div>
			</div>
		</div>
	</div>
	<!-- 查詢結果 -->
	<div id="other_BPM" class="col-12 m-0 p-1">
		<div class="col-12 p-0 m-0 lh-1 text-start rounded-top bg-teal text-white">
			<i class="btn btn-outline-white p-0 pr-1 pl-1 bi bi-dash-square" data-bs-toggle="collapse"
				data-bs-target=".other_BPM_open" aria-expanded="false" style="width: 22px; height: 24px;"></i>
			BOM Format list
		</div>
		<div id="other_BPM_open" class="row m-0 collapse show other_BPM_open">
			<b class="p-0 m-0 lh-1 wlr bg-teal text-white"> Result </b>
			<table
				class="col m-0 p-0 border border-primary table table-striped table-hover table-sm table-bordered border-primary table-responsive table-style shadow-sm">
				<thead class="table-primary fixedCt">
					<tr>
						<th class="fixedC1" style="min-width: 40px;">
							<div>
								<button id="other_BPM_exthClearAll" type="button"
									class="lh-1 col p-1 m-0 btn btn-sm btn-outline-dark">
									<b>Ｌ</b>
								</button>
							</div>
						</th>
						<th class="exTheadth d-none" style="min-width: 100px;">N/A</th>
					</tr>
				</thead>
				<tbody class="table-white">
					<tr class="exTbodyTr">
						<th class="fixedC1 exTbodyTh" style="max-width: 40px;">
							<div>
								<input name="other_BPM_c_detail" disabled="disabled" alt="row_x" title="IKey_GKey"
									type="radio" class="m-0 form-check-input checkbox_24 border border-dark">
							</div>
						</th>
						<td class="exTbodytd d-none" style="max-width: 100px"></td>
					</tr>
				</tbody>
			</table>
		</div>
	</div>
	<!-- 查詢-細節結果-BPM -->
	<div id="other_Detail_BPM_od" class="col-12 m-0 p-1">
		<div class="col-12 p-0 m-0 lh-1 text-start rounded-top bg-teal text-white">
			<i class="btn btn-outline-white p-0 pr-1 pl-1 bi bi-dash-square" data-bs-toggle="collapse"
				data-bs-target=".other_Detail_BPM_open" aria-expanded="false" style="width: 22px; height: 24px;"></i>
			BOM Format detail
		</div>
		<div id="other_Detail_BPM_open" class="row m-0 collapse show other_Detail_BPM_open">
			<b class="p-0 m-0 lh-1 wlr bg-teal text-white"> Modify detail </b>
			<!--BOM項目規則-->
			<div class="col row m-0 p-0 border border-primary" style="width: 95%;">
				<!--BOM項目清單-->
				<div id="other_Detail_BPM" class="col-12 col-lg-7 m-0 p-1 row">
					<!---->
					<div id="od_bpm_status" class="col-2 m-0 p-0 border border-secondary rounded">
						<div class="otherTitle bg-success fw-bolder rounded-top">Status(狀態)</div>
						<div class="p-1 m-0 bpm_status text-secondary h3">
							<select class="col-12 m-0 p-1 border border-dark form-select">
								<option class="text-secondary h4" value="" selected>None</option>
								<option class="text-success h4" value="Add">Add(AC)</option>
								<option class="text-warning h4" value="Modify">Modify(AU)</option>
								<option class="text-danger h4" value="Delete">Delete(AD)</option>
							</select>
						</div>
					</div>
					<!--PM-->
					<div id="od_bpm_model" class="col-2 m-0 p-0 border border-secondary rounded">
						<div class="otherTitle bg-success fw-bolder rounded-top">bpm_model</div>
						<div class="p-1">
							<input class="col-12 m-0 p-1 border border-dark form-control" type=text name="bpm_model"
								placeholder="Ex:303KY Model">
						</div>
					</div>
					<div id="od_bpm_nb" class="col-4 m-0 p-0 border border-secondary rounded">
						<div class="otherTitle bg-success fw-bolder rounded-top">bpm_nb</div>
						<div class="p-1">
							<input class="col-12 m-0 p-1 border border-dark form-control" type=text name="bpm_nb"
								placeholder="Ex:90-123-123456">
						</div>
					</div>
					<div id="od_bpm_type" class="col-2 m-0 p-0 border border-secondary rounded">
						<div class="otherTitle bg-success fw-bolder rounded-top">bpm_type</div>
						<div class="p-1">
							<select class="col-12 m-0 p-1 border border-dark form-select" name="bpm_type">
								<option value="">請選擇</option>
								<option value="0">開發BOM</option>
								<option value="1">產品BOM</option>
								<option value="2">配件BOM</option>
								<option value="3">半品BOM</option>
								<option value="4">板階BOM</option>
							</select>
						</div>
					</div>
					<div id="od_bpm_sys_note" class="col-12 m-0 p-0  mt-1 border border-secondary rounded">
						<div class="otherTitle bg-success fw-bolder rounded-top">bpm_sys_note</div>
						<div class="p-1">
							<textarea rows="3" class="col-12 m-0 p-1 border border-dark form-control" name="sys_note"
								placeholder="Ex:Note"></textarea>
						</div>
					</div>
					<!---->
					<table style="min-height: 535px;"
						class="col m-0 p-0  mt-1 border border-primary table table-striped table-hover table-sm table-bordered border-primary table-responsive table-style shadow-sm">
						<thead class="table-success fixedCt">
							<tr>
								<th class="fixedC1" style="min-width: 40px;">
									<div>
										<i alt="row_x" title="other_Detail_BPM"
											class="btn btn-outline-success p-0 bi bi-plus-square"
											style="width: 24px; height: 24px;"></i>
									</div>
								</th>
								<th class="exTheadth d-none" style="min-width: 100px;">N/A</th>
							</tr>
						</thead>
						<tbody class="table-white">
							<tr class="exDetailTbodyTr d-none">
								<th class="fixedC1 exTbodyTh" style="max-width: 40px;">
									<div class="pt-1">
										<i alt="row_x" title="IKey_GKey"
											class="btn btn-outline-danger p-0 bi bi-dash-square "
											style="width: 24px; height: 24px;"></i>
									</div>
								</th>
								<td class="exTbodytd d-none" style="max-width: 100px">
									<input class="col-12 m-0 p-1 border border-dark form-control" disabled="disabled">
								</td>
							</tr>
						</tbody>
					</table>
				</div>
				<div id="other_Detail_BPM_info" class="col-12 col-lg-5 m-0 p-1">
					<!--Software&&Hardware-->
					<div id="other_BSH" class="col-12 m-0 p-0 border border-secondary rounded">
						<div class="otherTitle bg-primary fw-bolder rounded-top">Software/Firmware/Hardware ver(軟硬韌體版本).
						</div>
						<table style="max-height: 220px;"
							class="col m-0 p-0 border border-primary table table-striped table-hover table-sm table-bordered border-primary table-responsive table-style shadow-sm">
							<thead class="table-primary fixedCt">
								<tr>
									<th class="fixedC1" style="min-width: 40px;">
										<div>
											<button type="button" class="lh-1 col p-1 m-0 btn btn-sm btn-outline-dark">
												<b>M</b>
											</button>
										</div>
									</th>
									<th class="exTheadth d-none" style="min-width: 100px;">N/A</th>
								</tr>
							</thead>
							<tbody class="table-white">
								<tr class="exTbodyTr">
									<th class="fixedC1 exTbodyTh" style="max-width: 40px;">
										<div>
											<input name="other_BSH_Val" disabled="disabled" alt="row_x"
												title="IKey_GKey" type="radio"
												class="m-0 form-check-input checkbox_24 border border-dark">
										</div>
									</th>
									<td class="exTbodytd d-none" style="max-width: 100px"></td>
								</tr>
							</tbody>
						</table>
					</div>
					<!--bom_parameter_settings(用途:BOM產品參數)-->
					<div id="other_BPS" class="col-12 m-0 p-0 mt-1 border border-secondary rounded">
						<div class="otherTitle bg-info fw-bolder rounded-top">Product parameters(產品自訂參數).</div>
						<table style="max-height: 220px;"
							class="col m-0 p-0 border border-primary table table-striped table-hover table-sm table-bordered border-primary table-responsive table-style shadow-sm">
							<thead class="table-info fixedCt">
								<tr>
									<th class="fixedC1" style="min-width: 40px;">
										<div>
											<button type="button" class="lh-1 col p-1 m-0 btn btn-sm btn-outline-dark">
												<b>M</b>
											</button>
										</div>
									</th>
									<th class="exTheadth d-none" style="min-width: 100px;">N/A</th>
								</tr>
							</thead>
							<tbody class="table-white">
								<tr class="exTbodyTr">
									<th class="fixedC1 exTbodyTh bpscheck" style="max-width: 40px;">
										<div>
											<input name="other_BPS_Val" disabled="disabled" alt="row_x"
												title="IKey_GKey" type="checkbox"
												class="m-0 form-check-input checkbox_24 border border-dark">
										</div>
									</th>
									<td class="exTbodytd d-none" style="max-width: 100px"></td>
								</tr>
							</tbody>
						</table>
					</div>
					<!--生產紀錄-->
					<div id="other_PPR" class="col-12 m-0 p-0 mt-1 border border-secondary rounded">
						<div class="otherTitle bg-secondary fw-bolder rounded-top">Production records(生產紀錄).</div>
						<table style="max-height: 220px;"
							class="col m-0 p-0 border border-primary table table-striped table-hover table-sm table-bordered border-primary table-responsive table-style shadow-sm">
							<thead class="table-warning fixedCt">
								<tr>
									<th class="fixedC1" style="min-width: 40px;">
										<div>
											<button type="button" class="lh-1 col p-1 m-0 btn btn-sm btn-outline-dark">
												<b>M</b>
											</button>
										</div>
									</th>
									<th class="exTheadth d-none" style="min-width: 100px;">N/A</th>
								</tr>
							</thead>
							<tbody class="table-white">
								<tr class="exTbodyTr">
									<th class="fixedC1 exTbodyTh" style="max-width: 40px;">
										<div>
											<input name="other_PPR_Val" disabled="disabled" alt="row_x"
												title="IKey_GKey" type="radio"
												class="m-0 form-check-input checkbox_24 border border-dark">
										</div>
									</th>
									<td class="exTbodytd d-none" style="max-width: 100px"></td>
								</tr>
							</tbody>
						</table>
					</div>
				</div>
				<!--規則BOM物料細節-查詢結果-->
				<div id="other_BIS" class="col-12 col-lg-5 m-0 p-1 d-none">
					<div class="otherTitle bg-orange fw-bolder rounded-top">
						Bom edit basic conditions
					</div>
					<div id="other_BIS_open" class="row m-0">
						<b class="p-0 m-0 lh-1 wlr bg-orange text-white"> Result </b>
						<div class="col m-0 p-0" style="width: 95%;">
							<table
								class="col m-0 p-0 border border-primary table table-striped table-hover table-sm table-bordered border-primary table-responsive table-style shadow-sm"
								style="min-height: 535px;">
								<thead class="table-warning  fixedCt">
									<tr>
										<th class="fixedC1" style="min-width: 40px;">
											<div>
												<i alt="row_x" title="IKey_GKey"
													class="btn btn-outline-success p-0 bi bi-plus-square"
													style="width: 24px; height: 24px;"></i>
											</div>
										</th>
										<th class="exTheadth d-none" style="min-width: 100px;">N/A</th>
									</tr>
								</thead>
								<tbody class="table-white">
									<tr class="exTbodyTr">
										<th class="fixedC1 exTbodyTh" style="max-width: 40px;">
											<div class="pt-1">
												<i alt="row_x" title="IKey_GKey"
													class="btn btn-outline-danger p-0 bi bi-dash-square "
													style="width: 24px; height: 24px;"></i>
											</div>
										</th>
										<td class="exTbodytd d-none" style="max-width: 100px">
											<input class="col-12 m-0 p-1 border border-dark form-control">
										</td>
									</tr>
								</tbody>
							</table>
						</div>
					</div>
				</div>
			</div>
		</div>
	</div>
</div>

<script type="text/javascript">
	//宣告
	//console.log("other.html(init)");
	other = {
		//資料
		data: {
			marks: {},//有選取的IKeyGKey
			markDetails: {},//有選取的IKeyGKey
			entityFormatJson: {},//查詢格式
			btn_other_send_auto: "",//自動傳送
			//換頁設置
			otherItemPageSet: {
				total: 200,//批次數量(1-1000)
				batch: 0,//第幾批次(1-1000)
				pageNew: 1,//單前頁碼(1-50)
				pageSize: 200,//每頁數量(1-20)
				entityIKey: {},//ID
				entityGKey: {},//GID
				entityDateTime: "",//是時間格式的欄位 
				entity: [],//資料
				entityDetailJsons: [],//細節資料
				entityOther: {},//其他資料
			},
			otherItemSet: {},
			entityIKey: {BBI: "", BPR: "", BPM: ""},
			entityGKey: {BBI: "", BPR: "", BPM: ""},
		},
		//方法
		methods: {
			create() {
				//===============================Step0.初始化===============================
				console.log("other.html(created)");
				//查詢格式
				other.data.entityFormatJson = JSON.parse(main.resq_data['entityFormatJson']);
				//查詢項目 
				let otherSetJson = JSON.parse(main.resq_data['searchSet']);
				//console.log(otherItemSetJson);
				//資料內容
				other.data.otherItemPageSet.entity = JSON.parse(main.resq_data['entityJson']);
				other.data.otherItemPageSet.entityDetail = JSON.parse(main.resq_data['entityDetailJson']);
				other.data.otherItemPageSet.entityOther = JSON.parse(main.resq_data['otherSet']);
				//而外取得 物料清單


				other.data.entityIKey['BBI'] = JSON.parse(main.resq_data['entityIKeyGKey'])['BBI'].split("_")[0];
				other.data.entityGKey['BBI'] = JSON.parse(main.resq_data['entityIKeyGKey'])['BBI'].split("_")[1];
				other.data.entityIKey['BPR'] = JSON.parse(main.resq_data['entityIKeyGKey'])['BPR'].split("_")[0];
				other.data.entityGKey['BPR'] = JSON.parse(main.resq_data['entityIKeyGKey'])['BPR'].split("_")[1];
				other.data.entityIKey['BPM'] = JSON.parse(main.resq_data['entityIKeyGKey'])['BPM'].split("_")[0];
				other.data.entityGKey['BPM'] = JSON.parse(main.resq_data['entityIKeyGKey'])['BPM'].split("_")[1];

				other.data.entityDateTime = main.resq_data['entityDateTime'];
				other.data.otherSet = otherSetJson['searchSet'];
				//===============================Step1.按鈕權限?===============================
				let p = $("#nav_functional_unit").attr("alt").split("<_>")[2];
				let ps = Array.from(p);
				if (ps[10] != 1) {//查詢(AR)10
					$("#btn_send").addClass("disabled");
					$("#btn_w_test").addClass("disabled");
				} if (ps[9] != 1) {//修改(AU)9
					$("#btn_i_modify").addClass("disabled");
				} if (ps[8] != 1) {//新增(AC)8
					$("#btn_i_add").addClass("disabled");
				} if (ps[6] != 1) {//移除(DD)6
					$("#btn_i_remove").addClass("disabled");
				} if (ps[6] != 1 && ps[8] != 1 && ps[9] != 1) {//存入資料內容
					$("#btn_w_save").addClass("disabled");
				}
				//===============================Step2.查詢結果標題-排序===============================

				let resultTheadBPM = otherSetJson['resultThead'];
				resultTheadBPM = main.methods.orderedSort(resultTheadBPM);
				let resultDetailTheadBPM = otherSetJson['resultDetailThead'];
				resultDetailTheadBPM = main.methods.orderedSort(resultDetailTheadBPM);
				//而外標題
				let resultTheadBIS = otherSetJson['resultTheadBIS'];
				resultTheadBIS = main.methods.orderedSort(resultTheadBIS);
				let resultTheadBPR = otherSetJson['resultTheadBPR'];
				resultTheadBPR = main.methods.orderedSort(resultTheadBPR);
				let resultTheadBBI = otherSetJson['resultTheadBBI'];
				resultTheadBBI = main.methods.orderedSort(resultTheadBBI);
				let resultTheadBSH = otherSetJson['resultTheadBSH'];
				resultTheadBSH = main.methods.orderedSort(resultTheadBSH);
				let resultTheadBPS = otherSetJson['resultTheadBPS'];
				resultTheadBPS = main.methods.orderedSort(resultTheadBPS);
				//console.log(resultThead);

				//===============================Step3.查詢結果標題-資料===============================
				const codeFunctionResult = (toWho, vals) => {
					return new Promise((resolve, reject) => {
						try {
							//5張表格->預設第一張表格
							let pageSize = other.data.otherItemPageSet.pageSize;
							let fixedC1Left = "40px";
							let resultThead = vals;
							let toWhoId = "";
							if (toWho === "BPM") {
								toWhoId = "BPM";
							} else if (toWho === "Detail_BPM") {//BOM規格細節-BPM
								toWhoId = "Detail_BPM";
							} else if (toWho === "Detail_BPR") {//BOM規格細節-BPR
								toWhoId = "Detail_BPR";
							} else if (toWho === "BIS") {//
								toWhoId = "BIS";
								pageSize = 0;
							} else if (toWho === "BPR") {//
								toWhoId = "BPR";
							} else if (toWho === "BPR_BIS") {//
								toWhoId = "BPR_BIS";
								pageSize = 0;
							} else if (toWho === "BBI") {//ERP_BOM
								toWhoId = "BBI";
								pageSize = 100;
							} else if (toWho === "BSH") {//軟硬韌體版本
								toWhoId = "BSH";
								pageSize = 50;
							} else if (toWho === "BPS") {//參數定義
								toWhoId = "BPS";
								pageSize = 50;
							} else if (toWho === "BPR_BPS") {//參數定義
								toWhoId = "BPR_BPS";
								pageSize = 50;
							}
							//查詢結果標題-排序
							let check1 = true;
							Object.keys(resultThead).forEach(function (k) {
								//console.log(k + ' - ' + resultThead[k]);
								//複製格式
								let exTheadth = $('#other_' + toWhoId + ' .exTheadth').clone();
								let exTbodytd = $('#other_' + toWhoId + ' .exTbodytd').clone();
								exTheadth.removeClass('exTheadth');
								exTheadth.removeClass('d-none')
								exTheadth.addClass('titTheadth');
								//
								exTbodytd.removeClass('exTbodytd');
								exTbodytd.removeClass('d-none')
								exTbodytd.addClass('valTbodytd');
								exTbodytd.attr("title", resultThead[k].cellName);
								exTbodytd.addClass(resultThead[k].cellName);

								//固定第一格式
								if (check1 && resultThead[k].show == 1) {
									check1 = false;
									exTheadth.addClass('fixedC1');
									exTheadth.css('left', fixedC1Left);
									exTbodytd.addClass('fixedC1');
									exTbodytd.css('left', fixedC1Left);
								}
								//如果有翻譯
								if (resultThead[k].cellLanguage != '') {
									let cellName = JSON.parse(resultThead[k].cellLanguage)[$('#menu_login_language').text()];
									exTheadth.text(cellName == "" ? resultThead[k].cellName : cellName);//有可能內容是空的
									exTheadth.css('minWidth', resultThead[k].width + "px");
									exTbodytd.css('maxWidth', resultThead[k].width + "px");
									//===特殊 限制於BPM使用->順帶入名稱===
									if (toWhoId === "BPM") {
										if (resultThead[k].cellName === "bpmmodel") {
											$("#od_bpm_model .otherTitle").text(cellName == "" ? resultThead[k].cellName : cellName);
										} else if (resultThead[k].cellName === "bpmnb") {
											$("#od_bpm_nb .otherTitle").text(cellName == "" ? resultThead[k].cellName : cellName);
										} else if (resultThead[k].cellName === "bpmtype") {
											$("#od_bpm_type .otherTitle").text(cellName == "" ? resultThead[k].cellName : cellName);
										} else if (resultThead[k].cellName === "sysnote") {
											$("#od_bpm_sys_note .otherTitle").text(cellName == "" ? resultThead[k].cellName : cellName);
										}
									}
									//===特殊 限制於BPR使用->順帶入名稱===
									if (toWhoId === "BPR") {
										if (resultThead[k].cellName === "bprmodel") {
											$("#od_bpr_model .otherTitle").text(cellName == "" ? resultThead[k].cellName : cellName);
										} else if (resultThead[k].cellName === "bprname") {
											$("#od_bpr_name  .otherTitle").text(cellName == "" ? resultThead[k].cellName : cellName);
										} else if (resultThead[k].cellName === "bprtype") {
											$("#od_bpr_type .otherTitle").text(cellName == "" ? resultThead[k].cellName : cellName);
										} else if (resultThead[k].cellName === "sysnote") {
											$("#od_bpr_sys_note .otherTitle").text(cellName == "" ? resultThead[k].cellName : cellName);
										}
									}
									//===特殊 限制於BIS使用->順帶入名稱===
									if (toWhoId === "BIS" || toWhoId === "BPR_BIS") {
										if (resultThead[k].cellName === "bisnb") {
											$("#od_bis_bisnb .otherTitle").text(cellName == "" ? resultThead[k].cellName : cellName);
											//快選
											let bisnbList = $('<ul class="list-group bisnbList d-none"></ul>');
											bisnbList.css('maxHeight', '165px');
											bisnbList.css('overflowX', 'hidden');
											exTbodytd.find("input").after(bisnbList);
										}
										if (resultThead[k].cellName === "bisname") {
											$("#od_bis_bisnb .otherTitle").text(cellName == "" ? resultThead[k].cellName : cellName);
											//快選
											let bisnameList = $('<ul class="list-group bisnameList d-none"></ul>');
											bisnameList.css('maxHeight', '165px');
											bisnameList.css('overflowX', 'hidden');
											exTbodytd.find("input").after(bisnameList);
										}
										if (resultThead[k].cellName === "bisqty") {
											exTbodytd.find("input").attr("type", "number");
										}
									}
									//特殊處理(可點擊BPM/BPR)
									if (toWho === "Detail_BPM" || toWho === "Detail_BPR") {
										if (resultThead[k].cellName === "bisnb") {
											exTbodytd.find("input").attr("type", "button");
											exTbodytd.find("input").removeAttr("disabled");
											exTbodytd.find("input").addClass("btn").addClass("btn-outline-primary");
										}
									}
								} else {
									exTheadth.text(resultThead[k].cellName);
									exTheadth.css('minWidth', resultThead[k].width + "px");
									exTbodytd.css('maxWidth', resultThead[k].width + "px");
								}
								//如果隱藏
								if (resultThead[k].show == 0) {
									exTheadth.addClass('d-none');
									exTbodytd.addClass('d-none');
								}
								//添加
								$('#other_' + toWhoId + ' .exTheadth').before(exTheadth);
								$('#other_' + toWhoId + ' .exTbodytd').before(exTbodytd);
							});
							//資料欄位
							let exTbodyTr = $('#other_' + toWhoId + ' .exTbodyTr').clone();
							exTbodyTr.removeClass("exTbodyTr");
							for (let p = 1; p <= pageSize; p++) {
								let inTbodyTr = exTbodyTr.clone();
								inTbodyTr.addClass("valTbodyTr_" + p);
								inTbodyTr.find("input").first().attr('title', 'valTbodyTr_' + p);
								$('#other_' + toWhoId + ' .exTbodyTr').before(inTbodyTr);
							}

							$('#other_' + toWhoId + ' .exTbodyTr').addClass("d-none");
							resolve("OK:" + toWho);
						} catch (error) {
							reject("操作失敗:" + error + ":" + toWho);
						}
					});
				};
				//===============================Step4.查詢條件===============================
				const codeFunctionSearch = (toWho, vals) => {
					return new Promise((resolve, reject) => {
						try {
							//會有三種查詢
							let rThead = "resultThead";//翻譯
							let toWhoId = " #BPM";//BOM規格
							let toWhoJson = "searchSet";
							let titleCo = "bg-teal";
							if (toWho === "BBI") {//BOM料號
								rThead = "resultTheadBBI";//翻譯
								toWhoId = " #BBI";
								toWhoJson = "searchSetBBI";
								titleCo = "bg-info";
							} else if (toWho === "BPR") {//BOM規則
								rThead = "resultTheadBPR";//翻譯
								toWhoId = " #BPR";
								toWhoJson = "searchSetBPR";
								titleCo = "bg-yellow";
							}
							let resultThead = otherSetJson[rThead];
							resultThead = main.methods.orderedSort(resultThead);
							//資料
							for (let t = 0; t < otherSetJson[toWhoJson].length; t++) {
								let otherItemSet = otherSetJson[toWhoJson][t];
								let otherTextEx = "";
								let otherSelectEx = "";
								let selectEx = "";
								//不顯示
								if (!otherItemSet['show']) {
									continue;
								}
								if (otherItemSet['type'] != 'select') {
									//一般文字
									otherTextEx = $('#other_c_item .otherTextEx').clone();
									otherTextEx.removeClass("otherTextEx");
									otherTextEx.removeClass("col-md-1");
									otherTextEx.removeClass("d-none");
									otherTextEx.addClass(otherItemSet['width'].replaceAll("_", "-"));
									otherTextEx.find('input').attr("id", "other_s_" + otherItemSet['searchName']);
									otherTextEx.find('input').attr("name", "other_s_" + otherItemSet['searchName']);
									otherTextEx.find('input').attr("placeholder", otherItemSet['placeholder']);
									otherTextEx.find('input').addClass("searchVal");
									otherTextEx.find('.otherTitle').addClass(titleCo);
									Object.keys(resultThead).forEach(function (k) {
										//如果有翻譯
										if (k.split("_")[1] === otherItemSet['searchName']) {
											if (resultThead[k].cellLanguage != '') {
												let cellName = JSON.parse(resultThead[k].cellLanguage)[$('#menu_login_language').text()];
												otherTextEx.find('.otherTitle').text(cellName == "" ? otherItemSet['searchName'] : cellName);
											} else {
												otherTextEx.find('.otherTitle').text(otherItemSet['searchName']);
											}
										}
									});
								} else {
									//選擇選單
									otherSelectEx = $('#other_c_item .otherSelectEx').clone();
									otherSelectEx.removeClass("otherSelectEx");
									otherSelectEx.removeClass("col-md-1");
									otherSelectEx.removeClass("d-none");
									otherSelectEx.addClass(otherItemSet['width'].replaceAll("_", "-"));
									otherSelectEx.find('select').attr("id", "other_" + otherItemSet['searchName']);
									otherSelectEx.find('select').attr("name", "other_" + otherItemSet['searchName']);
									otherSelectEx.find('select').addClass("searchVal");
									otherSelectEx.find('.otherTitle').addClass(titleCo);
									//查詢欄位
									Object.keys(resultThead).forEach(function (k) {
										//如果有翻譯
										if (k.indexOf(otherItemSet['searchName']) >= 0) {
											if (resultThead[k].cellLanguage != '') {
												let cellName = JSON.parse(resultThead[k].cellLanguage)[$('#menu_login_language').text()];
												otherSelectEx.find('.otherTitle').text(cellName == "" ? otherItemSet['searchName'] : cellName);
											} else {
												otherSelectEx.find('.otherTitle').text(otherItemSet['searchName']);
											}
										}
									});
									//選項
									for (let s = 0; s < otherItemSet['select'].length; s++) {
										let key = otherItemSet['select'][s].split("_")[0];
										let val = otherItemSet['select'][s].split("_")[1];
										selectEx = otherSelectEx.find('.selectEx').clone();
										selectEx.removeClass("selectEx");
										selectEx.removeAttr("selected");
										selectEx.text(key);
										selectEx.val(val);
										selectEx.appendTo(otherSelectEx.find('select'));
									}
								}
								switch (otherItemSet['type']) {
									case "select":
										otherSelectEx.appendTo('#otherItemItem' + toWhoId);
										break;
									case "text":
										otherTextEx.appendTo('#otherItemItem' + toWhoId);
										break;
									case "time":
										otherTextEx.find('input').addClass('datetimepicker_time');
										otherTextEx.appendTo('#otherItemItem' + toWhoId);
										break;
									case "datetime":
										otherTextEx.find('input').addClass('datetimepicker_date');
										otherTextEx.appendTo('#otherItemItem' + toWhoId);
										break;
								}
							}
							resolve("OK:" + toWho);
						} catch (error) {
							reject("操作失敗:" + error + ":" + toWho);
						}
					});
				};

				// 1-1.異步執行-結果欄位
				// 創建多個 syncEvent 的 Promise(每個都會回傳)
				const promisesResult = [
					other.methods.syncEvent(codeFunctionResult, "BPM", resultTheadBPM),
					other.methods.syncEvent(codeFunctionResult, "Detail_BPM", resultDetailTheadBPM),
					other.methods.syncEvent(codeFunctionResult, "Detail_BPR", resultDetailTheadBPM),
					other.methods.syncEvent(codeFunctionResult, "BBI", resultTheadBBI),
					other.methods.syncEvent(codeFunctionResult, "BPR", resultTheadBPR),
					other.methods.syncEvent(codeFunctionResult, "BIS", resultTheadBIS),
					other.methods.syncEvent(codeFunctionResult, "BPR_BIS", resultTheadBIS),
					other.methods.syncEvent(codeFunctionResult, "BSH", resultTheadBSH),
					other.methods.syncEvent(codeFunctionResult, "BPS", resultTheadBPS),
					other.methods.syncEvent(codeFunctionResult, "BPR_BPS", resultTheadBPS),
				];
				//1-2 等待所有的 promisesResult 完成
				Promise.all(promisesResult)
					.then((results) => {
						console.log("所有事件都已成功完成(Result):", results);
						// 在這裡添加所有事件完成後要執行的代碼
						//===============================Step5.帶入資料===============================
						//=====BOM Format detail=====Detail_BPM(選項)
						const detail_BPM = (toWho, vals) => {
							return new Promise((resolve, reject) => {
								try {
									//1.規格項目組
									let bisgname = other.data.otherItemPageSet.entityOther['BIS'];
									let bisgselect = $('<select></select>');
									let bisgoption = $('<option></option>').text("請選擇").val("");
									bisgselect.append(bisgoption);
									bisgname.forEach(function (v) {
										// 檢查 <select> 裡面是否已經有相同的 bisgid 
										if (bisgselect.find('option[value="' + v['bisgid'] + '"]').length === 0) {
											bisgoption = $('<option class="o_' + v['bisgname'] + '" ></option>').text(v['bisgname']).val(v['bisgid']);
											bisgselect.append(bisgoption);
										}
									});
									//Basic
									bisgoption = $('<option></option>').text("Basic").val("0");
									bisgselect.append(bisgoption);

									bisgselect.addClass('form-select');
									$('#other_Detail_BPM .bisgname').html(bisgselect);
									$('#other_Detail_BPR .bisgname').html(bisgselect.clone());
									//2.規格項目(alt = 選擇ID 如果是0/-1 擇是YES OR NO)
									let bisname = other.data.otherItemPageSet.entityOther['BIS'];
									let bisselect = $('<select></select>');
									let bisoption = $('<option></option>').text("請選擇").val("");
									bisoption.addClass('bisgid_0');
									let bisgfname = "";
									bisselect.append(bisoption);
									bisname.forEach(function (v) {
										// 每項目組+子項目
										if (bisgfname !== v['bisgfname']) {
											bisgfname = v['bisgfname'];
											bisoption = $('<option></option>').text(v['bisgfname']).val("");
											bisoption.css("textAlign", "center");
											bisoption.addClass('bisgid_' + v['bisgid'] + ' d-none');
											bisoption.attr('disabled', 'disabled');
											//基本Yes / No
											bisselect.append(bisoption);
											let bisoptionYes = $('<option class="text-success"></option>').text("Yes(裝)").val("0");
											bisoptionYes.addClass('bisgid_' + v['bisgid'] + ' d-none');
											bisoptionYes.attr('title', "<_><_><_>");
											//
											let bisoptionNo = $('<option class="text-danger"></option>').text("No(無)").val("-1");
											bisoptionNo.addClass('bisgid_' + v['bisgid'] + ' d-none');
											bisoptionNo.attr('title', "<_><_><_>");
											bisselect.append(bisoptionYes);
											bisselect.append(bisoptionNo);
										}
										//切割整理(每個正規化子項目內容)
										let array = JSON.parse(v['bisfname']);
										let val = array.join(' , ');
										bisoption = $('<option></option>').text(val).val(v['bisid']);
										bisoption.addClass('bisgid_' + v['bisgid'] + ' d-none');
										bisoption.attr('title', v['bisnb'] + "<_>" + v['bisname'] + "<_>" + v['bisspecifications'] + "<_>" + v['bissdescripion'] + "<_>" + v['bisgfname']);
										bisselect.append(bisoption);

									});
									bisselect.addClass('form-select');
									$('#other_Detail_BPM .bisfname').html(bisselect);
									$('#other_Detail_BPR .bisfname').html(bisselect.clone());
									//3.開放數量
									$('#other_Detail_BPM .bisqty input').removeAttr('disabled');
									$('#other_Detail_BPM .bisqty input').attr('type', 'number').val(0);
									$('#other_Detail_BPR .bisqty input').removeAttr('disabled');
									$('#other_Detail_BPR .bisqty input').attr('type', 'number').val(0);
									resolve("OK:" + toWho);
								} catch (error) {
									reject("操作失敗:" + error + ":" + toWho);
								}
							});
						};
						//other_BPS(產品參數)
						const other_BPS = (toWho, vals) => {
							return new Promise((resolve, reject) => {
								try {
									let entityJsons = other.data.otherItemPageSet.entityOther['BPS'];
									let pageSize = 50;
									console.log(entityJsons);
									//還原
									$('#other_BPS').find('.form-check-input').attr('disabled', 'disabled');
									$('#other_BPS').find('.form-check-input').attr('title', 'IKey_GKey');
									$('#other_BPR_BPS').find('.form-check-input').attr('disabled', 'disabled');
									$('#other_BPR_BPS').find('.form-check-input').attr('title', 'IKey_GKey');
									//筆數
									for (let x = 0; x < pageSize; x++) {
										//筆數還夠
										if (x < entityJsons.length) {
											let entity = entityJsons[x];//((目前頁碼-1)*每頁數量)+x
											let valTbodyTr = $('#other_BPS .valTbodyTr_' + (x + 1));
											let valTbodyTrBPR = $('#other_BPR_BPS .valTbodyTr_' + (x + 1));

											//欄位&內容-只需要名稱&值

											valTbodyTr.find('.bpsname').text(entity['bpsname']);
											valTbodyTrBPR.find('.bpsname').text(entity['bpsname']);
											if (entity['bpstype'] === 1) {
												valTbodyTr.find('.bpsval').html('<input class="col-12 m-0 p-1 border border-dark form-control">');
												valTbodyTr.find('.bpsval input').attr('placeholder', 'Ex:' + entity['bpsval']);
												valTbodyTrBPR.find('.bpsval').html('<input class="col-12 m-0 p-1 border border-dark form-control">');
												valTbodyTrBPR.find('.bpsval input').attr('placeholder', 'Ex:' + entity['bpsval']);

											} else {
												$('#other_BPS .valTbodyTr_' + (x + 1) + ' .bpsval').html('<select class="form-select"><option class="defBPS" value="">請選擇</option></select>');
												$('#other_BPR_BPS .valTbodyTr_' + (x + 1) + ' .bpsval').html('<select class="form-select"><option class="defBPS" value="">請選擇</option></select>');

												let bpsval = JSON.parse(entity['bpsval']);
												bpsval.forEach(y => {
													//console.log(y);
													if (y.split("_").length > 1) {
														let option = $('<option value="' + y.split("_")[0] + '">' + y.split("_")[1] + '</option>');
														option.appendTo(valTbodyTr.find('.bpsval select'));
														option.clone().appendTo(valTbodyTrBPR.find('.bpsval select'));

													}
												});
											}
											valTbodyTr.find('.form-check-input').removeAttr('disabled');
											valTbodyTr.find('.form-check-input').attr('title', 'valTbodyTr_' + (x + 1));
											valTbodyTrBPR.find('.form-check-input').removeAttr('disabled');
											valTbodyTrBPR.find('.form-check-input').attr('title', 'valTbodyTr_' + (x + 1));
										} else {
											break;
										}
									} resolve("OK:" + toWho);
								} catch (error) {
									reject("操作失敗:" + error + ":" + toWho);
								}
							});
						};
						//other_(WM)物料清單整理
						const other_BIS = (toWho, vals) => {
							return new Promise((resolve, reject) => {
								try {
									//取得物料清單
									other.methods.confirmSend("SearchWM", "BPMWM");
									resolve("OK:" + toWho);
								} catch (error) {
									reject("操作失敗:" + error + ":" + toWho);
								}
							});
						};
						//BBI
						const codeFunctionResultData = other.methods.otherReLoad;
						const promisesResultData = [
							other.methods.syncEvent(codeFunctionResultData, "BBI", ""),
							other.methods.syncEvent(codeFunctionResultData, "BPM", ""),
							other.methods.syncEvent(detail_BPM, "", ""),
							other.methods.syncEvent(other_BPS, "", ""),
							other.methods.syncEvent(other_BIS, "", ""),
						]
					}).catch((error) => {
						console.error("其中一個或多個事件失敗(Result):", error);
					});

				//2-1.異步執行-查詢欄位
				const promisesSearch = [
					other.methods.syncEvent(codeFunctionSearch, "BPM", ""),
					other.methods.syncEvent(codeFunctionSearch, "BBI", ""),
					other.methods.syncEvent(codeFunctionSearch, "BPR", ""),
				];
				//1-1 && 2-1.異步執行-套用間格式
				Promise.all([Promise.all(promisesResult), Promise.all(promisesSearch)])
					.then(([resultResults, searchResults]) => {
						console.log("所有 promisesResult 都已完成:", resultResults);
						console.log("所有 promisesSearch 都已完成:", searchResults);
						// 在這裡添加所有 Promise 都完成後要執行的代碼-時間格式
						other.methods.datetimepickerDate();
					})
					.catch((error) => {
						console.error("其中一個或多個 Promise 失敗:", error);
					});

				//異步執行範例
				/*
				let sync = new Promise((resolve, reject) => {
					//*可自訂呼叫方法 event()
					//event(eventNave);
					//*傳遞成功
					//resolve("OK:" + eventNave);
					//*超時?
					//const timer = setTimeout(() => {
					//	reject("操作超時:" + eventNave);
					//}, 3000);
				});
				//事後接續動作(then(成功)/catch(異常)/finally(都會進去))
				sync.then((data) => {
					//* "資料獲取成功" ->可接續做的事情
					console.log(data); 
				}).catch((error) => {
					//* "資料獲取失敗" ->可接續做的事情
					console.log(error);
				});
				*/

				//==========================監聽==========================
				//=====點及按鈕類=====
				$(document).off("click", "#other_c button");
				$(document).on("click", "#other_c button", function (event) {
					console.log($(event.currentTarget).attr("id"));
					let clickId = $(event.currentTarget).attr("id");
					let bpmStatus = $('#od_bpm_status select');
					let bprStatus = $('#od_bpr_status select');
					//點擊動作
					switch (clickId) {
						case "btn_bpm_save":
							let Add = [];
							let Modify = [];
							let Remove = [];
							$("#other_BPM .bpmnb").each(s => {
								let valTbodyTr = $($("#other_BPM .bpmnb")[s]).parent();
								//新增存檔
								if ($($("#other_BPM .bpmnb")[s]).hasClass('text-success')) {
									Add.push(valTbodyTr.attr("class"));
								}
								//修改
								if ($($("#other_BPM .bpmnb")[s]).hasClass('text-warning')) {
									Modify.push(valTbodyTr.attr("class"));
								}
								//移除
								if ($($("#other_BPM .bpmnb")[s]).hasClass('text-danger')) {
									Remove.push(valTbodyTr.attr("class"));
								}
							});
							//資料整理->送出?
							if (Add.length > 0) {
								other.methods.confirmSend("Add", "BPM", Add);
							} else if (Modify.length > 0) {
								other.methods.confirmSend("Modify", "BPM", Modify);
							} else if (Remove.length > 0) {
								other.methods.confirmSend("Remove", "BPM", Remove);
							}
							break;
						case "btn_bpr_save":
							let bprAdd = [];
							let bprModify = [];
							let bprRemove = [];
							$("#other_BPR .bprname").each(s => {
								let valTbodyTr = $($("#other_BPR .bprname")[s]).parent();
								//新增存檔
								if ($($("#other_BPR .bprname")[s]).hasClass('text-success')) {
									bprAdd.push(valTbodyTr.attr("class"));
								}
								//修改
								if ($($("#other_BPR .bprname")[s]).hasClass('text-warning')) {
									bprModify.push(valTbodyTr.attr("class"));
								}
								//移除
								if ($($("#other_BPR .bprname")[s]).hasClass('text-danger')) {
									bprRemove.push(valTbodyTr.attr("class"));
								}
							});
							//資料整理->送出?
							if (bprAdd.length > 0) {
								other.methods.confirmSend("Add", "BPR", bprAdd);
							} else if (bprModify.length > 0) {
								other.methods.confirmSend("Modify", "BPR", bprModify);
							} else if (bprRemove.length > 0) {
								other.methods.confirmSend("Remove", "BPR", bprRemove);
							}
							break;
						case "btn_bpr_detail":
						case "btn_bpm_detail":
							let checkedBPM_R = [];
							let whois = "";
							let whoisbpsnv = "";
							let whoisbisitem = "";
							let other_BPM_R = "";
							if (clickId === "btn_bpm_detail" && $("#other_BPM tbody input:checked").length > 0) {
								checkedBPM_R = $("#other_BPM tbody input:checked").map(function () {
									return $(this).attr("title"); // 或者 $(this).attr("你的屬性名稱") 來取得特定屬性
								}).get();
								whois = "BPM";
								whoisbpsnv = JSON.parse($("#other_" + whois + " ." + checkedBPM_R + " .bpmbpsnv").text());
								whoisbisitem = JSON.parse($("#other_" + whois + " ." + checkedBPM_R + ' .bpmbisitem').text());
							} else if (clickId === "btn_bpr_detail" && $("#other_BPR tbody input:checked").length > 0) {
								checkedBPM_R = $("#other_BPR tbody input:checked").map(function () {
									return $(this).attr("title"); // 或者 $(this).attr("你的屬性名稱") 來取得特定屬性
								}).get();
								whois = "BPR";
								whoisbpsnv = JSON.parse($("#other_" + whois + " ." + checkedBPM_R + " .bprbpsnv").text());
								whoisbisitem = JSON.parse($("#other_" + whois + " ." + checkedBPM_R + ' .bprbisitem').text());
							}

							//有勾選?
							if (checkedBPM_R.length > 0) {
								//觸發開關->關閉
								if ($("#other_" + whois + "_open").hasClass("show")) {
									$("#other_" + whois + " .bi-dash-square").trigger("click");
								}
								console.log(checkedBPM_R); // 打印勾選的值清單
								//一般-初始化(BPM/BPR)
								if (whois === "BPM") {
									bpmStatus.val("").trigger('change');
									$("#other_Detail_" + whois + " #od_bpm_model input").val("");
									$("#other_Detail_" + whois + " #od_bpm_nb input").val("");
									$("#other_Detail_" + whois + " #od_bpm_type select").val("");
									$("#other_Detail_" + whois + " #od_bpm_sys_note textarea").val("");
									$("#other_Detail_" + whois + " .detailTbodyTr").remove();
									$("#other_Detail_" + whois + "_od #other_BIS valTbodyTr").remove();
									//參數-初始化
									$("#other_BPS tbody tr input:checked").prop("checked", false);
									$("#other_BPS tbody tr input").val("");
									$("#other_BPS tbody tr select").val("");
									//資訊補充
									other_BPM_R = $("#other_" + whois + " ." + checkedBPM_R);
									$("#other_Detail_" + whois + " #od_bpm_model input").val(other_BPM_R.find(".bpmmodel").text());
									$("#other_Detail_" + whois + " #od_bpm_nb input").val(other_BPM_R.find(".bpmnb").text());
									$("#other_Detail_" + whois + " #od_bpm_type select").val(other_BPM_R.find(".bpmtype").text());
									$("#other_Detail_" + whois + " #od_bpm_sys_note textarea").val(other_BPM_R.find(".sysnote").text());

									whoisbpsnv.forEach(itemOne => {
										let name = itemOne.split("_")[0];
										let val = itemOne.split("_")[1];
										$("#other_BPS tbody tr .bpsname").each(d => {
											let bpsname = $($("#other_BPS tbody tr .bpsname")[d]);
											if (bpsname.text() === name) {
												//選項?輸入?
												console.log(name + ":" + val);
												if (bpsname.parent().find(".bpsval select").length === 1) {
													bpsname.parent().find(".bpsval select").val(val);
													bpsname.parent().find(".bpscheck input").prop("checked", true);
												}
												if (bpsname.parent().find(".bpsval input").length === 1) {
													bpsname.parent().find(".bpsval input").val(val);
													bpsname.parent().find(".bpscheck input").prop("checked", true);
												}
											}
										});
									});
								} else if (whois === "BPR") {
									bprStatus.val("").trigger('change');
									$("#other_Detail_" + whois + " #od_bpr_name input").val("");
									$("#other_Detail_" + whois + " #od_bpr_model input").val("");
									$("#other_Detail_" + whois + " #od_bpr_type select").val("");
									$("#other_Detail_" + whois + " #od_bpr_sys_note textarea").val("");
									$("#other_Detail_" + whois + " .detailTbodyTr").remove();
									//參數-初始化
									$("#other_BPR_BPS tbody tr input:checked").prop("checked", false);
									$("#other_BPR_BPS tbody tr input").val("");
									$("#other_BPR_BPS tbody tr select").val("");
									//資訊補充
									other_BPM_R = $("#other_" + whois + " ." + checkedBPM_R);
									$("#other_Detail_" + whois + " #od_bpr_name input").val(other_BPM_R.find(".bprname").text());
									$("#other_Detail_" + whois + " #od_bpr_model input").val(other_BPM_R.find(".bprmodel").text());
									$("#other_Detail_" + whois + " #od_bpr_type select").val(other_BPM_R.find(".bprtype").text());
									$("#other_Detail_" + whois + " #od_bpr_sys_note textarea").val(other_BPM_R.find(".sysnote").text());

									whoisbpsnv.forEach(itemOne => {
										let name = itemOne.split("_")[0];
										let val = itemOne.split("_")[1];
										$("#other_BPR_BPS tbody tr .bpsname").each(d => {
											let bpsname = $($("#other_BPR_BPS tbody tr .bpsname")[d]);
											if (bpsname.text() === name) {
												//選項?輸入?
												console.log(name + ":" + val);
												if (bpsname.parent().find(".bpsval select").length === 1) {
													bpsname.parent().find(".bpsval select").val(val);
													bpsname.parent().find(".bpscheck input").prop("checked", true);
												}
												if (bpsname.parent().find(".bpsval input").length === 1) {
													bpsname.parent().find(".bpsval input").val(val);
													bpsname.parent().find(".bpscheck input").prop("checked", true);
												}
											}
										});
									});

								}

								//
								let odBPMTr = $("#other_Detail_" + whois + " tbody tr");//目前的項目數量
								let bisgnameTr = $("#other_c #other_Detail_" + whois + " .exDetailTbodyTr .bisgname option");//群組項目數量
								//items:項目:不可大於[群組項目數量]
								whoisbisitem.items.forEach(itemOne => {
									let detailTbodyTr = $("#other_c #other_Detail_" + whois + " .exDetailTbodyTr").clone();
									detailTbodyTr.removeClass('exDetailTbodyTr');
									detailTbodyTr.removeClass('d-none');
									detailTbodyTr.addClass('detailTbodyTr');
									detailTbodyTr.appendTo($("#other_c #other_Detail_" + whois + " tbody"));
									//群主檢查
									let bisgidCheck = detailTbodyTr.find('.bisgname select option[value="' + itemOne.bisgid + '"]').length > 0;
									if (bisgidCheck) {
										detailTbodyTr.find(".bisgname select").val("" + itemOne.bisgid).trigger('change');
										//項目檢查
										let bisidCheck = detailTbodyTr.find('.bisfname select option[value="' + itemOne.bisid + '"]').length > 0;
										if (bisidCheck) {
											detailTbodyTr.find(".bisfname select").val("" + itemOne.bisid).focus().trigger('change');
											detailTbodyTr.find(".bisprocess input").val(itemOne.bisprocess == null ? "ASM" : itemOne.bisprocess);
										}
									}
								});
								//basic:基本:
								let detailTbodyTr = $("#other_c #other_Detail_" + whois + " .exDetailTbodyTr").clone();
								detailTbodyTr.removeClass('exDetailTbodyTr');
								detailTbodyTr.removeClass('d-none');
								detailTbodyTr.addClass('detailTbodyTr');
								detailTbodyTr.appendTo($("#other_c #other_Detail_" + whois + " tbody"));
								detailTbodyTr.find(".bisgname select").val("0").focus().trigger('change');
								detailTbodyTr.find(".bisnb input").val(whoisbisitem.basic);

								//配色(BPM/BPR)
								if (whois === "BPM") {
									if (other_BPM_R.find(".bpmnb").hasClass("text-success")) {
										$("#other_Detail_" + whois + " #od_bpm_status select").val("Add");
									} else if (other_BPM_R.find(".bpmnb").hasClass("text-warning")) {
										$("#other_Detail_" + whois + " #od_bpm_status select").val("Modify");
									} else if (other_BPM_R.find(".bpmnb").hasClass("text-danger")) {
										$("#other_Detail_" + whois + " #od_bpm_status select").val("Delete");
									}
								} else if (whois === "BPR") {
									if (other_BPM_R.find(".bprname").hasClass("text-success")) {
										$("#other_Detail_" + whois + " #od_bpr_status select").val("Add");
									} else if (other_BPM_R.find(".bprname").hasClass("text-warning")) {
										$("#other_Detail_" + whois + " #od_bpr_status select").val("Modify");
									} else if (other_BPM_R.find(".bprname").hasClass("text-danger")) {
										$("#other_Detail_" + whois + " #od_bpr_status select").val("Delete");
									}
								}

								//關閉選取
								$("#other_" + whois + " tbody input").attr("disabled", "disabled");
							}
							break;
						case "btn_bpr_back":
						case "btn_bpm_back":
							//返回-暫存->歸還的對象?
							let od_bpmr_nb = "";
							let od_bpmr_model = "";
							let od_bpmr_type = "";
							let checkedsize = 0;
							//標記顏色
							let bpmr_nbParent = "";
							let b_w = "";
							let b_w_m = "";
							let b_p_s = "";
							if (clickId === "btn_bpm_back") {
								//異常觸發?是否選取?
								od_bpmr_nb = $('#od_bpm_nb input').val();
								od_bpmr_model = $('#od_bpm_model input').val();
								od_bpmr_type = $('#od_bpm_type option:selected').val();
								checkedsize = $("#other_BPM tbody input:checked").length;
								//標記顏色
								bpmr_nbParent = $("#other_BPM tbody input:checked").parent().parent().parent();
								bpmr_nbParent.find(".bpmnb").removeClass("text-success").removeClass("text-warning").removeClass("text-danger");
								b_w = "BPM";
								b_w_m = "bpm";
								b_p_s = "other_BPS";
							} else {
								//異常觸發?是否選取?
								od_bpmr_nb = $('#od_bpr_name input').val();
								od_bpmr_model = $('#od_bpr_model input').val();
								od_bpmr_type = $('#od_bpr_type option:selected').val();
								checkedsize = $("#other_BPR tbody input:checked").length;
								//標記顏色
								bpmr_nbParent = $("#other_BPR tbody input:checked").parent().parent().parent();
								bpmr_nbParent.find(".bprname").removeClass("text-success").removeClass("text-warning").removeClass("text-danger");
								b_w = "BPR";
								b_w_m = "bpr";
								b_p_s = "other_BPR_BPS";
							}
							switch ($("#other_Detail_" + b_w + " #od_" + b_w_m + "_status select").val()) {
								case "Add":
									//檢查是否有資料?
									if (checkedsize === 0 || od_bpmr_nb == "" || od_bpmr_model == "" || od_bpmr_type == "") {
										return false;
									}
									bpmr_nbParent.find("." + b_w_m + "nb").addClass("text-success");
									bpmr_nbParent.find("." + b_w_m + "name").addClass("text-success");
									break;
								case "Modify":
									//檢查是否有資料?
									if (checkedsize === 0 || od_bpmr_nb == "" || od_bpmr_model == "" || od_bpmr_type == "") {
										return false;
									}
									bpmr_nbParent.find("." + b_w_m + "nb").addClass("text-warning");
									bpmr_nbParent.find("." + b_w_m + "name").addClass("text-warning");
									break;
								case "Delete":
									bpmr_nbParent.find("." + b_w_m + "nb").addClass("text-danger");
									bpmr_nbParent.find("." + b_w_m + "name").addClass("text-danger");
									break;
								case "":
									//""不""檢查是否有資料?
									//開啟選取
									if (clickId === "btn_bpm_back") {
										$("#other_" + b_w + " tbody .bpmnb").each(o => {
											//解所選項
											if ($($("#other_" + b_w + " tbody .bpmnb")[o]).text() !== "") {
												$($("#other_" + b_w + " tbody .bpmnb")[o]).parent().find("input").removeAttr("disabled");
											}
										});
									} else {
										$("#other_" + b_w + " tbody .bprname").each(o => {
											//解所選項
											if ($($("#other_" + b_w + " tbody .bprname")[o]).text() !== "") {
												$($("#other_" + b_w + " tbody .bprname")[o]).parent().find("input").removeAttr("disabled");
											}
										});
									}
									//初始化
									$("#other_Detail_" + b_w + " #od_" + b_w_m + "_model input").val("");
									$("#other_Detail_" + b_w + " #od_" + b_w_m + "_nb input").val("");
									$("#other_Detail_" + b_w + " #od_" + b_w_m + "_type select").val("");
									$("#other_Detail_" + b_w + " #od_" + b_w_m + "_sys_note textarea").val("");
									$("#other_Detail_" + b_w + " #od_" + b_w_m + "_status select").val("");
									$("#other_Detail_" + b_w + " .detailTbodyTr").remove();
									//細節移除
									$("#other_Detail_" + b_w + "_od #other_BIS .valTbodyTr").remove();
									if (!$("#other_Detail_" + b_w + "_od #other_BIS").hasClass("d-none")) {
										$("#other_Detail_" + b_w + "_od #other_BIS").addClass("d-none");
										$("#other_Detail_" + b_w + "_od #other_Detail_" + b_w + "_info").removeClass("d-none");

									}
									//參數
									$("#" + b_p_s + " tbody tr input:checked").prop("checked", false);
									$("#" + b_p_s + " tbody tr input").val("");
									$("#" + b_p_s + " tbody tr select").val("");
									$("#other_Detail_" + b_w + "_od #other_BIS .valTbodyTr").remove();
									//回至清單->觸發開關->開啟
									if (!$("#other_" + b_w + "_open").hasClass("show")) {
										$("#other_" + b_w + " .bi-dash-square").trigger("click");
									}
									return false;
									break;
							}
							//開啟選取
							if (clickId === "btn_bpm_back") {
								$("#other_" + b_w + " tbody .bpmnb").each(o => {
									//解所選項
									if ($($("#other_" + b_w + " tbody .bpmnb")[o]).text() !== "") {
										$($("#other_" + b_w + " tbody .bpmnb")[o]).parent().find("input").removeAttr("disabled");
									}
								});
							} else {
								$("#other_" + b_w + " tbody .bprname").each(o => {
									//解所選項
									if ($($("#other_" + b_w + " tbody .bprname")[o]).text() !== "") {
										$($("#other_" + b_w + " tbody .bprname")[o]).parent().find("input").removeAttr("disabled");
									}
								});
							}
							//回存資料
							let bpmbisitem = {};//結構化
							let bpmbasicSort = {};//排序?
							bpmbisitem.items = [];
							bpmbisitem.basic = [];
							let bpmbisitemOne = {}
							let bis = other.data.otherItemPageSet.entityOther['BIS'];
							$("#other_Detail_" + b_w + " .detailTbodyTr").each(s => {
								let detail = $($("#other_Detail_" + b_w + " .detailTbodyTr")[s]);
								let bisgid = detail.find(".bisgname select").val();

								let bisid = detail.find(".bisfname select").val();
								let bisnb = detail.find(".bisnb input").val();
								let bisname = detail.find(".bisname input").val();
								let bisgname = detail.find(".bisgname select option:selected").text();
								let bisfname = detail.find(".bisfname select option:selected").text();
								bisfname = JSON.stringify(bisfname.split(" , "));
								let bisgfname = detail.find(".bisgfname input").val();
								let bissdescripion = detail.find(".bissdescripion input").val();
								let bisqty = detail.find(".bisqty input").val();
								let bisprocess = detail.find(".bisprocess input").val();
								//一般選項資料
								if (bisgid !== "0" && bisgid !== "" && bisid !== "" && bisqty !== "") {
									bpmbisitemOne = {};
									bpmbisitemOne.bisid = bisid;
									bpmbisitemOne.bisgid = bisgid;
									bpmbisitemOne.bisnb = bisnb;
									bpmbisitemOne.bisname = bisname;
									bpmbisitemOne.bisqty = bisqty;
									bpmbisitemOne.bisgname = bisgname;
									bpmbisitemOne.bisgfname = bisgfname;
									bpmbisitemOne.bisfname = bisfname;
									bpmbisitemOne.bissdescripion = bissdescripion;
									bpmbisitemOne.bisprocess = bisprocess;
									//bpmbisitem.items.push(bpmbisitemOne);
									//====排序====
									const result = bis.filter(item => item.bisgid + "" === bisgid);
									let key = result[0].syssort.toString().padStart(3, '0') + "_sort_" + bisfname;
									console.log(key);
									bpmbasicSort[key] = bpmbisitemOne;
								} else if (bisid === "0") {
									//基本資料
									bpmbisitem.basic = bisnb.split(',').length > 0 ? bisnb.split(',') : [];
								}
							});
							//========排序整理========
							bpmbasicSort = main.methods.orderedSort(bpmbasicSort);
							Object.entries(bpmbasicSort).forEach(([key, value]) => {
								bpmbisitem.items.push(value);
							});

							//參數
							let bpmbpsnv = [];
							$("#" + b_p_s + " tbody tr input:checked").each(r => {
								let trBPS = $($("#" + b_p_s + " tbody tr input:checked")[r]).parent().parent().parent();
								let name = trBPS.find(".bpsname").text();
								let val = "";
								if (trBPS.find(".bpsval select").length === 1) {
									val = trBPS.find(".bpsval option:selected").val();
								} else {
									val = trBPS.find(".bpsval input").val();
								}
								//不能是空值
								if (name !== "" && val !== "") {
									name = name + "_" + val;
									bpmbpsnv.push(name);
								}
							});
							console.log(bpmbisitem);
							//帶回資料
							if (clickId === "btn_bpm_back") {
								bpmr_nbParent.find("." + b_w_m + "nb").text($("#od_" + b_w_m + "_nb input").val());
							} else {
								bpmr_nbParent.find("." + b_w_m + "name").text($("#od_" + b_w_m + "_name input").val());
							}
							bpmr_nbParent.find("." + b_w_m + "model").text($("#od_" + b_w_m + "_model input").val());
							bpmr_nbParent.find("." + b_w_m + "typename").text($("#od_" + b_w_m + "_type option:selected").text());
							bpmr_nbParent.find("." + b_w_m + "type").text($("#od_" + b_w_m + "_type option:selected").val());
							bpmr_nbParent.find(".sysnote").text($("#od_" + b_w_m + "_sys_note textarea").val());
							bpmr_nbParent.find("." + b_w_m + "bisitem").text(JSON.stringify(bpmbisitem));
							bpmr_nbParent.find("." + b_w_m + "bpsnv").text(JSON.stringify(bpmbpsnv));

							//初始化
							if (clickId === "btn_bpm_back") {
								$("#other_Detail_" + b_w + " #od_" + b_w_m + "_nb input").val("");
							} else {
								$("#other_Detail_" + b_w + " #od_" + b_w_m + "_name input").val("");
							}
							$("#other_Detail_" + b_w + " #od_" + b_w_m + "_model input").val("");
							$("#other_Detail_" + b_w + " #od_" + b_w_m + "_type select").val("");
							$("#other_Detail_" + b_w + " #od_" + b_w_m + "_sys_note textarea").val("");
							$("#other_Detail_" + b_w + " #od_" + b_w_m + "_status select").val("");
							$("#other_Detail_" + b_w + " .detailTbodyTr").remove();
							$("#other_Detail_" + b_w + "_od #other_BIS .valTbodyTr").remove();
							//細節移除
							$("#other_Detail_" + b_w + "_od #other_BIS .valTbodyTr").remove();
							if (!$("#other_Detail_" + b_w + "_od #other_BIS").hasClass("d-none")) {
								$("#other_Detail_" + b_w + "_od #other_BIS").addClass("d-none");
								$("#other_Detail_" + b_w + "_od #other_Detail_" + b_w + "_info").removeClass("d-none");

							}
							//參數
							$("#" + b_p_s + " tbody tr input:checked").prop("checked", false);
							$("#" + b_p_s + " tbody tr input").val("");
							$("#" + b_p_s + " tbody tr select").val("");
							$("#other_Detail_" + b_w + "_od #other_BIS .valTbodyTr").remove();

							//回至清單->觸發開關->開啟
							if (!$("#other_" + b_w + "_open").hasClass("show")) {
								$("#other_" + b_w + " .bi-dash-square").trigger("click");
							}

							break;
						case "btn_send":
							//必須含有searchVal 的才算
							let focusedElementParent = $(document.activeElement.parentElement.parentElement.parentElement.parentElement);
							let focusedElement = $(document.activeElement);
							//查詢
							if (focusedElement.is('input.searchVal, select.searchVal') && focusedElementParent != null) {
								console.log(focusedElementParent.attr("id"));
								console.log(focusedElement.attr("id"));
								other.methods.confirmSend("Search", focusedElementParent.attr("id"));
							}
							break;
						case "btn_bbi_format":
							//轉換格式Fromat BOM BPM
							//let entityJsons = JSON.parse(other.data.entityFormatJson['BBI']);
							//entityJsons[''];
							let checkedBBI = $("#other_BBI tbody input:checked").map(function () {
								return $(this).attr("title"); // 或者 $(this).attr("你的屬性名稱") 來取得特定屬性
							}).get();
							console.log(checkedBBI); // 勾選的值清單
							if (checkedBBI.length > 0) {
								//初始化
								$('#other_BPM tbody .bpmnb').removeClass("text-success");
								$('#other_BPM tbody .bpmnb').removeClass("text-warning");
								$('#other_BPM tbody .bpmnb').removeClass("text-danger");
								$('#other_BPM tbody input').attr('disabled', 'disabled');
								$('#other_BPM tbody .valTbodytd').text("");
								$('#other_BPM tbody th input').prop('checked', false);

								//帶入資料
								let new_i = 1;
								let bpmbasicSort = {};
								//要帶入的項目
								let bisname = other.data.otherItemPageSet.entityOther['BIS'];
								//所有 取得的資料(料BOM)
								let entityJsons = other.data.otherItemPageSet.entityOther['BBIDetail'];
								//每一項
								checkedBBI.forEach(i => {
									console.log(i);
									let bbi = $("#other_BBI tbody ." + i);
									let bpm = $("#other_BPM tbody .valTbodyTr_" + new_i);
									let bbisn = bbi.find(".bbisn").text();
									bpm.find(".bpmnb").text(bbisn);
									bpm.find(".bpmmodel").text("");
									bpm.find(".bpmtypename").text("產品BOM");
									bpm.find(".bpmtype").text("1");
									bpm.find("input").removeAttr('disabled');
									//所有正規化選項
									let bpmbisitem = {};//結構化
									bpmbisitem.items = [];
									bpmbisitem.basic = [];
									let bpmbisitemOne = {}
									entityJsons.forEach(s => {
										//取得該成品BOM下的 物料匹配
										if (s['bbisn'] === bbisn) {
											//console.log(s['bbiisn']);
											//items:取得該物料 匹配項目
											let checkIsbasic = true;
											bisname.forEach(bs => {
												if (s['bbiisn'] === bs['bisnb']) {
													console.log(bs['bisfname']);
													bpmbisitemOne = {};
													bpmbisitemOne.bisid = bs['bisid'];
													bpmbisitemOne.bisgid = bs['bisgid'];
													bpmbisitemOne.bisnb = bs['bisnb'];
													bpmbisitemOne.bisname = bs['bisname'];
													bpmbisitemOne.bisqty = 1;
													bpmbisitemOne.bisgname = bs['bisgname'];
													bpmbisitemOne.bisgfname = bs['bisgfname'];
													bpmbisitemOne.bisfname = bs['bisfname'];
													bpmbisitemOne.bisprocess = s['bbiiprocess'];
													bpmbisitemOne.bissdescripion = bs['bissdescripion'];
													bpmbasicSort[bs['syssort'].toString().padStart(3, '0') + "_sort"] = bpmbisitemOne;
													//
													checkIsbasic = false;
													return false;
												}
											});
											//basic:其他基本資料
											if (checkIsbasic) {
												bpmbisitem.basic.push(s['bbiisn'] + "_" + s['bbiiqty'] + "_" + s['bbiiprocess']);
											}
										}
									});
									//排序整理
									bpmbasicSort = main.methods.orderedSort(bpmbasicSort);
									Object.entries(bpmbasicSort).forEach(([key, value]) => {
										bpmbisitem.items.push(value);
									});

									bpm.find(".bpmbisitem").text(JSON.stringify(bpmbisitem));
									bpm.find(".bpmbpsnv").text("[]"); //配置參數
									bpm.find("input").attr("title", "valTbodyTr_" + new_i);
									bpm.find(".bpmnb").addClass("text-success");
									new_i++;
								});
								//觸發開關
								$("#other_BBI .bi-dash-square").trigger("click");
								//關閉
								if ($("#other_c #other_BPR_open").hasClass("show")) {
									$("#other_c #other_BPR >div>.bi-dash-square").trigger("click");
								}
								if ($("#other_c #other_Detail_BPR_open").hasClass("show")) {
									$("#other_c #other_Detail_BPR_od>div>.bi-dash-square").trigger("click");
								}
								//開啟
								if (!$("#other_c #other_BPM_open").hasClass("show")) {
									$("#other_c #other_BPM >div>.bi-dash-square").trigger("click");
								}
								if (!$("#other_c #other_Detail_BPM_open").hasClass("show")) {
									$("#other_c #other_Detail_BPM_od>div>.bi-dash-square").trigger("click");
								}
							}
							break;
						case "btn_bbi_rules":
							//轉換格式Fromat BOM BPM
							//let rulesEntityJsons = JSON.parse(other.data.entityFormatJson['BBI']);
							//rulesEntityJsons[''];
							let rulesCheckedBBI = $("#other_BBI tbody input:checked").map(function () {
								return $(this).attr("title"); // 或者 $(this).attr("你的屬性名稱") 來取得特定屬性
							}).get();
							console.log(rulesCheckedBBI); // 勾選的值清單
							if (rulesCheckedBBI.length > 0) {
								//初始化
								$('#other_BPR tbody .bprname').removeClass("text-success");
								$('#other_BPR tbody .bprname').removeClass("text-warning");
								$('#other_BPR tbody .bprname').removeClass("text-danger");
								$('#other_BPR tbody input').attr('disabled', 'disabled');
								$('#other_BPR tbody .valTbodytd').text("");
								$('#other_BPR tbody th input').prop('checked', false);

								//帶入資料
								let new_i = 1;
								let bprbasicSort = {};
								//要帶入的項目
								let bisname = other.data.otherItemPageSet.entityOther['BIS'];
								//所有 取得的資料(料BOM)
								let rulesEntityJsons = other.data.otherItemPageSet.entityOther['BBIDetail'];
								rulesCheckedBBI.forEach(i => {
									console.log(i);
									let bbi = $("#other_BBI tbody ." + i);
									let bpr = $("#other_BPR tbody .valTbodyTr_" + new_i);
									let bbisn = bbi.find(".bbisn").text();
									bpr.find(".bprname").text(bbisn);
									bpr.find(".bprtypename").text("產品BOM");
									bpr.find(".bprtype").text("1");
									bpr.find("input").removeAttr('disabled');
									//所有正規化選項
									let bprbisitem = {};//結構化
									bprbisitem.items = [];
									bprbisitem.basic = [];
									let bprbisitemOne = {}
									rulesEntityJsons.forEach(s => {
										//取得該成品BOM下的 物料匹配
										if (s['bbisn'] === bbisn) {
											//console.log(s['bbiisn']);
											//items:取得該物料 匹配項目
											let checkIsbasic = true;
											bisname.forEach(bs => {
												if (s['bbiisn'] === bs['bisnb']) {
													console.log(bs['bisfname']);
													bprbisitemOne = {};
													bprbisitemOne.bisid = bs['bisid'];
													bprbisitemOne.bisgid = bs['bisgid'];
													bprbisitemOne.bisnb = bs['bisnb'];
													bprbisitemOne.bisname = bs['bisname'];
													bprbisitemOne.bisqty = 1;
													bprbisitemOne.bisgname = bs['bisgname'];
													bprbisitemOne.bisgfname = bs['bisgfname'];
													bprbisitemOne.bisfname = bs['bisfname'];
													bprbisitemOne.bisprocess = s['bbiiprocess'];
													bprbisitemOne.bissdescripion = bs['bissdescripion'];
													bprbisitemOne.biswhere = [];//物料號_正負_數量,.....
													bprbasicSort[bs['syssort'].toString().padStart(3, '0') + "_sort"] = bprbisitemOne;
													//
													checkIsbasic = false;
													return false;
												}
											});
											//basic:其他基本資料
											if (checkIsbasic) {
												bprbisitem.basic.push(s['bbiisn'] + "_" + s['bbiiqty'] + "_" + s['bbiiprocess']);
											}
										}
									});
									//排序整理
									bprbasicSort = main.methods.orderedSort(bprbasicSort);
									Object.entries(bprbasicSort).forEach(([key, value]) => {
										bprbisitem.items.push(value);
									});
									bpr.find(".bprbisitem").text(JSON.stringify(bprbisitem));
									bpr.find(".bprbpsnv").text("[]"); //配置參數
									bpr.find("input").attr("title", "valTbodyTr_" + new_i);
									bpr.find(".bprname").addClass("text-success");
									new_i++;
								});
								//觸發開關
								$("#other_BBI .bi-dash-square").trigger("click");
								//開啟
								if (!$("#other_BPR_open").hasClass("show")) {
									$("#other_BPR>div>.bi-dash-square").trigger("click");
								}
								if (!$("#other_Detail_BPR_open").hasClass("show")) {
									$("#other_Detail_BPR_od>div>.bi-dash-square").trigger("click");
								}
								//關閉
								if ($("#other_BPM_open").hasClass("show")) {
									$("#other_BPM>div>.bi-dash-square").trigger("click");
								}
								if ($("#other_Detail_BPM_open").hasClass("show")) {
									$("#other_Detail_BPM_od>div>.bi-dash-square").trigger("click");
								}
							}
							break;
						case "btn_bpm_excel":
							//Excel
							let trItem = {};//{成品BOM號:[物料號_數量_製程]....}
							let trItems = [];
							let other_BPM = "";
							let excelBPM = $("#other_BPM tbody input:checked").map(function () {
								return $(this).attr("title"); // 或者 $(this).attr("你的屬性名稱") 來取得特定屬性
							}).get();
							//單選
							if (excelBPM.length > 0) {
								trItem = {};//{成品BOM號:[物料號_數量_製程]....}
								other_BPM = $('#other_BPM .' + excelBPM[0]);
								//取出分析
								let bpmnb = other_BPM.find('.bpmnb').text();
								let bpmbisitem = JSON.parse(other_BPM.find('.bpmbisitem').text());
								//每一筆
								bpmbisitem.items.forEach(itemOne => {
									bpmbisitem.basic.push(itemOne.bisnb + "_" + itemOne.bisqty + "_" + itemOne.bisprocess);
								});
								//排序
								bpmbisitem.basic = bpmbisitem.basic.sort();

								trItem[bpmnb] = bpmbisitem.basic;
								console.log(trItem);
								other.methods.readExcelFromURL(trItem);
							} else {
								//全選(沒有選擇則全選了)
								excelBPM = $("#other_BPM tbody input:not(:disabled)").map(function () {
									return $(this).attr("title"); // 或者 $(this).attr("你的屬性名稱") 來取得特定屬性
								}).get();
								//每張
								excelBPM.forEach(f => {
									trItem = {};//{成品BOM號:[物料號_數量_製程]....}
									other_BPM = $('#other_BPM .' + f);
									//取出分析
									let bpmnb = other_BPM.find('.bpmnb').text();
									let bpmbisitem = JSON.parse(other_BPM.find('.bpmbisitem').text());
									//每一筆
									bpmbisitem.items.forEach(itemOne => {
										bpmbisitem.basic.push(itemOne.bisnb + "_" + itemOne.bisqty + "_" + itemOne.bisprocess);
									});
									trItem[bpmnb] = bpmbisitem.basic;
									console.log(trItem);
									other.methods.readExcelFromURL(trItem);
								});
							}
							break;
						case "other_BBI_exthClearAll":
							//都有勾選?
							let clickAll = true;
							$("#other_BBI_open .exTbodyTh").each(function () {
								let checkBBIAll = $(this).find("input");
								if (checkBBIAll.attr("disabled") != "disabled" && checkBBIAll.prop("checked") == false) {
									checkBBIAll.trigger("click");
									clickAll = false;
								}
							});
							//全部取消?
							if (clickAll) {
								$("#other_BBI_open .exTbodyTh").find("input").trigger("click");
								return false;
							}
							break;
						case "other_BPM_exthClearAll":
							//可快速編輯內容
							$("#other_BPM_open .exTbodyTh").find("input").prop("checked", false);
							//換上顏色->切換模式->可直接編輯
							if ($("#other_BPM_open #other_BPM_exthClearAll").hasClass("btn-outline-dark")) {
								$("#other_BPM_open #other_BPM_exthClearAll").addClass("btn-outline-warning");
								$("#other_BPM_open #other_BPM_exthClearAll").removeClass("btn-outline-dark");
								$("#other_BPM_open #other_BPM_exthClearAll b").text("Ｍ");
								$("#other_BPM tbody tr").each(x => {
									let tr = $($("#other_BPM tbody tr")[x]);
									// 查找行內是否有未被 disabled 的 input
									if (tr.find("input:not(:disabled)").length > 0) {
										// 如果有未被 disabled 的 input，則設置相關單元格可編輯
										tr.find(".bpmnb, .bpmmodel, .sysnote").attr("contenteditable", "true");
									} else {
										// 如果所有 input 都是 disabled，則保持不可編輯
										tr.find(".bpmnb, .bpmmodel, .sysnote").attr("contenteditable", "false");
									}
								});
							} else {
								//關閉鎖定
								$("#other_BPM_open #other_BPM_exthClearAll").addClass("btn-outline-dark");
								$("#other_BPM_open #other_BPM_exthClearAll").removeClass("btn-outline-warning");
								$("#other_BPM_open #other_BPM_exthClearAll b").text("Ｌ");
								$("#other_BPM tbody tr").find(".bpmnb, .bpmmodel, .sysnote").attr("contenteditable", "false");
								//檢查是否修正?
							}
							return false;
							break;
						case "btn_bpr_generate":
							//產生多個BOM
							console.log("btn_bpr_generate");
							let checkedBPR = [];
							let g_BPR = "";
							//基礎資料
							let bprname = "";
							let bprmodel = "";
							let bprtype = "";
							let bprtypename = "";
							let sysnote = "";
							//結構資料
							let g_bpsnv = "";
							let g_bisitem = "";
							let g_groups = [];
							let g_spilt = {};

							checkedBPR = $("#other_BPR tbody input:checked").map(function () {
								return $(this).attr("title"); // 或者 $(this).attr("你的屬性名稱") 來取得特定屬性
							}).get();
							g_bpsnv = JSON.parse($("#other_BPR ." + checkedBPR + " .bprbpsnv").text());
							g_bisitem = JSON.parse($("#other_BPR ." + checkedBPR + ' .bprbisitem').text());
							//有勾選?
							if (checkedBPR.length > 0) {
								console.log(checkedBPR); // 打印勾選的值清單
								//一般-初始化(BPR)
								//資訊補充
								g_BPR = $("#other_BPR ." + checkedBPR);
								bprname = g_BPR.find(".bprname").text();
								bprmodel = g_BPR.find(".bprmodel").text();
								bprtype = g_BPR.find(".bprtype").text();
								bprtypename = g_BPR.find(".bprtypename").text();
								sysnote = g_BPR.find(".sysnote").text();

								//items:項目:
								g_bisitem.items.forEach(itemOne => {
									//有已經分配好的資料?
									let g_context = [];
									if (g_spilt[itemOne.bisgname] != null) {
										g_context = g_groups[g_spilt[itemOne.bisgname]];
										g_context.push(itemOne);
										g_groups[g_spilt[itemOne.bisgname]] = g_context;
									} else {
										g_spilt[itemOne.bisgname] = g_groups.length;
										g_context.push(itemOne);
										g_groups.push(g_context);
									}
								});
								//basic:基本:
								g_bisitem.basic;
								console.log(g_groups);
								//交叉組合(遞回結構)-> 呼叫交叉組合函數
								const combinations = other.methods.crossProduct(g_groups);
								console.log(combinations);
								//============轉入BOM Format============
								if (combinations.length > 0) {
									//初始化
									$('#other_BPM tbody .bpmnb').removeClass("text-success");
									$('#other_BPM tbody .bpmnb').removeClass("text-warning");
									$('#other_BPM tbody .bpmnb').removeClass("text-danger");
									$('#other_BPM tbody input').attr('disabled', 'disabled');
									$('#other_BPM tbody .valTbodytd').text("");
									$('#other_BPM tbody th input').prop('checked', false);

									//帶入資料
									let new_i = 1;
									let bpmbasicSort = {};
									//要帶入的項目
									let bisname = other.data.otherItemPageSet.entityOther['BIS'];
									//所有 取得的資料(料BOM)
									let rulesEntityJsons = other.data.otherItemPageSet.entityOther['BBIDetail'];
									combinations.forEach(i => {
										console.log(i);
										let bpm = $("#other_BPM tbody .valTbodyTr_" + new_i);
										bpm.find(".bpmnb").text(bprname + "_" + new_i);
										bpm.find(".bpmmodel").text(bprmodel);
										bpm.find(".bpmtypename").text(bprtypename);
										bpm.find(".bpmtype").text(bprtype);
										bpm.find("sysnote").text(sysnote);
										bpm.find("input").removeAttr('disabled');
										//所有正規化選項
										let bpmbisitem = {};//結構化
										bpmbisitem.items = i;
										bpmbisitem.basic = g_bisitem.basic;

										bpm.find(".bpmbisitem").text(JSON.stringify(bpmbisitem));
										bpm.find(".bpmbpsnv").text(JSON.stringify(g_bpsnv)); //配置參數
										bpm.find("input").attr("title", "valTbodyTr_" + new_i);
										bpm.find(".bpmnb").addClass("text-success");
										new_i++;
									});
									//關閉
									if ($("#other_c #other_BPR_open").hasClass("show")) {
										$("#other_c #other_BPR >div>.bi-dash-square").trigger("click");
									}
									if ($("#other_c #other_Detail_BPR_open").hasClass("show")) {
										$("#other_c #other_Detail_BPR_od>div>.bi-dash-square").trigger("click");
									}
									//開啟
									if (!$("#other_c #other_BPM_open").hasClass("show")) {
										$("#other_c #other_BPM >div>.bi-dash-square").trigger("click");
									}
									if (!$("#other_c #other_Detail_BPM_open").hasClass("show")) {
										$("#other_c #other_Detail_BPM_od>div>.bi-dash-square").trigger("click");
									}
								}
							}
							return false;
							break;
					}
				});
				//=====BOM Format list=====BPM-監聽直接改之變化(修改顏色)
				$(document).off("input", "#other_BPM tbody td");
				$(document).on('input', '#other_BPM tbody td', function (event) {
					console.log("修正");
					if (!$(this).parent().find(".bpmnb").hasClass("text-success")) {
						$(this).parent().find(".bpmnb").addClass("text-warning");
					}
				});
				//=====BOM Format detail=====Detail_BPM->選擇/輸入(有修改過)
				$(document).off("input", "#other_Detail_BPM_open input,select,textarea");
				$(document).on('input', '#other_Detail_BPM_open input,select,textarea', function (event) {
					//是否是None
					if (!$(this).parent().hasClass("bpm_status") && $('#other_Detail_BPM_open #od_bpm_status select').val() === "") {
						$('#other_Detail_BPM_open #od_bpm_status select').val("Modify").prop("checked", true);
					}
				});
				//=====BOM Rule detail=====Detail_BPR取得之前值->選擇
				$(document).off("input", "#other_Detail_BPR_open input,select,textarea");
				$(document).on('input', '#other_Detail_BPR_open input,select,textarea', function (event) {
					//是否是None
					if (!$(this).parent().hasClass("bpr_status") && $('#other_Detail_BPR_open #od_bpr_status select').val() === "") {
						$('#other_Detail_BPR_open #od_bpr_status select').val("Modify").prop("checked", true);
					}
				});
				//=====BOM Format detail=====Detail_BPM取得之前值->選擇
				let oldDes = "";//為了更新sysnote 備註資訊
				$(document).off("click", "#other_c #other_Detail_BPM_od select");
				$(document).on('click', '#other_c #other_Detail_BPM_od select', function (event) {
					//選擇了-子項目
					if ($(this.parentElement).hasClass("bisfname")) {
						let selected = $(this).find("option:selected");
						if (selected.attr('title') != null && selected.attr('title').split('<_>').length > 3) {
							oldDes = selected.attr('title').split('<_>')[3];
						} else {
							oldDes = "";
						}
					}
				});
				//=====BOM Format detail=====Detail_BPM/Detail_BPR-選擇
				$(document).off("change", "#other_c #other_Detail_BPM_od select,#other_Detail_BPR_od select");
				$(document).on("change", "#other_c #other_Detail_BPM_od select,#other_Detail_BPR_od select", function (event) {
					let selected = $(this).find("option:selected");
					let selectPePe = $(event.currentTarget.parentElement.parentElement);//該列資料(Tr)
					let checkBPM = selectPePe.parent().parent().parent().attr("id") === "other_Detail_BPM";
					//選擇了-群組項目
					if ($(this.parentElement).hasClass("bisgname")) {
						//該列資料的-子選項
						let bisfnames = selectPePe.find(".bisfname option");
						//console.log(bisfnames);
						//還原
						selectPePe.find(".bisfname .bisgid_0").prop('selected', true);
						selectPePe.find(".bisqty input").val(0);
						selectPePe.find(".bg-danger").removeClass("bg-danger");
						selectPePe.find(".bg-success").removeClass("bg-success");
						selectPePe.find(".bisnb input").val("");
						selectPePe.find(".bisname input").val("");
						selectPePe.find(".bissdescripion input").val("");
						selectPePe.find(".bisqty input").removeAttr("disabled");
						selectPePe.find(".bisfname select").removeAttr("disabled");
						selectPePe.find(".bisprocess input").removeAttr("disabled").val("ASM");
						//選項顯示/不顯示
						bisfnames.each((index) => {
							let bisfnameOne = $(bisfnames[index]);
							if (bisfnameOne.hasClass("bisgid_" + selected.val())) {
								bisfnameOne.removeClass("d-none");
							} else if (!bisfnameOne.hasClass("d-none") && !bisfnameOne.hasClass("bisgid_0")) {
								bisfnameOne.addClass("d-none");
							}
						});
						//如果是Basic 另外處裡
						if (selectPePe.find(".bisgname select").val() === "0") {
							selectPePe.find(".bisfname select").val("0");
							selectPePe.find(".bisqty input").val(1);
							selectPePe.find(".bisqty input").attr("disabled", "disabled");
							selectPePe.find(".bisfname select").attr("disabled", "disabled");
							selectPePe.find(".bisprocess input").attr("disabled", "disabled").val("");
						}
					}
					//選擇了-子項目
					if ($(this.parentElement).hasClass("bisfname")) {
						//console.log(selected);
						//還原
						selectPePe.find(".bg-success").removeClass("bg-success");
						selectPePe.find(".bg-danger").removeClass("bg-danger");
						selectPePe.find(".bisnb input").val("");
						selectPePe.find(".bisname input").val("");
						selectPePe.find(".bissdescripion input").val("");
						//數量判別 & 轉換提醒色彩
						if (selected.val() == -1) {//No
							selectPePe.find(".bisqty input").val(0);
							selectPePe.find(".bisqty").addClass("bg-danger");
							selectPePe.find(".bisfname").addClass("bg-danger");
							selectPePe.find(".bisgname").addClass("bg-danger");
						} else if (selectPePe.find(".bisqty input").val() <= 0) {//Yes or 其他選項
							selectPePe.find(".bisqty input").val(1);
							selectPePe.find(".bisqty").addClass("bg-success");
							selectPePe.find(".bisfname").addClass("bg-success");
							selectPePe.find(".bisgname").addClass("bg-success");
						} else if (selected.val() != "") {
							selectPePe.find(".bisqty").addClass("bg-success");
							selectPePe.find(".bisfname").addClass("bg-success");
							selectPePe.find(".bisgname").addClass("bg-success");
						}
						//自動帶入資料
						if (selected.val() != "") {
							selectPePe.find(".bisnb input").val(selected.attr('title').split('<_>')[0]);
							selectPePe.find(".bisname input").val(selected.attr('title').split('<_>')[1]);
							selectPePe.find(".bissdescripion input").val(selected.attr('title').split('<_>')[3]);
							selectPePe.find(".bisgfname input").val(selected.attr('title').split('<_>')[4]);

							//只有"Add狀態下+BPM"會寫入Sysnote
							if ($("#od_bpm_status .bpm_status select").val() === "Add" && checkBPM) {
								let od_bpm_sys_note = $("#other_Detail_BPM #od_bpm_sys_note textarea");
								let newDes = selected.attr('title').split('<_>')[3];
								console.log(oldDes + ":" + newDes);
								//新舊交替
								if (od_bpm_sys_note.val().search(oldDes) >= 0 && oldDes !== "") {
									od_bpm_sys_note.val(od_bpm_sys_note.val().replaceAll(oldDes, newDes));
								} else {
									od_bpm_sys_note.val(od_bpm_sys_note.val() + newDes);
								}
							}
						}
					}
				});
				//=====BOM/Rules Format detail=====BIS-打開編輯 細項目
				$(document).off("click", "#other_c #other_Detail_BPR tbody .bisnb input,#other_Detail_BPM tbody .bisnb input");
				$(document).on("click", "#other_c #other_Detail_BPR tbody .bisnb input,#other_Detail_BPM tbody .bisnb input", function (event) {
					if ($(event.target).val() !== null && $(event.target).val() !== "") {
						//other_Detail_BPM/other_Detail_BPR
						let whois = $(event.target).parent().parent().parent().parent().parent().attr("id");
						let other_BIS = "other_BIS";
						if (whois === "other_Detail_BPR") {//BPR規則的參數
							other_BIS = "other_BPR_BIS";
						}
						console.log(whois + ":" + $(event.target).val());
						//還原顏色
						$(event.target).removeClass("btn-outline-primary");
						$(event.target).removeClass("btn-outline-warning");
						//解鎖定
						$(event.target).parent().parent().parent().find(".detailTbodyTr").removeClass("locked-do");


						if ($("#other_c #" + whois + "_info").hasClass("d-none")) {
							//還原->存入
							$("#other_c #" + whois + "_od #" + other_BIS).addClass("d-none");
							$("#other_c #" + whois + "_od #" + whois + "_info").removeClass("d-none");
							$(event.target).addClass("btn-outline-primary");
							//是Basic
							if ($(event.target).parent().parent().find(".bisgname select").val() === "0") {
								let basics = [];
								$("#other_c #" + whois + "_od #" + other_BIS + " .valTbodyTr").each(r => {
									let valTbodyTr = $($("#other_c  #" + whois + "_od #" + other_BIS + " .valTbodyTr")[r]);
									let bisnb = valTbodyTr.find('.bisnb input').val();
									let bisqty = valTbodyTr.find('.bisqty input').val();
									let bisprocess = valTbodyTr.find('.bisprocess input').val();
									bisprocess = bisprocess == "" ? "ASM" : bisprocess;//預設ASM
									basics.push(bisnb + "_" + bisqty + "_" + bisprocess);
								});
								$(event.target).val(basics);
							}
						} else {
							//初始化內容
							$("#other_c #" + other_BIS + " .valTbodyTr").remove();
							//切換
							$("#other_c #" + other_BIS).removeClass("d-none");
							$("#other_c #" + whois + "_info").addClass("d-none");
							$(event.target).addClass("btn-outline-warning");
							//鎖定
							$(event.target).parent().parent().parent().find(".detailTbodyTr").addClass("locked-do");
							$(event.target).parent().parent().removeClass("locked-do");
							//是Basic
							if ($(event.target).parent().parent().find(".bisgname select").val() === "0") {
								let basics = $(event.target).val().split(",");
								basics.forEach(bs => {
									console.log(bs);
									let detailTbodyTr = $("#other_c #" + whois + "_od #" + other_BIS + " .exTbodyTr").clone();
									detailTbodyTr.removeClass('exTbodyTr');
									detailTbodyTr.removeClass('d-none');
									detailTbodyTr.addClass('valTbodyTr');
									detailTbodyTr.appendTo($("#other_c #" + whois + "_od #" + other_BIS + " tbody"));
									detailTbodyTr.find('.bisnb input').val(bs.split("_")[0]).trigger('input');
									detailTbodyTr.find('.bisnb li').first().trigger("click");
									detailTbodyTr.find('.bisqty input').val(bs.split("_")[1]);
									detailTbodyTr.find('.bisprocess input').val(bs.split("_")[2]);
								});
							}
						}
					}
				});
				//=====BOM Format detail=====BIS-物料快選
				$(document).off("input", "#other_c #other_BPR_BIS .valTbodyTr input,#other_BIS .valTbodyTr input");
				$(document).on('input', '#other_c #other_BPR_BIS .valTbodyTr input,#other_BIS .valTbodyTr input', function (event) {
					//如果是 物料號比對
					if (($(this).parent().hasClass("bisnb") || $(this).parent().hasClass("bisname"))) {
						console.log(event);
						//物料清單
						const query = $(this).val().toLowerCase();
						const ListData = other.data.otherItemPageSet.entityOther['WM'];
						const matches = [];
						let $bisList = "";
						//bisnb?bisname?
						if ($(this).parent().hasClass("bisnb")) {
							$bisList = $(this).parent().find(".bisnbList");
							$bisList.addClass("d-none");
							// 清空之前的建議清單
							$bisList.empty();
							//沒有資料?
							if (query === "") {
								return false;
							}
							// 遍歷 ListData 並進行比對key.toLowerCase().includes(query) || value.toLowerCase().includes(query)
							for (const [key, value] of Object.entries(ListData)) {
								if (key.toLowerCase().includes(query)) {
									matches.push({key, value});
									//最多顯示30筆
									if (matches.length > 30) {
										break;
									}
								}
							}
							// 將匹配結果添加到建議清單中
							let listItems = "";
							matches.forEach(item => {
								const listItem = $('<li class="btn btn-sm btn-outline-success p-1 m-1"></li>');
								listItem.text(item.key);
								listItem.attr("title", item.value);
								$bisList.append(listItem);
							});
						} else {
							$bisList = $(this).parent().find(".bisnameList");
							$bisList.addClass("d-none");
							// 清空之前的建議清單
							$bisList.empty();
							//沒有資料?
							if (query === "") {
								return false;
							}
							// 遍歷 ListData 並進行比對key.toLowerCase().includes(query) || value.toLowerCase().includes(query)
							for (const [key, value] of Object.entries(ListData)) {
								if (value.split("<_>")[1].toLowerCase().includes(query)) {
									matches.push({key, value});
									//最多顯示30筆
									if (matches.length > 30) {
										break;
									}
								}
							}
							// 將匹配結果添加到建議清單中
							let listItems = "";
							matches.forEach(item => {
								const listItem = $('<li class="btn btn-sm btn-outline-success p-1 m-1"></li>');
								listItem.text(item.value.split("<_>")[1]);
								listItem.attr("title", item.value);
								$bisList.append(listItem);
							});
						}
						if ($bisList.find('li').length > 0) {
							$bisList.removeClass("d-none");
						}
					}
				});
				//=====BOM Format detail=====BIS-物料快選讀取選項
				$(document).off("click", "#other_c #other_BIS .valTbodyTr li,#other_BPR_BIS .valTbodyTr li");
				$(document).on('click', '#other_c #other_BIS .valTbodyTr li,#other_BPR_BIS .valTbodyTr li', function (event) {
					let bisnb = $(this).attr("title").split("<_>")[0];
					let bisname = $(this).attr("title").split("<_>")[1];
					let valTbodyTr = $(this).parent().parent().parent();
					valTbodyTr.find(".bisnb input").val(bisnb);
					valTbodyTr.find(".bisname input").val(bisname);
					valTbodyTr.find(".bisnbList").empty();
					valTbodyTr.find(".bisnbList").addClass("d-none");
					valTbodyTr.find(".bisnameList").empty();
					valTbodyTr.find(".bisnameList").addClass("d-none");
				});
				//=====BOM Format detail=====BPM-新增
				$(document).off("click", "#other_Detail_BPM i,#other_Detail_BPR i");
				$(document).on("click", "#other_Detail_BPM i,#other_Detail_BPR i", function (event) {
					let target = $(event.currentTarget);
					let whois = $(event.currentTarget).attr("title");
					console.log(target.attr("title"));
					//新增
					if (target.hasClass("bi-plus-square")) {
						let odBPMTr = $('#' + whois + ' tbody tr');//目前的項目數量
						let bisgnameTr = $("#other_c #" + whois + " .exDetailTbodyTr .bisgname option");//群組項目數量
						//不可大於[群組項目數量]-whois=other_Detail_BPM
						if (whois === "other_Detail_BPM" && odBPMTr.length <= (bisgnameTr.length - 1)) {
							let detailTbodyTr = $("#other_c #" + whois + " .exDetailTbodyTr").clone();
							detailTbodyTr.removeClass('exDetailTbodyTr');
							detailTbodyTr.removeClass('d-none');
							detailTbodyTr.addClass('detailTbodyTr');
							detailTbodyTr.appendTo($("#other_c #" + whois + " tbody"));

							//抓取所有已選擇項目
							let readySelect = [];
							let readyBisgname = $('#' + whois + ' .detailTbodyTr .bisgname select');
							readyBisgname.each((e) => {
								readySelect.push($(readyBisgname[e]).val());
							});
							//自動選擇?
							detailTbodyTr.find(".bisgname option").each((s) => {
								//比對是否含有?
								let check = $(detailTbodyTr.find(".bisgname option")[s]);
								//不含有+不能是空
								if (!readySelect.includes(check.val()) && check.val() != "") {
									//console.log(check.val());
									detailTbodyTr.find(".bisgname select").val(check.val()).focus().trigger('change');
									return false;
								}
							});
						}
						//可大於[群組項目數量]-whois=other_Detail_BPR
						if (whois === "other_Detail_BPR") {
							let detailTbodyTr = $("#other_c #" + whois + " .exDetailTbodyTr").clone();
							detailTbodyTr.removeClass('exDetailTbodyTr');
							detailTbodyTr.removeClass('d-none');
							detailTbodyTr.addClass('detailTbodyTr');
							detailTbodyTr.appendTo($("#other_c #" + whois + " tbody"));

							//抓取所有已選擇項目
							let readySelect = [];
							let readyBisgname = $('#' + whois + ' .detailTbodyTr .bisgname select');
							readyBisgname.each((e) => {
								readySelect.push($(readyBisgname[e]).val());
							});
							//自動選擇?
							detailTbodyTr.find(".bisgname option").each((s) => {
								//比對是否含有?
								let check = $(detailTbodyTr.find(".bisgname option")[s]);
								//不含有+不能是空
								if (!readySelect.includes(check.val()) && check.val() != "") {
									//console.log(check.val());
									detailTbodyTr.find(".bisgname select").val(check.val()).focus().trigger('change');
									return false;
								}
							});
						}
					}
					//移除
					if (target.hasClass("bi-dash-square")) {
						$(this.parentElement.parentElement.parentElement).remove();
					}
				});
				//=====查詢面板=====輸入Enter-條件
				$(document).off("keyup", "#other_c input");
				$(document).on("keyup", "#other_c input", function (e) {
					let target = $(e.currentTarget);
					if (e.key === 'Enter' || e.keyCode === 13) {
						console.log($(e.currentTarget).attr("id"));
						$(e.currentTarget).select();
						//查詢
						if (target.hasClass("searchVal")) {
							$("#other_c #btn_send").trigger("click");
						}
					}
				});
			},
			//==========================遞迴結構==========================
			crossProduct(groups) {
				// 如果群組為空，返回空陣列
				if (groups.length === 0) return [[]];
				// 取得第一個群組的項目
				const firstGroup = groups[0];
				// 取得剩餘的群組
				const remainingGroups = groups.slice(1);
				// 遞歸生成剩餘群組的交叉組合
				const remainingCombinations = other.methods.crossProduct(remainingGroups);
				// 將第一個群組的每個項目與剩餘的組合進行拼接
				const result = [];
				firstGroup.forEach(item => {
					remainingCombinations.forEach(combination => {
						result.push([item, ...combination]);
					});
				});
				return result;
			},
			//==========================多程序執行==========================
			//syncEvent(執行的方法/判斷類型/特定資料傳入)
			syncEvent(event, eventName, eventVal) {
				//異步執行: sync or async codes
				return new Promise((resolve, reject) => {
					// 設置超時檢查
					const timeoutTimer = setTimeout(() => {
						reject("操作超時:" + eventName);
					}, 5000);
					//異步-事後接續動作(then(成功)/catch(異常)/finally(都會進去))
					setTimeout(() => {
						event(eventName, eventVal).then(result => {
							resolve(result);
						}).catch(error => {
							reject(error);
						}).finally(() => {
							clearTimeout(timeoutTimer); // 失敗/成功->時清除超時計時器
						});
					}, 0);
				});
			},
			//==========================Excel選取資料==========================
			async readExcelFromURL(trItem) {
				// 設定你的 Excel 檔案 URL-取得Excel 範例
				const url = './files/90-XXX-XXXXXXX.xlsx';
				//取得資料
				let bisnb = "";
				console.log(trItem);
				Object.keys(trItem).forEach(k => {
					bisnb = k;
				});
				try {
					// 使用 fetch API 讀取檔案
					const response = await fetch(url);
					if (!response.ok) throw new Error('Network response was not ok.');

					const arrayBuffer = await response.arrayBuffer();

					// 使用 ExcelJS 讀取
					const workbook = new ExcelJS.Workbook();
					await workbook.xlsx.load(arrayBuffer);

					// 遍歷讀取工作表中的數據
					const worksheet = workbook.getWorksheet(1); // 假設讀取第一個工作表
					worksheet.eachRow((row, rowNumber) => {
						// 修改某些單元格的值，例如修改第一列第一行
						if (rowNumber > 1 && trItem[bisnb].length > rowNumber - 2) {
							row.getCell(2).value = trItem[bisnb][rowNumber - 2].split("_")[0];//物料號
							row.getCell(3).value = trItem[bisnb][rowNumber - 2].split("_")[1];//數量
							row.getCell(9).value = trItem[bisnb][rowNumber - 2].split("_")[2];//製程別
						}
						//console.log('Row ' + rowNumber + ' = ' + JSON.stringify(row.values));
					});
					//YYYY-MM-dd 格式顯示
					//const today = new Date();
					//const year = today.getFullYear();
					//const month = String(today.getMonth() + 1).padStart(2, '0'); // 月份從0開始，所以要加1
					//const day = String(today.getDate()).padStart(2, '0');
					//let YYYY_MM_dd = year + "-" + month + "-" + day;

					// 保存修改後的 Excel 檔案並提供下載
					const buffer = await workbook.xlsx.writeBuffer();
					const blob = new Blob([buffer], {type: 'application/vnd.openxmlformats-officedocument.spreadsheetml.sheet'});
					saveAs(blob, bisnb + '.xlsx');
				} catch (error) {
					console.error('讀取或處理 Excel 時出錯:', error);
				}
			},
			//==========================日期時間格式==========================
			datetimepickerDate() {
				$(".datetimepicker").remove();
				$('#other_c .datetimepicker_date').datetimepicker({
					format: 'yyyy-mm-dd hh:ii:00',
					pickerPosition: 'bottom-right',
					//minView:1,
					// hoursDisabled: [00, 1, 2, 3, 4, 5, 6],
					minuteStep: 30,
					autoclose: true,
					endDate: '+1d',
					datesDisabled: '+1d',
					todayBtn: true,
					bootcssVer: 5,
					//......可以同上項目代碼自定義設置
				});
				//時間格式
				$('#other_c .datetimepicker_time').datetimepicker({
					format: 'hh:ii',
					startView: 1,
					minuteStep: 30,
					pickDate: false,
					autoclose: true,
					timeFormat: 'hh:mm',
				});
			},
			//==========================傳送資料==========================
			confirmSend(kindId, whois, saveDatas) {
				//傳送資料
				let data = {};
				let req_data = {};
				let entityJsons = "";
				let entityDetailJsons = [];
				let entityDateTime = other.data.entityDateTime;
				let entityIKey = other.data.entityIKey;
				let entityGKey = other.data.entityGKey;
				switch (kindId) {
					case "Add":
						//==========================傳送對象-新增==========================
						entityJsons = [];
						//=============BPM=============
						if (saveDatas.length > 0 && whois === "BPM") {
							saveDatas.forEach(function (index) {
								console.log(index);
								entityFormatJson = JSON.parse(other.data.entityFormatJson['BPM']);
								//每一格資料
								$("#other_BPM").find('.' + index + ' .valTbodytd').each(function (ix) {
									let valTbodytd = $($("#other_BPM").find('.' + index + ' .valTbodytd')[ix]);
									let val = valTbodytd.text();
									let tit = valTbodytd.attr("title");
									//可能是時間格式
									if (entityDateTime.indexOf($(this).attr("title")) >= 0) {
										val = new Date(val).getTime();
									}
									entityFormatJson[tit] = val;
								});
								//而外抓取(群主)?
								entityJsons.push(entityFormatJson);
							});
							//傳送對象
							req_data['type'] = "POST";
							req_data['url'] = $('#nav_functional_unit').attr('title') + ".basil.AC";
							data['otherSet'] = whois;
							data['callBackFunction'] = "other_modify";
							//return false;
						}
						//=============BPR=============
						else if (saveDatas.length > 0 && whois === "BPR") {
							saveDatas.forEach(function (index) {
								console.log(index);
								entityFormatJson = JSON.parse(other.data.entityFormatJson['BPR']);
								//每一格資料
								$("#other_BPR").find('.' + index + ' .valTbodytd').each(function (ix) {
									let valTbodytd = $($("#other_BPR").find('.' + index + ' .valTbodytd')[ix]);
									let val = valTbodytd.text();
									let tit = valTbodytd.attr("title");
									//可能是時間格式
									if (entityDateTime.indexOf($(this).attr("title")) >= 0) {
										val = new Date(val).getTime();
									}
									entityFormatJson[tit] = val;
								});
								//而外抓取(群主)?
								entityJsons.push(entityFormatJson);
							});
							//傳送對象
							req_data['type'] = "POST";
							req_data['url'] = "bom_product_rule.basil.AC";
							data['otherSet'] = whois;
							data['callBackFunction'] = "other_modify";
							//return false;
						}
						break;
					case "Modify":
						//==========================傳送對象-修改==========================
						entityJsons = [];
						if (saveDatas.length > 0 && whois === "BPM") {
							saveDatas.forEach(function (index) {
								console.log(index);
								entityFormatJson = JSON.parse(other.data.entityFormatJson['BPM']);
								//每一格資料
								$("#other_BPM").find('.' + index + ' .valTbodytd').each(function (ix) {
									let valTbodytd = $($("#other_BPM").find('.' + index + ' .valTbodytd')[ix]);
									let val = valTbodytd.text();
									let tit = valTbodytd.attr("title");
									//可能是時間格式
									if (entityDateTime.indexOf($(this).attr("title")) >= 0) {
										val = new Date(val).getTime();
									}
									entityFormatJson[tit] = val;
								});
								//而外抓取(群主)?
								entityJsons.push(entityFormatJson);
							});
							//傳送對象
							req_data['type'] = "PUT";
							req_data['url'] = $('#nav_functional_unit').attr('title') + ".basil.AU";
							data['otherSet'] = whois;
							data['callBackFunction'] = "other_modify";
							//return false;
						}

						//=============BPR=============
						else if (saveDatas.length > 0 && whois === "BPR") {
							saveDatas.forEach(function (index) {
								console.log(index);
								entityFormatJson = JSON.parse(other.data.entityFormatJson['BPR']);
								//每一格資料
								$("#other_BPR").find('.' + index + ' .valTbodytd').each(function (ix) {
									let valTbodytd = $($("#other_BPR").find('.' + index + ' .valTbodytd')[ix]);
									let val = valTbodytd.text();
									let tit = valTbodytd.attr("title");
									//可能是時間格式
									if (entityDateTime.indexOf($(this).attr("title")) >= 0) {
										val = new Date(val).getTime();
									}
									entityFormatJson[tit] = val;
								});
								//而外抓取(群主)?
								entityJsons.push(entityFormatJson);
							});
							//傳送對象
							req_data['type'] = "PUT";
							req_data['url'] = "bom_product_rule.basil.AU";
							data['otherSet'] = whois;
							data['callBackFunction'] = "other_modify";
							//return false;
						}

						break;
					case "Remove":
						//==========================傳送對象-移除==========================
						entityJsons = [];
						if (saveDatas.length > 0 && whois === "BPM") {
							saveDatas.forEach(function (index) {
								console.log(index);
								entityFormatJson = JSON.parse(other.data.entityFormatJson['BPM']);
								//每一格資料
								$("#other_BPM").find('.' + index + ' .valTbodytd').each(function (ix) {
									let valTbodytd = $($("#other_BPM").find('.' + index + ' .valTbodytd')[ix]);
									let val = valTbodytd.text();
									let tit = valTbodytd.attr("title");
									//可能是時間格式
									if (entityDateTime.indexOf($(this).attr("title")) >= 0) {
										val = new Date(val).getTime();
									}
									entityFormatJson[tit] = val;
								});
								//而外抓取(群主)?
								entityJsons.push(entityFormatJson);
							});
							//傳送對象
							req_data['type'] = "DELETE";
							req_data['url'] = $('#nav_functional_unit').attr('title') + ".basil.DD";
							data['otherSet'] = whois;
							data['callBackFunction'] = "other_modify";
							//return false;
						} else if (saveDatas.length > 0 && whois === "BPR") {
							saveDatas.forEach(function (index) {
								console.log(index);
								entityFormatJson = JSON.parse(other.data.entityFormatJson['BPR']);
								//每一格資料
								$("#other_BPR").find('.' + index + ' .valTbodytd').each(function (ix) {
									let valTbodytd = $($("#other_BPR").find('.' + index + ' .valTbodytd')[ix]);
									let val = valTbodytd.text();
									let tit = valTbodytd.attr("title");
									//可能是時間格式
									if (entityDateTime.indexOf($(this).attr("title")) >= 0) {
										val = new Date(val).getTime();
									}
									entityFormatJson[tit] = val;
								});
								//而外抓取(群主)?
								entityJsons.push(entityFormatJson);
							});
							//傳送對象
							req_data['type'] = "DELETE";
							req_data['url'] = "bom_product_rule.basil.DD";
							data['otherSet'] = whois;
							data['callBackFunction'] = "other_modify";
							//return false;
						}
						break;
					case "Search":
						//==========================傳送對象-查詢==========================
						entityJsons = JSON.parse(other.data.entityFormatJson[whois]);
						$("#otherItemItem #" + whois + " .searchVal").each(function (index) {
							console.log(index + " : " + $(this).attr("id") + " : " + $(this).val());
							if ($(this).hasClass('datetimepicker_date') && $(this).val() != "") {
								entityJsons[$(this).attr("id").replaceAll("other_s_", "")] = new Date($(this).val()).getTime();
							} else {
								entityJsons[$(this).attr("id").replaceAll("other_s_", "")] = $(this).val() == "" ? null : $(this).val();
							}
						});
						req_data['type'] = "POST";
						req_data['url'] = $('#nav_functional_unit').attr('title') + ".basil.AR";
						data['otherSet'] = whois;
						data['callBackFunction'] = "other_search";
						//=============BPR=============
						if (whois === "BPR") {
							req_data['url'] = "bom_product_rule.basil.AR";
						}
						break;
					case "SearchWM":
						//==========================傳送對象-查詢(物料清單)==========================
						entityJsons = JSON.parse(other.data.entityFormatJson["BPM"]);
						$("#otherItemItem #BPM .searchVal").each(function (index) {
							console.log(index + " : " + $(this).attr("id") + " : " + $(this).val());
							if ($(this).hasClass('datetimepicker_date') && $(this).val() != "") {
								entityJsons[$(this).attr("id").replaceAll("other_s_", "")] = new Date($(this).val()).getTime();
							} else {
								entityJsons[$(this).attr("id").replaceAll("other_s_", "")] = $(this).val() == "" ? null : $(this).val();
							}
						});
						req_data['type'] = "POST";
						req_data['url'] = $('#nav_functional_unit').attr('title') + ".basil.WM";
						data['otherSet'] = whois;
						data['callBackFunction'] = "other_search";


						break;

				}
				console.log(entityJsons);
				console.log(entityDetailJsons);
				//包裝
				data['entityJson'] = JSON.stringify(entityJsons);
				//data['entityReportJson'] = JSON.stringify(entityDetailJsons);
				data['entityDetailJson'] = JSON.stringify(entityDetailJsons);
				req_data['data'] = data;
				//送出
				main.methods.ajaxSend(req_data, true);
				return false;
			},
			//==========================修改後回傳==========================
			otherModifyReturn() {
				let whois = main.resq_data['callBackValue'];
				if (whois === "BPM") {
					other.methods.confirmSend("Search", whois);
				} if (whois === "BPR") {
					other.methods.confirmSend("Search", whois);
				}
			},
			//==========================資料載入==========================
			otherReLoad(toWho, vals) {
				return new Promise((resolve, reject) => {
					try {
						//Step5.帶入資料
						let marks = other.data.marks;
						let entityJsons = other.data.otherItemPageSet.entityJsons;
						let entityIKey = other.data.entityIKey;
						let entityGKey = other.data.entityGKey;
						let entityDateTime = other.data.entityDateTime;
						let pageSize = other.data.otherItemPageSet.pageSize;//每頁數量(1-20)
						let pageNew = other.data.otherItemPageSet.pageNew - 1;//單前頁碼(1-50)
						let pageSN = pageSize * pageNew;//目前分頁->資料戳記
						let toWhoId = "";
						//判斷來源
						console.log("otherReLoad:" + toWho + ":" + vals);
						if (toWho === 'BBI') {
							entityJsons = other.data.otherItemPageSet.entityOther['BBI'];
							toWhoId = "BBI";
							pageSize = 200;
							entityIKey = other.data.entityIKey['BBI'];
							entityGKey = other.data.entityGKey['BBI'];
							$('#other_' + toWhoId + '_open table').scrollTop(0);

						} else if (toWho === 'BPR') {
							entityJsons = other.data.otherItemPageSet.entityOther['BPR'];
							toWhoId = "BPR";
							pageSize = 200;
							entityIKey = other.data.entityIKey['BPR'];
							entityGKey = other.data.entityGKey['BPR'];
							$('#other_' + toWhoId + '_open table').scrollTop(0);

						} else if (toWho === 'BPM') {
							entityJsons = other.data.otherItemPageSet.entity;
							toWhoId = "BPM";
							pageSize = 200;
							entityIKey = other.data.entityIKey['BPM'];
							entityGKey = other.data.entityGKey['BPM'];
							$('#other_' + toWhoId + '_open table').scrollTop(0);

						}

						//還原-值
						$('#other_' + toWhoId + '_open .valTbodytd').text("");
						$('#other_' + toWhoId + '_open .valTbodytd input').val("");
						$('#other_' + toWhoId + '_open .valTbodytd').removeClass("text-warning");
						$('#other_' + toWhoId + '_open .valTbodytd').removeClass("text-danger");
						$('#other_' + toWhoId + '_open .valTbodytd').removeClass("text-success");

						//勾選?
						$('#other_' + toWhoId + '_open .exTbodyTh input').attr("disabled", "disabled");
						$('#other_' + toWhoId + '_open .exTbodyTh input').attr("title", "IKey_GKey");
						$('#other_' + toWhoId + '_open .exTbodyTh input').prop("checked", false);
						//筆數
						for (let x = 0; x < pageSize; x++) {
							//筆數還夠
							if (pageSN + x < entityJsons.length) {
								let entity = entityJsons[pageSN + x];//((目前頁碼-1)*每頁數量)+x
								let iKey = "";
								let gKey = "";
								Object.keys(entity).forEach(function (k) {
									//欄位計數
									let valTrNb = x + 1;
									//是否時間格式?
									if (entityDateTime.indexOf(k) >= 0) {
										let dF = new Date(entity[k]);
										let dateF = dF.getFullYear() + "-";
										dateF += ((dF.getMonth() + 1) < 10 ? "0" + (dF.getMonth() + 1) : (dF.getMonth() + 1)) + "-";
										dateF += (dF.getDate() < 10 ? "0" + (dF.getDate()) : dF.getDate()) + " ";
										dateF += (dF.getHours() < 10 ? "0" + dF.getHours() : dF.getHours()) + ":";
										dateF += (dF.getMinutes() < 10 ? "0" + dF.getMinutes() : dF.getMinutes()) + ":";
										dateF += (dF.getSeconds() < 10 ? "0" + dF.getSeconds() : dF.getSeconds());
										$('#other_' + toWhoId + ' .valTbodyTr_' + valTrNb + ' .' + k).text(dateF);
									} else {
										$('#other_' + toWhoId + ' .valTbodyTr_' + valTrNb + ' .' + k).text(entity[k]);
									}
									//marks標記?
									$('#other_' + toWhoId + ' .valTbodyTr_' + valTrNb + ' input').removeAttr("disabled");
									$('#other_' + toWhoId + ' .valTbodyTr_' + valTrNb + ' input').attr("title", 'valTbodyTr_' + valTrNb);
								});
							} else {
								break;
							}
						}
						resolve("OK:" + toWho);
					} catch (error) {
						reject("操作失敗:" + error + ":" + toWho);
					}
				});
			},
			//==========================回傳接收==========================
			otherReturn() {
				//查詢回傳
				console.log("otherItemReturn");
				//Step4.分頁歸位
				other.data.otherItemPageSet.pageNew = 1; //單前頁碼(1-50)
				other.data.marks = {};//有選取的IKeyGKey
				other.data.markDetails = {};//有選取的IKeyGKey

				//Step5.帶入資料
				let whois = main.resq_data['callBackValue'];
				if (whois === "BBI") {
					other.data.otherItemPageSet.entityOther['BBIDetail'] = JSON.parse(main.resq_data['otherSet'])['BBIDetail'];
					other.data.otherItemPageSet.entityOther['BBI'] = JSON.parse(main.resq_data['otherSet'])['BBI'];
					//資料呈現
					const codeFunctionResultData = other.methods.otherReLoad;
					other.methods.syncEvent(codeFunctionResultData, "BBI", "");
				} else if (whois === "BPM") {
					other.data.otherItemPageSet.entity = JSON.parse(main.resq_data['entityJson']);
					other.data.otherItemPageSet.entityDetail = JSON.parse(main.resq_data['entityDetailJson']);
					//資料呈現
					const codeFunctionResultData = other.methods.otherReLoad;
					other.methods.syncEvent(codeFunctionResultData, "BPM", "");
					//關閉
					if ($("#other_c #other_BPR_open").hasClass("show")) {
						$("#other_c #other_BPR >div>.bi-dash-square").trigger("click");
					}
					if ($("#other_c #other_Detail_BPR_open").hasClass("show")) {
						$("#other_c #other_Detail_BPR_od>div>.bi-dash-square").trigger("click");
					}
					//開啟
					if (!$("#other_c #other_BPM_open").hasClass("show")) {
						$("#other_c #other_BPM >div>.bi-dash-square").trigger("click");
					}
					if (!$("#other_c #other_Detail_BPM_open").hasClass("show")) {
						$("#other_c #other_Detail_BPM_od>div>.bi-dash-square").trigger("click");
					}
				} else if (whois === "BPR") {
					other.data.otherItemPageSet.entityOther['BPR'] = JSON.parse(main.resq_data['otherSet'])['BPR'];
					//資料呈現
					const codeFunctionResultData = other.methods.otherReLoad;
					other.methods.syncEvent(codeFunctionResultData, "BPR", "");
					//關閉
					if (!$("#other_c #other_BPR_open").hasClass("show")) {
						$("#other_c #other_BPR >div>.bi-dash-square").trigger("click");
					}
					if (!$("#other_c #other_Detail_BPR_open").hasClass("show")) {
						$("#other_c #other_Detail_BPR_od>div>.bi-dash-square").trigger("click");
					}
					//開啟
					if ($("#other_c #other_BPM_open").hasClass("show")) {
						$("#other_c #other_BPM >div>.bi-dash-square").trigger("click");
					}
					if ($("#other_c #other_Detail_BPM_open").hasClass("show")) {
						$("#other_c #other_Detail_BPM_od>div>.bi-dash-square").trigger("click");
					}
				} else if (whois === "BPMWM") {
					//物料清單
					other.data.otherItemPageSet.entityOther['WM'] = JSON.parse(main.resq_data['otherSet'])['WM'];
					let entityJsons = other.data.otherItemPageSet.entityOther['WM'];
					//
					entityNewJsons = {};
					Object.keys(entityJsons).forEach(function (k) {
						entityNewJsons[entityJsons[k].wmpnb] =
							entityJsons[k].wmpnb + "<_>" + entityJsons[k].wmname + "<_>" +
							entityJsons[k].wmspecification + "<_>" + entityJsons[k].wmdescription;
					});
					//console.log(entityNewJsons);
					other.data.otherItemPageSet.entityOther['WM'] = entityNewJsons;
				}
			},
			//==========================初始化==========================
			destroy() {
				//銷毀
				$(document).off("keyup", "#other_c input");
				$(document).off("click", "#other_Detail_BPM i,#other_Detail_BPR i");
				$(document).off("click", "#other_c #other_BIS .valTbodyTr li,#other_BPR_BIS .valTbodyTr li");
				$(document).off("input", "#other_c #other_BPR_BIS .valTbodyTr input,#other_BIS .valTbodyTr input");
				$(document).off("click", "#other_c #other_Detail_BPR tbody .bisnb input,#other_Detail_BPM tbody .bisnb input");
				$(document).off("change", "#other_c #other_Detail_BPM_od select,#other_Detail_BPR_od select");
				$(document).off("click", "#other_c #other_Detail_BPM_od select");
				$(document).off("input", "#other_Detail_BPR_open input,select,textarea");
				$(document).off("input", "#other_Detail_BPM_open input,select,textarea");
				$(document).off("input", "#other_BPM tbody td");
				$(document).off("click", "#other_c button");

				console.log("other.html(destroy)");
			},
		},
	};
</script>