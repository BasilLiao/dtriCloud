<style>
/*Table 寬度滾動*/
#search_c .table-responsive {
	display: block;
	width: 100%;
	overflow-x: auto;
}

/*Table 自動隱藏*/
#search_c .table-responsive th, #search_c .table-responsive td {
	text-overflow: ellipsis;
	white-space: nowrap;
	overflow: hidden;
}

/*Table 表格固定*/
#search_c .fixedC1 {
	left: 0px;
	position: sticky;
}

#search_c .fixedCt {
	position: sticky;
	top: 0px;
	z-index: 5;
}

/*Table 每隔表格內_框線*/
#search_c .table-bordered td, #search_c .table-bordered th {
	border: 1px solid #1b76fd;
	padding: 2px;
}

/*Table 表格外框線*/
#search_c #search_cr table {
	min-height: 200px;
	max-height: 320px;
	border-collapse: separate;
	border-spacing: 0px;
}

/*Table 表格內 背景色*/
#search_c .table-white {
	--bs-table-bg: #fff;
}

/*覆寫換色*/
.table-hover>tbody>tr:hover>* {
	--bs-table-accent-bg: #0d6efd40;
	color: var(--bs-table-hover-color);
}

/*標題色彩*/
#search_c .title_color {
	background-color: #cfe2ff;
}

#search_c .pink_color {
	background-color: var(--bs-orange);
}
/*限用表格*/
.only_brm {
	border-right: 1px solid #000000;
	border-bottom: 1px solid #000000;
}

.only_br {
	border-right: 1px solid #000000;
}

.only_lr {
	width: 12px;
	text-align: center;
	writing-mode: vertical-lr;
	font-size: 8px;
	border: 1px solid #000000;
}

/*直立式呈現邊字*/
#search_c .wlr {
	writing-mode: vertical-lr;
	width: 20px;
}

/*checkbox_32*/
#search_c .checkbox_32 {
	width: 32px;
	height: 32px;
}

/*checkbox_24*/
#search_c .checkbox_24 {
	width: 24px;
	height: 24px;
}

#search_c .checkbox_20 {
	width: 20px;
	height: 20px;
}

#search_c .checkbox_16 {
	width: 16px;
	height: 16px;
}

/*編輯流程卡*/
#modify_card input {
	line-height: 18px;
	height: 26px;
}

#modify_card select {
	line-height: 18px;
	height: 26px;
}

#modify_card {
	font-size: 14px;
}
</style>
<div id="search_c" class="row p-0 m-0">
	<!-- 查詢面板 -->
	<div id="search_c_item" class="col-12 p-1">
		<div
			class="col-12 p-0 m-0 lh-1 text-start rounded-top bg-success text-white">
			<i class="btn btn-outline-white p-0 pr-1 pl-1 bi bi-dash-square"
				data-bs-toggle="collapse" data-bs-target="#search_c_item_open"
				aria-expanded="false" style="width: 22px; height: 24px;"></i>
		</div>
		<div class="row m-0 collapse show" id="search_c_item_open">
			<b class="p-0 m-0 lh-1 wlr bg-success text-white"> Search </b>
			<div id="searchItem"
				class="col border border-primary  row m-0 p-0 shadow-sm">
				<div class="col-6 searchTextEx col-md-1 p-1 d-none">
					<div class=" border border-secondary rounded">
						<div class="searchTitle title_color fw-bolder rounded-top">Search1</div>
						<div class="p-1">
							<input class="col-12 m-0 p-1 border border-dark form-control"
								type=text id="ex_id" name="ex_name" placeholder="Ex:123"
								autofocus>
						</div>
					</div>
				</div>
				<div class="col-6 searchSelectEx col-md-1 p-1 d-none">
					<div class=" border border-secondary rounded">
						<div class="searchTitle title_color fw-bolder rounded-top">Search2</div>
						<div class="p-1">
							<select class="col-12 m-0 p-1 border border-dark form-select"
								id="ex_id2" name="ex_name2">
								<option class="selectEx" value="" selected="selected">select(請選擇)</option>
							</select>
						</div>
					</div>
				</div>
			</div>
		</div>
	</div>
	<form onsubmit="return other.methods.handleSubmit(event);" class="p-0">
		<!-- 控制面板 -->
		<div id="search_c_controller" class="col-12 p-1 ">
			<div
				class="col-12 p-0 m-0 lh-1 text-start rounded-top bg-primary text-white">
				<i class="btn btn-outline-white p-0 pr-1 pl-1 bi bi-dash-square"
					data-bs-toggle="collapse"
					data-bs-target="#search_c_controller_open" aria-expanded="false"
					style="width: 22px; height: 24px;"></i>
			</div>
			<div id="search_c_controller_open" class="row m-0 collapse show">
				<b class="p-0 m-0 lh-1 wlr bg-primary text-white"> Console </b>
				<div
					class="col border border-primary row m-0 p-0 shadow-sm justify-content-between">
					<div class="col-6 col-lg-3 p-1">
						<div class=" border border-secondary rounded">
							<div class="title_color fw-bolder rounded-top">Execution</div>
							<div class="row m-0">
								<button id="btn_production" type="button"
									class="lh-1 col p-1 m-1  btn btn-sm btn-outline-info">
									<b>Production<br>import()
									</b>
								</button>
								<button id="btn_allClear" type="button"
									class="lh-1 col p-1 m-1  btn btn-sm btn-outline-warning">
									<b>All<br>clear(AD)
									</b>
								</button>
							</div>
						</div>
					</div>
					<div class="col-6 col-lg-5 p-1">
						<div class=" border border-secondary rounded">
							<div class="title_color fw-bolder rounded-top">Action</div>
							<div class="row m-0">
								<button id="btn_intoForm" type="submit" value="btn_intoForm"
									class="lh-1 col p-1 m-1  btn btn-sm btn-outline-info">
									<b>Preview<br>()
									</b>
								</button>
								<button id="btn_printerForm" type="button"
									class="lh-1 col p-1 m-1  btn btn-sm btn-outline-primary">
									<b>Print<br>form
									</b>
								</button>
								<button id="btn_saveForm" type="submit" value="btn_saveForm"
									class="lh-1 col p-1 m-1  btn btn-sm btn-outline-success">
									<b>Save<br>(AU)
									</b>
								</button>
								<div class="lh-1 col p-1 m-1 border border-success rounded">
									<input id="btn_save_auto" alt="" title="" type="checkbox"
										checked="checked"
										class="m-0 form-check-input checkbox_16 border border-dark">
									<br> <b style="font-size: 12px;">Print -> Save</b>
								</div>
								<button id="btn_unlockForm" type="submit" value="btn_unlockForm"
									class="lh-1 col p-1 m-1  btn btn-sm btn-outline-danger">
									<b>Unlock<br>(AU)
									</b>
								</button>
							</div>
						</div>
					</div>
					<div class="col-6 col-lg-3 p-1">
						<div class=" border border-secondary rounded">
							<div class="title_color fw-bolder rounded-top">Search</div>
							<div class="row m-0">
								<div class="lh-1 col p-1 m-1 border border-primary rounded">
									<input id="btn_send_auto" alt="" title="" type="checkbox"
										class="m-0 form-check-input checkbox_16 border border-dark">
									<br> <b style="font-size: 12px;">Auto(30s)</b>
								</div>
								<button id="btn_send" type="button"
									class="lh-1 col p-1 m-1  btn btn-sm btn-outline-success">
									<b>Query<br>(AR)
									</b>
								</button>
								<button id="btn_clearAll" type="button"
									class="lh-1 col p-1 m-1  btn btn-sm btn-outline-warning">
									<b>Clear<br>all()
									</b>
								</button>
							</div>
						</div>
					</div>
				</div>
			</div>
		</div>
		<!-- 編輯過程 -->
		<div id="modify_cr" class="col-12 m-0 p-1">
			<div
				class="col-12 p-0 m-0 lh-1 text-start rounded-top bg-warning text-white">
				<i class="btn btn-outline-white p-0 pr-1 pl-1 bi bi-dash-square"
					data-bs-toggle="collapse" data-bs-target="#modify_cr_open"
					aria-expanded="false" style="width: 22px; height: 24px;"></i>
			</div>
			<div id="modify_cr_open" class="row m-0 shadow-sm collapse show">
				<b class="p-0 m-0 lh-1 wlr bg-warning text-white">Modify choose</b>
				<div class="col p-0">
					<div class="row m-0">
						<!--編輯-->
						<div id="modify_card"
							class="col-12 col-lg-6 border border-primary row m-0 p-1">
							<!--1-->
							<div class="col-12 p-1">
								<h5 class="m-0 p-0 text-start">
									<b>Product Information</b>
								</h5>
							</div>
							<div class="col-6 p-1 col-lg-3">
								<div id="c_sphline"
									class="btnAutoOrder border border-secondary rounded">
									<div class="searchTitle title_color fw-bolder rounded-top">生產線(PD
										Line)</div>
									<div class="p-1">
										<select name="sphline"
											class="col-12 m-0 p-1 border border-dark form-select"
											required>
											<option class="def" value="" selected="selected">請選擇(必填)</option>
										</select>
									</div>
								</div>
							</div>
							<div class="col-6 p-1 col-lg-3">
								<div id="c_sphworkstation"
									class="btnAutoOrder border border-secondary rounded">
									<div class="searchTitle title_color fw-bolder rounded-top">工作站程序(WSP)</div>
									<div class="p-1">
										<select name="sphworkstation"
											class="col-12 m-0 p-1 border border-dark form-select"
											required>
											<option class="def" value="" selected="selected">請選擇(必填)</option>

										</select>
									</div>
								</div>
							</div>
							<div class="col-6 p-1 col-lg-3">
								<div id="c_sphlable"
									class="btnAutoOrder border border-secondary rounded">
									<div class="searchTitle title_color fw-bolder rounded-top">標籤組(LBL
										Group)</div>
									<div class="p-1">
										<select name="sphlable"
											class="col-12 m-0 p-1 border border-dark form-select"
											required>
											<option class="def" value="" selected="selected">請選擇(必填)</option>

										</select>
									</div>
								</div>
							</div>
							<div class="col-6 p-1 col-lg-3">
								<div id="c_sphpontype"
									class="btnAutoOrder border border-secondary rounded">
									<div class="searchTitle title_color fw-bolder rounded-top">製令單(Type)</div>
									<div class="p-1">
										<select name="sphpontype"
											class="col-12 m-0 p-1 border border-dark form-select"
											required>
											<option class="" value="" selected="selected">請選擇(必填)</option>
											<option class="" value="" disabled="disabled">＝＝＝A511(一般製令單)＝＝＝</option>
											<option class="" value="A511_has_sn">製令單-新序號</option>
											<option class="" value="A511_no_sn">製令單-無序號</option>
											<option class="" value="A511_no_and_has_sn">製令單-可(新序號/無序號)</option>
											<option class="" value="" disabled="disabled">＝＝＝A521(重工製令單)＝＝＝</option>
											<option class="" value="A521_has_sn">重工製令單-新序號</option>
											<option class="" value="A521_old_sn">重工製令單-舊序號續用</option>
											<option class="" value="A521_no_and_has_sn">重工製令單-可(新序號/無序號)</option>
											<option class="" value="" disabled="disabled">＝＝＝其他＝＝＝</option>
											<option class="" value="A522_service">維護製令單-無序號</option>
											<option class="" value="A431_disassemble">拆解製令單-無序號</option>
											<option class="" value="A512_outside">委外製令單-無序號</option>

										</select>
									</div>
								</div>
							</div>
							<!--2-->
							<div class="col-6 p-1 col-lg-3">
								<div id="c_sphwarranty"
									class="btnAutoOrder border border-secondary rounded">
									<div class="searchTitle title_color fw-bolder rounded-top">保固(Warranty)</div>
									<div class="p-1">
										<select name="sphwarranty"
											class="col-12 m-0 p-1 border border-dark form-select"
											required>
											<option class="" value="" selected="selected">請選擇(必填)</option>
											<option class="" value="1">1 Year</option>
											<option class="" value="2">2 Year</option>
											<option class="" value="3">3 Year</option>
											<option class="" value="4">4 Year</option>
											<option class="" value="5">5 Year</option>
											<option class="" value="6">6 Year</option>
											<option class="" value="7">7 Year</option>
											<option class="" value="8">8 Year</option>
											<option class="" value="9">9 Year</option>
											<option class="" value="10">10 Year</option>
										</select>
									</div>
								</div>
							</div>
							<div class="col-6 p-1 col-lg-3">
								<div id="c_sphindate"
									class="btnAutoOrder border border-secondary rounded">
									<div class="searchTitle title_color fw-bolder rounded-top">投線日(LineInDate)</div>
									<div class="p-1">
										<input name="sphindate"
											class="col-12 m-0 p-1 border border-dark form-control searchVal"
											type="date" placeholder="Ex:2090-12-12" required>
									</div>
								</div>
							</div>
							<div class="col-6 p-1 col-lg-3">
								<div id="c_sphpartno"
									class="btnAutoOrder border border-secondary rounded">
									<div class="searchTitle title_color fw-bolder rounded-top">客戶組件(PartNo)</div>
									<div class="p-1">
										<input name="sphpartno"
											class="col-12 m-0 p-1 border border-dark form-control searchVal"
											type="text" placeholder="Ex:客戶定義:組件號?">
									</div>
								</div>
							</div>
							<div class="col-6 p-1 col-lg-3">
								<div id="c_sphmfgpartno"
									class="btnAutoOrder border border-secondary rounded">
									<div class="searchTitle title_color fw-bolder rounded-top">工廠認證(MFGP
										No)</div>
									<div class="p-1">
										<input name="sphmfgpartno"
											class="col-12 m-0 p-1 border border-dark form-control searchVal"
											type="text" placeholder="Ex:客戶定義:工廠代號?">
									</div>
								</div>
							</div>
							<!-- 3 -->
							<div class="col-12 p-1 col-lg-12">
								<div id="c_sphpmnote"
									class="btnAutoOrder border border-secondary rounded">
									<div class="searchTitle title_color fw-bolder rounded-top">產品備註(Notice)</div>
									<div class="p-1">
										<textarea name="sphpmnote"
											class="col-12 m-0 p-1 border border-dark form-control searchVal"
											placeholder="Ex:USA?" required></textarea>
									</div>
								</div>
							</div>
							<div class="col-6 p-1 col-lg-6">
								<div id="c_sphprnote1"
									class="btnAutoOrder border border-secondary rounded">
									<div class="searchTitle title_color fw-bolder rounded-top">產線備註(Note1)</div>
									<div class="p-1">
										<textarea name="sphprnote1"
											class="col-12 m-0 p-1 border border-dark form-control searchVal"
											placeholder="Ex:DTR?" required></textarea>
									</div>
								</div>
							</div>
							<div class="col-6 p-1 col-lg-6">
								<div id="c_sphprnote2"
									class="btnAutoOrder border border-secondary rounded">
									<div class="searchTitle title_color fw-bolder rounded-top">產線備註(Note2)</div>
									<div class="p-1">
										<textarea name="sphprnote2"
											class="col-12 m-0 p-1 border border-dark form-control searchVal"
											placeholder="Ex:USA?" required></textarea>
									</div>
								</div>
							</div>

							<!-- 4 -->
							<div class="col-12 p-1">
								<h5 class="m-0 p-0 text-start">
									<b>Product serial number configuration</b>
								</h5>
							</div>
							<div class="col-12 p-1 col-lg-12">
								<div id="c_sphbpmnbDf"
									class="btnAutoOrder border border-secondary rounded">
									<div class="searchTitle title_color fw-bolder rounded-top">標準化-選擇(Default
										SN)</div>
									<div class="p-1 row m-0">
										<div class="def d-none col-2 m-0 p-0 pe-1">
											<select name=""
												class="col-12 m-0 p-1 border border-dark form-select">
												<option class="defName defoption" value=""
													selected="selected">請選擇(必填)</option>
											</select>
										</div>

										<div class="col-2 m-0 p-0 pe-1">
											<input id="mrnyyww" disabled="disabled"
												class="m-0 p-1 border border-dark form-control searchVal"
												type="text" placeholder="年周[YYWW]">
										</div>
										<div class="col-2 m-0 p-0 pe-1">
											<input id="mrn0000" disabled="disabled"
												class="m-0 p-1 border border-dark form-control searchVal"
												type="text" placeholder="流水號[0001]">
										</div>
									</div>
								</div>
							</div>
							<div class="col-6 p-1 col-lg-6">
								<div id="c_sphxnb"
									class="btnAutoOrder border border-secondary rounded">
									<div class="searchTitle pink_color fw-bolder rounded-top">固定(SN-fixed)</div>
									<div class="p-1">
										<input
											class="col-12 m-0 p-1 border border-dark form-control searchVal"
											type="text" placeholder="Ex:082DW2513" required>
									</div>
								</div>
							</div>
							<div class="col-6 p-1 col-lg-3">
								<div id="c_sphfnb"
									class="btnAutoOrder border border-secondary rounded">
									<div class="searchTitle pink_color fw-bolder rounded-top">浮動(float)</div>
									<div class="p-1">
										<input
											class="col-12 m-0 p-1 border border-dark form-control searchVal"
											type="number" placeholder="Ex:0001" required>
									</div>
								</div>
							</div>
							<div class="col-6 p-1 col-lg-3">
								<div id="c_sphlength"
									class="btnAutoOrder border border-secondary rounded">
									<div class="searchTitle pink_color fw-bolder rounded-top">長度(length)</div>
									<div class="p-1">
										<input disabled="disabled"
											class="col-12 m-0 p-1 border border-dark form-control searchVal"
											type="text" placeholder="">
									</div>
								</div>
							</div>


							<!--6-->
							<div class="col-12 p-1 text-start">
								<h5 class="m-0 p-0">
									<b>Product Ver</b>
								</h5>
							</div>
							<div class="col-6 p-1 col-lg-3">
								<div id="c_mmbver"
									class="btnAutoOrder border border-secondary rounded">
									<div class="searchTitle title_color fw-bolder rounded-top">M/B
										Ver</div>
									<div class="p-1">
										<input
											class="col-12 m-0 p-1 border border-dark form-control searchVal"
											type="text" value="" required placeholder="Ex:R1.2.A">
									</div>
								</div>
							</div>
							<div class="col-6 p-1 col-lg-3">
								<div id="c_mmbecn"
									class="btnAutoOrder border border-secondary rounded">
									<div class="searchTitle title_color fw-bolder rounded-top">M/B
										ECN</div>
									<div class="p-1">
										<input
											class="col-12 m-0 p-1 border border-dark form-control searchVal"
											type="text" value="" required placeholder="Ex:953">
									</div>
								</div>
							</div>
							<div class="col-6 p-1 col-lg-3">
								<div id="c_mbiosver"
									class="btnAutoOrder border border-secondary rounded">
									<div class="searchTitle title_color fw-bolder rounded-top">BIOS
									</div>
									<div class="p-1">
										<input
											class="col-12 m-0 p-1 border border-dark form-control searchVal"
											type="text" value="" required placeholder="Ex:382DN_0.00.06">
									</div>
								</div>
							</div>
							<div class="col-6 p-1 col-lg-3">
								<div id="c_mnvramver"
									class="btnAutoOrder border border-secondary rounded">
									<div class="searchTitle title_color fw-bolder rounded-top">NVRAM</div>
									<div class="p-1">
										<input
											class="col-12 m-0 p-1 border border-dark form-control searchVal"
											type="text" value="" required placeholder="Ex:1">
									</div>
								</div>
							</div>
							<div class="col-6 p-1 col-lg-3">
								<div id="c_pmodelver"
									class="btnAutoOrder border border-secondary rounded">
									<div class="searchTitle title_color fw-bolder rounded-top">Product
										MODEL</div>
									<div class="p-1">
										<input
											class="col-12 m-0 p-1 border border-dark form-control searchVal"
											type="text" value="" required placeholder="Ex:382DN-G1-5A">
									</div>
								</div>
							</div>
							<div class="col-6 p-1 col-lg-3">
								<div id="c_pecver"
									class="btnAutoOrder border border-secondary rounded">
									<div class="searchTitle title_color fw-bolder rounded-top">Product
										EC</div>
									<div class="p-1">
										<input
											class="col-12 m-0 p-1 border border-dark form-control searchVal"
											type="text" value="" required placeholder="Ex:382DN_0.05">
									</div>
								</div>
							</div>
							<div class="col-6 p-1 col-lg-3">
								<div id="c_posver"
									class="btnAutoOrder border border-secondary rounded">
									<div class="searchTitle title_color fw-bolder rounded-top">Product
										OS</div>
									<div class="p-1">
										<input
											class="col-12 m-0 p-1 border border-dark form-control searchVal"
											type="text" value="" required placeholder="Ex:Win11_250401">
									</div>
								</div>
							</div>
							<!--7-->
							<div class="col-12 p-1 text-start">
								<h5 class="m-0 p-0">
									<b>Product Information</b>
								</h5>
							</div>
							<div class="col-6 p-1 col-lg-4">
								<div id="c_sphbpmnb"
									class="btnAutoOrder border border-secondary rounded">
									<div class="searchTitle title_color fw-bolder rounded-top">公司品號(DTR
										BOM)</div>
									<div class="p-1">
										<input disabled="disabled"
											class="col-12 m-0 p-1 border border-dark form-control searchVal"
											type="text">
									</div>
								</div>
							</div>
							<div class="col-6 p-1 col-lg-4">
								<div id="c_sphobpmnb"
									class="btnAutoOrder border border-secondary rounded">
									<div class="searchTitle title_color fw-bolder rounded-top">客戶品號(Cust
										BOM)</div>
									<div class="p-1">
										<input disabled="disabled"
											class="col-12 m-0 p-1 border border-dark form-control searchVal"
											type="text">
									</div>
								</div>
							</div>
							<div class="col-6 p-1 col-lg-4">
								<div id="c_sphbpmmodel"
									class="btnAutoOrder border border-secondary rounded">
									<div class="searchTitle title_color fw-bolder rounded-top">產品型號(Product
										Model)</div>
									<div class="p-1">
										<input disabled="disabled"
											class="col-12 m-0 p-1 border border-dark form-control searchVal"
											type="text">
									</div>
								</div>
							</div>
							<div class="col-6 p-1 col-lg-12">
								<div id="c_sphname"
									class="btnAutoOrder border border-secondary rounded">
									<div class="searchTitle title_color fw-bolder rounded-top">品名(Product
										Name)</div>
									<div class="p-1">
										<input disabled="disabled"
											class="col-12 m-0 p-1 border border-dark form-control searchVal"
											type="text">
									</div>
								</div>
							</div>
							<div class="col-6 p-1 col-lg-12">
								<div id="c_sphspecification"
									class="btnAutoOrder border border-secondary rounded">
									<div class="searchTitle title_color fw-bolder rounded-top">規格簡述(Specification)</div>
									<div class="p-1">
										<input disabled="disabled"
											class="col-12 m-0 p-1 border border-dark form-control searchVal"
											type="text">
									</div>
								</div>
							</div>

						</div>
						<!--預覽:因為需要開立打印視窗 所以使用原始Style-->
						<div id="printNotes"
							class="justify-content-center row col-12 col-lg-6 border border-primary m-0 p-1"
							style="max-height: 920px; overflow: auto;">
							<div class="text-center "
								style="height: 880px; width: 600px; min-width: 600px; padding: 0px; break-after: page;">
								<!-- 實體SN值-->
								<div class="row m-0">
									<div class="f_sphline p-0 m-0 only_lr" title="">production:
									</div>
									<div class="col p-0 m-0"
										style="line-height: 20px; border: 1px solid #000000;">
										<!--  -->
										<div class="row m-0 justify-content-end" style="height: 50px;">
											<div class="p-0 only_brm"
												style="width: 20px; writing-mode: vertical-lr;">
												<b>M/B</b>
											</div>
											<div class="p-0 only_brm" style="width: 176px;"></div>
											<div class="p-0 only_brm"
												style="width: 20px; writing-mode: vertical-lr;">
												<b>LAN</b>
											</div>
											<div class="p-0 only_brm" style="width: 175px;"></div>
											<div class="p-0 only_brm"
												style="width: 20px; writing-mode: vertical-lr;">
												<b>BAT</b>
											</div>
											<div class="p-0 only_brm" style="width: 173px;"></div>
										</div>
										<!--  -->
										<div class="row m-0 justify-content-end" style="height: 50px;">
											<div class="p-0 only_br"
												style="width: 20px; writing-mode: vertical-lr;">
												<b>IMEI</b>
											</div>
											<div class="p-0 only_br" style="width: 176px;"></div>
											<div class="p-0 only_br"
												style="width: 20px; writing-mode: vertical-lr;">
												<b>WiFi</b>
											</div>
											<div class="p-0 only_br" style="width: 175px;"></div>
											<div class="p-0 only_br"
												style="width: 20px; writing-mode: vertical-lr;">
												<b>SN</b>
											</div>
											<div class="f_p_sn p-0 only_br" style="width: 173px;">
												<svg width="180px" height="50px" x="0px" y="0px"></svg>
											</div>
										</div>
									</div>
								</div>
								<!-- 單據基本資料 -->
								<div class="row m-0">
									<div class="f_sphworkstation p-0 m-0 only_lr" title="">Station
										:</div>
									<div class="col p-0 m-0" style="border: 1px solid #000000;">
										<div class="row m-0 justify-content-end"
											style="height: 30px; line-height: 30px;">
											<div class="p-0 only_brm"
												style="width: 20px; font-size: 10px; line-height: 15px;">
												<b>WO No.</b>
											</div>
											<div class="f_sphpon p-0 only_brm m-0 h4"
												style="width: 251px; line-height: 30px;"></div>
											<div class="p-0 only_brm"
												style="width: 45px; font-size: 10px; line-height: 15px;">
												<b>Order No.</b>
											</div>
											<div class="f_sphonb p-0 only_brm" style="width: 268px;"></div>
										</div>
										<!--  -->
										<div class="row m-0 justify-content-end"
											style="height: 30px; line-height: 30px;">
											<div class="f_sphpon_qrc p-0 only_brm" style="width: 271px;">
												<svg height="26px"></svg>
											</div>
											<div class="p-0 only_brm"
												style="width: 45px; font-size: 12px;">
												<b>Cust.</b>
											</div>
											<div class="f_sphoname p-0 only_brm"
												style="overflow: hidden; height: 31px; width: 160px;"></div>
											<div class="p-0 only_brm"
												style="width: 45px; font-size: 12px;">
												<b>Qty</b>
											</div>
											<div class="f_sphoqty p-0 only_brm"
												style="width: 63px; font-weight: bold;"></div>
										</div>
										<!--  -->
										<div class="row m-0 justify-content-end"
											style="height: 30px; line-height: 30px;">
											<div class="p-0 only_brm"
												style="width: 20px; writing-mode: vertical-lr; font-size: 11px; line-height: 20px;">
												<b>BOM</b>
											</div>
											<div class="f_sphbpmnb p-0 m-0 h4 only_brm"
												style="width: 252px;"></div>
											<div class="p-0 only_brm"
												style="width: 45px; font-size: 12px; line-height: 15px;">
												<b>Start Date</b>
											</div>
											<div class="f_sphsdate p-0 only_brm" style="width: 115px;"></div>
											<div class="p-0 only_brm"
												style="width: 45px; font-size: 12px; line-height: 15px;">
												<b>Ship Date</b>
											</div>
											<div class="f_sphhdate p-0 only_brm" style="width: 108px;"></div>
										</div>
										<!--  -->
										<div class="row m-0 justify-content-end" style="height: 60px;">
											<div class="p-0 only_br"
												style="width: 20px; writing-mode: vertical-lr; font-size: 12px; line-height: 20px;">
												<b>Notice</b>
											</div>
											<div class="f_sphpmnote p-1 only_br text-start"
												style="line-height: 15px; width: 565px; font-size: 12px; word-wrap: break-word; word-break: break-all; white-space: normal; overflow: hidden; text-overflow: ellipsis;"></div>
										</div>
									</div>
								</div>
								<!-- 版本資料 -->
								<div class="row m-0">
									<div class="f_pm_owner p-0 m-0 only_lr">PM :</div>
									<div class="col p-0 m-0"
										style="border: 1px solid #000000; font-size: 12px; line-height: 18px; white-space: nowrap; overflow: hidden; text-overflow: ellipsis;">
										<div class="row m-0 justify-content-end" style="height: 18px;">
											<div class="p-0 only_brm" style="width: 60px;">
												<b>Items</b>
											</div>
											<div class="p-0 only_brm" style="width: 150px;">
												<b>Ver. ／ ECN </b>
											</div>
											<div class="p-0 only_brm" style="width: 83px;">
												<b>Chk By</b>
											</div>
											<div class="p-0 only_brm" style="width: 60px;">
												<b>Items</b>
											</div>
											<div class="p-0 only_brm" style="width: 150px;">
												<b>Product Ver.</b>
											</div>
											<div class="p-0 only_brm" style="width: 82px;">
												<b>Chk By</b>
											</div>
										</div>
										<!--  -->
										<div class="row m-0 justify-content-end" style="height: 18px;">
											<div class="p-0 only_brm" style="width: 60px;">
												<b>M/B</b>
											</div>
											<div class="f_mbver_ecn p-0 only_brm"
												style="width: 150px; overflow: hidden;"></div>
											<div class="p-0 only_brm" style="width: 15px;"></div>
											<div class="p-0 only_br" style="width: 68px;"></div>
											<div class="p-0 only_brm" style="width: 60px;">
												<b>MODEL</b>
											</div>
											<div class="f_model_product_ver p-0 only_brm"
												style="width: 150px; overflow: hidden;"></div>
											<div class="p-0 only_brm" style="width: 15px;"></div>
											<div class="p-0 only_br" style="width: 67px;"></div>
										</div>
										<!--  -->
										<div class="row m-0 justify-content-end" style="height: 18px;">
											<div class="p-0 only_brm" style="width: 60px;">
												<b>BIOS</b>
											</div>
											<div class="f_mbiosver p-0 only_brm"
												style="width: 150px; overflow: hidden;"></div>
											<div class="p-0 only_brm" style="width: 15px;"></div>
											<div class="p-0 only_br" style="width: 68px;"></div>
											<div class="p-0 only_brm" style="width: 60px;">
												<b>NVRAM</b>
											</div>
											<div class="f_nvramver p-0 only_brm"
												style="width: 150px; overflow: hidden;"></div>
											<div class="p-0 only_brm" style="width: 15px;"></div>
											<div class="p-0 only_br" style="width: 67px;"></div>
										</div>
										<!--  -->
										<div class="row m-0 justify-content-end" style="height: 18px;">
											<div class="p-0 only_br" style="width: 60px;">
												<b>EC</b>
											</div>
											<div class="f_pecver p-0 only_br"
												style="width: 150px; overflow: hidden;"></div>
											<div class="p-0 only_br" style="width: 15px;"></div>
											<div class="p-0 only_br" style="width: 68px;"></div>
											<div class="p-0 only_br" style="width: 60px;">
												<b>OS</b>
											</div>
											<div class="f_posver p-0 only_br"
												style="width: 150px; overflow: hidden;"></div>
											<div class="p-0 only_br" style="width: 15px;"></div>
											<div class="p-0 only_br" style="width: 67px;"></div>
										</div>
									</div>
								</div>
								<!-- 產品資訊 -->
								<div class="row m-0" style="height: 450px;">
									<div class="p-0 m-0 only_lr row ">
										<div class="f_cust p-0" style="height: 140px;">Cust. BOM
											No.:</div>
										<div class="f_created p-0" style="height: 140px;">Created
											On:</div>
										<div class="f_creator p-0" style="height: 140px;">Creator:</div>
									</div>
									<div class="col p-0 m-0"
										style="border: 1px solid #000000; font-size: 12px; line-height: 15px;">
										<div class="row m-0 justify-content-end" style="height: 15px;">
											<div class="p-0 only_brm" style="width: 210px;">
												<b>Product Specifications</b>
											</div>
											<div class="p-0 only_brm" style="width: 82px;">
												<b>Chk By</b>
											</div>
											<div class="p-0 only_brm" style="width: 210px;">
												<b>Product Specifications</b>
											</div>
											<div class="p-0 only_brm" style="width: 83px;">
												<b>Chk By</b>
											</div>
										</div>
										<!-- BOM結構 -->
										<div id="allBOM" class="row m-0"
											style="display: flex; flex-wrap: wrap; flex-direction: column; height: 420px; line-height: 16px; font-size: 12px; text-align: left; font-family: sans-serif; font-stretch: condensed; white-space: nowrap;">
											<div id="sphbisitemEx_val"
												class="d-none p-0 ms-1 mt-1 only_brm"
												style="overflow: hidden; text-align: start; height: 18px; width: 288px; line-height: 16px;">
												<b>RAM </b>Ex:RAM,2G,78.A2G72.405,APACER(x2)
											</div>
										</div>
									</div>
								</div>
								<!-- 產線備註+簽名人 -->
								<div class="row m-0" style="height: 102px;">
									<div class="p-0 m-0 only_lr">Form# : QR-701-06</div>
									<div class="col p-0 m-0"
										style="border: 1px solid #000000; font-size: 10px; line-height: 20px;">
										<div class="row m-0 justify-content-end" style="height: 55px;">
											<div class="p-0 only_brm"
												style="width: 20px; writing-mode: vertical-lr;">
												<b>Note1</b>
											</div>
											<div class="f_sphprnote1 text-start p-1 only_brm"
												style="width: 273px; height: 55px; overflow: hidden; word-break: break-word; line-height: 18px; font-size: 15px;"></div>
											<div class="p-0 only_brm"
												style="width: 20px; writing-mode: vertical-lr;">
												<b>Note2</b>
											</div>
											<div class="f_sphprnote2 text-start p-1 only_brm"
												style="width: 272px; height: 55px; overflow: hidden; word-break: break-word; line-height: 18px; font-size: 15px;"></div>
										</div>
										<div class="row m-0 justify-content-end"
											style="height: 15px; line-height: 15px;">
											<div class="p-0 only_brm" style="width: 65px;">
												<b>Ass'y</b>
											</div>
											<div class="p-0 only_brm" style="width: 65px;">
												<b>Burn-in</b>
											</div>
											<div class="p-0 only_brm" style="width: 65px;">
												<b>T1</b>
											</div>
											<div class="p-0 only_brm" style="width: 65px;">
												<b>T2</b>
											</div>
											<div class="p-0 only_brm" style="width: 65px;">
												<b>P1</b>
											</div>
											<div class="p-0 only_brm" style="width: 65px;">
												<b>P2</b>
											</div>
											<div class="p-0 only_brm" style="width: 65px;">
												<b>QC</b>
											</div>
											<div class="p-0 only_brm" style="width: 65px;">
												<b>RF</b>
											</div>
											<div class="p-0 only_brm" style="width: 65px;">
												<b>PM</b>
											</div>
										</div>
										<div class="row m-0 justify-content-end"
											style="height: 31px; line-height: 15px;">
											<div class="p-0 only_brm" style="width: 65px;"></div>
											<div class="p-0 only_brm" style="width: 65px;"></div>
											<div class="p-0 only_brm" style="width: 65px;"></div>
											<div class="p-0 only_brm" style="width: 65px;"></div>
											<div class="p-0 only_brm" style="width: 65px;"></div>
											<div class="p-0 only_brm" style="width: 65px;"></div>
											<div class="p-0 only_brm" style="width: 65px;"></div>
											<div class="p-0 only_brm" style="width: 65px;"></div>
											<div class="p-0 only_brm" style="width: 65px;"></div>
										</div>
									</div>
								</div>
							</div>
						</div>
					</div>
				</div>
			</div>
		</div>
	</form>
	<!-- 查詢結果 -->
	<div id="search_cr" class="col-12 m-0 p-1">
		<div
			class="col-12 p-0 m-0 lh-1 text-start rounded-top bg-info text-white">
			<i class="btn btn-outline-white p-0 pr-1 pl-1 bi bi-dash-square"
				data-bs-toggle="collapse" data-bs-target="#search_cr_open"
				aria-expanded="false" style="width: 22px; height: 24px;"></i>
		</div>
		<div id="search_cr_open" class="row m-0 shadow-sm collapse show">
			<b class="p-0 m-0 lh-1 wlr bg-info text-white">Production Records</b>
			<table
				class="col m-0 p-0 border border-primary table table-striped table-hover table-sm table-bordered border-primary table-responsive table-style shadow-sm">
				<thead class="table-primary fixedCt">
					<tr>
						<th class="fixedC1" style="min-width: 40px;">
							<div>
								<button id="exthAll" type="button"
									class="lh-1 col p-1 m-0 btn btn-sm btn-outline-dark">
									<b>Ｃ</b>
								</button>
							</div>
						</th>
						<th class="exTheadth d-none" style="min-width: 100px;">N/A</th>
					</tr>
				</thead>
				<tbody class="table-white">
					<tr class="exTbodyTr">
						<th class="fixedC1 exTbodyTh" style="max-width: 40px;">
							<div>
								<input disabled="disabled" alt="row_x" title="IKey_GKey"
									type="radio" name="radio_t"
									class="m-0 form-check-input checkbox_24 border border-dark">
							</div>
						</th>
						<td class="exTbodytd d-none" style="max-width: 100px"></td>
					</tr>
				</tbody>
			</table>
		</div>
	</div>
</div>
<script type="text/javascript">
	//宣告
	//console.log("other.html(init)");
	other = {
		//資料
		data: {
			marks: {},//有選取的IKeyGKey
			markDetails: {},//有選取的IKeyGKey
			entityFormatJson: {},//查詢格式
			btn_send_auto: "",//自動傳送
			btn_order: false,//是否-工單查詢填入
			btn_intoForm: false,//是否有先預覽
			//換頁設置
			searchPageSet: {
				total: 1000,//批次數量(1-1000)
				batch: 0,//第幾批次(1-1000)
				pageNew: 1,//單前頁碼(1-50)
				pageSize: 200,//每頁數量(1-20)
				entityJsons: [],//資料
				entityDetailJsons: [],//細節資料
				entityIKey: "",//ID
				entityGKey: "",//GID
				entityDateTime: "",//是時間格式的欄位
			},
			searchSet: {},
		},
		//方法
		methods: {
			create() {
				//==========================第一次載入==========================
				//Step0.初始化
				console.log("other.html(created)");
				//查詢格式
				other.data.entityFormatJson = JSON.parse(main.resq_data['entityFormatJson']);
				//查詢項目 
				let searchSetJson = JSON.parse(main.resq_data['searchSet']);
				//console.log(searchSetJson);
				//資料內容
				other.data.searchPageSet.entityJsons = JSON.parse(main.resq_data['entityJson']);
				other.data.searchPageSet.entityDetailJsons = JSON.parse(main.resq_data['entityDetailJson']);
				other.data.entityIKey = main.resq_data['entityIKeyGKey'].split("_")[0];
				other.data.entityGKey = main.resq_data['entityIKeyGKey'].split("_")[1];
				other.data.entityDateTime = main.resq_data['entityDateTime'];
				other.data.searchSet = searchSetJson['searchSet'];
				//按鈕權限?
				let p = $("#nav_functional_unit").attr("alt").split("<_>")[2];
				let ps = Array.from(p);

				if (ps[10] != 1) {//查詢(AR)10
					$("#btn_send").addClass("disabled");
				} if (ps[9] != 1) {//修改(AU)9
					$("#btn_modify").addClass("disabled");
				} if (ps[8] != 1) {//新增(AC)8
					$("#btn_create").addClass("disabled");
					$("#btn_saveAs").addClass("disabled");
				} if (ps[7] != 1) {//作廢(AD)7
					$("#btn_invalid").addClass("disabled");
				} if (ps[6] != 1) {//移除(DD)6
					$("#btn_delete").addClass("disabled");
				}

				//Step1.查詢結果標題-排序
				let resultThead = searchSetJson['resultThead'];
				let resultDetailThead = searchSetJson['resultDetailThead'];
				resultThead = main.methods.orderedSort(resultThead);
				resultDetailThead = main.methods.orderedSort(resultDetailThead);
				//Step2.查詢結果標題-資料
				let check1 = true;
				Object.keys(resultThead).forEach(function (k) {
					//console.log(k + ' - ' + resultThead[k]);
					//複製格式
					let exTheadth = $('#search_cr_open .exTheadth').clone();
					let exTbodytd = $('#search_cr_open .exTbodytd').clone();
					exTheadth.removeClass('exTheadth');
					exTheadth.removeClass('d-none')
					exTheadth.addClass('titTheadth');
					//
					exTbodytd.removeClass('exTbodytd');
					exTbodytd.removeClass('d-none')
					exTbodytd.addClass('valTbodytd');
					exTbodytd.addClass(resultThead[k].cellName);
					//固定第一格式
					if (check1 && resultThead[k].show == 1) {
						check1 = false;
						exTheadth.addClass('fixedC1');
						exTheadth.css('left', "40px");
						exTbodytd.addClass('fixedC1');
						exTbodytd.css('left', "40px");
					}
					//如果有翻譯
					if (resultThead[k].cellLanguage != '') {
						let cellName = JSON.parse(resultThead[k].cellLanguage)[$('#menu_login_language').text()];
						exTheadth.text(cellName == "" ? resultThead[k].cellName : cellName);//有可能內容是空的
						exTheadth.css('minWidth', resultThead[k].width + "px");
						exTbodytd.css('maxWidth', resultThead[k].width + "px");
					} else {
						exTheadth.text(resultThead[k].cellName);
						exTheadth.css('minWidth', resultThead[k].width + "px");
						exTbodytd.css('maxWidth', resultThead[k].width + "px");
					}
					//如果隱藏
					if (resultThead[k].show == 0) {
						exTheadth.addClass('d-none');
						exTbodytd.addClass('d-none');
					}
					//添加
					$('#search_cr_open .exTheadth').before(exTheadth);
					$('#search_cr_open .exTbodytd').before(exTbodytd);
				});
				//Step2.查詢結果標題(細節)-資料
				//Step3.查詢內容-格式
				for (let b = 1; b <= other.data.searchPageSet.pageSize; b++) {
					let exTbodyTr = $('#search_cr .exTbodyTr').clone();
					let exDetailTbodyTr = $('#search_dcr .exDetailTbodyTr').clone();
					//
					exTbodyTr.removeClass('exTbodyTr');
					exTbodyTr.removeClass('d-none');
					exTbodyTr.addClass('valTbodyTr_' + b);
					exTbodyTr.find('input').attr("alt", "row_" + b);
					//
					exDetailTbodyTr.removeClass('exDetailTbodyTr');
					exDetailTbodyTr.removeClass('d-none');
					exDetailTbodyTr.addClass('valTbodyDetailTr_' + b);
					exDetailTbodyTr.find('input').attr("alt", "row_" + b);

					$('#search_cr .exTbodyTr').before(exTbodyTr);
					$('#search_dcr .exDetailTbodyTr').before(exDetailTbodyTr);

				}

				//Step3.查詢內容(細節)-格式
				$('#search_cr .exTbodyTr').addClass('d-none');
				$('#search_cr .exDetailTbodyTr').addClass('d-none');

				//Step4.查詢條件
				for (let t = 0; t < searchSetJson['searchSet'].length; t++) {
					let searchSet = searchSetJson['searchSet'][t];
					let searchTextEx = "";
					let searchSelectEx = "";
					let selectEx = "";
					//不顯示
					if (!searchSet['show']) {
						continue;
					}
					if (searchSet['type'] != 'select') {
						//一般文字
						searchTextEx = $('#search_c_item .searchTextEx').clone();
						searchTextEx.removeClass("searchTextEx");
						searchTextEx.removeClass("col-md-1");
						searchTextEx.removeClass("d-none");
						searchTextEx.addClass(searchSet['width'].replaceAll("_", "-"));
						searchTextEx.find('input').attr("id", searchSet['searchName']);
						searchTextEx.find('input').attr("name", searchSet['searchName']);
						searchTextEx.find('input').attr("placeholder", searchSet['placeholder']);
						searchTextEx.find('input').addClass("searchVal");
						Object.keys(resultThead).forEach(function (k) {

							//如果有翻譯
							if (k.split("_")[1] == (searchSet['searchName'])) {
								if (resultThead[k].cellLanguage != '') {
									let cellName = JSON.parse(resultThead[k].cellLanguage)[$('#menu_login_language').text()];
									searchTextEx.find('.searchTitle').text(cellName == "" ? searchSet['searchName'] : cellName);
								} else {
									searchTextEx.find('.searchTitle').text(searchSet['searchName']);
								}
							}
						});
					} else {
						//選擇選單
						searchSelectEx = $('.searchSelectEx').clone();
						searchSelectEx.removeClass("searchSelectEx");
						searchSelectEx.removeClass("col-md-1");
						searchSelectEx.removeClass("d-none");
						searchSelectEx.addClass(searchSet['width'].replaceAll("_", "-"));
						searchSelectEx.find('select').attr("id", searchSet['searchName']);
						searchSelectEx.find('select').attr("name", searchSet['searchName']);
						searchSelectEx.find('select').addClass("searchVal");
						//查詢欄位
						Object.keys(resultThead).forEach(function (k) {
							//如果有翻譯
							if (k.indexOf(searchSet['searchName']) >= 0) {
								if (resultThead[k].cellLanguage != '') {
									let cellName = JSON.parse(resultThead[k].cellLanguage)[$('#menu_login_language').text()];
									searchSelectEx.find('.searchTitle').text(cellName == "" ? searchSet['searchName'] : cellName);
								} else {
									searchSelectEx.find('.searchTitle').text(searchSet['searchName']);
								}
							}
						});
						//選項
						for (let s = 0; s < searchSet['select'].length; s++) {
							let key = searchSet['select'][s].split("_")[0];
							let val = searchSet['select'][s].split("_")[1];
							selectEx = searchSelectEx.find('.selectEx').clone();
							selectEx.removeClass("selectEx");
							selectEx.removeAttr("selected");
							selectEx.text(key);
							selectEx.val(val);
							selectEx.appendTo(searchSelectEx.find('select'));
						}
					}
					switch (searchSet['type']) {
						case "select":
							searchSelectEx.appendTo('#searchItem');
							break;
						case "text":
							searchTextEx.appendTo('#searchItem');
							break;
						case "time":
							searchTextEx.find('input').addClass('datetimepicker_time');
							searchTextEx.appendTo('#searchItem');
							break;
						case "datetime":
							searchTextEx.find('input').addClass('datetimepicker_date');
							searchTextEx.appendTo('#searchItem');
							break;
					}
				}
				
				//產品選單項目
				if(searchSetJson['resultMES']!==null){
					let resultMES = searchSetJson['resultMES'];
					console.log(resultMES);
					
					let wProgram = JSON.parse(resultMES.wProgram);//工作站
					wProgram.forEach((wP) => {
						let c_sphworkstation = $('#c_sphworkstation select .def').clone();
						c_sphworkstation.removeAttr("selected");
						c_sphworkstation.removeClass("def");
						c_sphworkstation.val(wP.key);
						c_sphworkstation.text(wP.value);
						$('#c_sphworkstation select .def').after(c_sphworkstation);
					});
					
					let gLabel = JSON.parse(resultMES.gLabel);//標籤組
					gLabel.forEach((gL) => {
						let c_sphlable = $('#c_sphlable select .def').clone();
						c_sphlable.removeAttr("selected");
						c_sphlable.removeClass("def");
						c_sphlable.val(gL);
						c_sphlable.text(gL);
						$('#c_sphlable select .def').after(c_sphlable);
					});
					
					let wLine = JSON.parse(resultMES.wLine);//生產線
					wLine.forEach((wL) => {
						let c_sphline = $('#c_sphline select .def').clone();
						c_sphline.removeAttr("selected");
						c_sphline.removeClass("def");
						c_sphline.val(wL);
						c_sphline.text(wL);
						$('#c_sphline select .def').after(c_sphline);
					});
				}
				//SN配置規則
				let resultMRN = searchSetJson['resultMRN']['ManufactureRuleNumber'];
				console.log(resultMRN);
				let nowSphbpmnbDf = "";
				let c_sphbpmnbDf = "";
				resultMRN.forEach((mrn) => {
					if(nowSphbpmnbDf !== mrn['mrngname']){
						nowSphbpmnbDf = mrn['mrngname'];
						//換下一格?						
						if(c_sphbpmnbDf!==""){
							$('#c_sphbpmnbDf .def').before(c_sphbpmnbDf);
						}
						c_sphbpmnbDf = $('#c_sphbpmnbDf .def').clone();
						c_sphbpmnbDf.removeAttr("selected");
						c_sphbpmnbDf.removeClass("def");
						c_sphbpmnbDf.removeClass("d-none");
						c_sphbpmnbDf.addClass("resultMRN");
					}
					//內部選項
					let defOption = c_sphbpmnbDf.find(".defoption").clone();
					defOption.removeClass("defoption");
					defOption.removeAttr("selected");
					defOption.attr("value",mrn['mrnval']);
					if(mrn['mrn0000c']===true){
						defOption.attr("mrn0000",mrn['mrn0000']);
						defOption.attr("mrnid",mrn['mrnid']);
					}
					if(mrn['mrnyywwc']===true){
						defOption.attr("mrnyyww",mrn['mrnyyww']);
					}
					
					defOption.text(mrn['mrnname']);
					c_sphbpmnbDf.find(".defoption").after(defOption);
				});
				$('#c_sphbpmnbDf .def').before(c_sphbpmnbDf);
				
				//Step5.帶入資料
				other.methods.searchReLoad();

				//==========================監聽==========================
				//監聽-選取資料(一般)
				$(document).off("change", "#search_c #search_cr_open .exTbodyTh input");
				$(document).on("change", "#search_c #search_cr_open .exTbodyTh input", function (event) {
					console.log("search_cr_open");
					//一般資料
					let Ikey_Gkey = event.target.title;
					let check = event.target.checked;
				});
				
				//監聽-全清除資料(一般)
				$(document).off("click", "#search_c #exthAll");
				$(document).on("click", "#search_c #exthAll", function (event) {
					//都有勾選?
					let clickAll = true;
					//全部取消?
					if (clickAll) {
						$("#search_cr_open .exTbodyTh").find("input").prop("checked", false);;
					}
				});
				//長度監聽 產品SN
				$(document).off("input change paste", "#c_sphxnb input,#c_sphfnb input");
				$(document).on("input change paste", "#c_sphxnb input,#c_sphfnb input", function (event) {
					let textLength =  $("#c_sphxnb input").val().length+$("#c_sphfnb input").val().length;
					$("#c_sphlength input").val(textLength);
				});
				
				//帶入單據資料
				$(document).off("click", "#search_c #btn_production");
				$(document).on("click", "#search_c #btn_production", function (event) {
					console.log("btn_production");
					//先清除
					$('#btn_allClear').trigger('click');
					//取得
					if ($("#search_cr_open tbody input:checked").length != 1) {
						return false;
					}
					let n = $("#search_cr_open tbody input:checked").attr("alt").replaceAll("row_", "");
					let entity = $(".valTbodyTr_" + n);
					//介面開啟
					if (!$('#modify_cr_open').hasClass('show')) {
						$('#modify_cr .btn-outline-white').trigger('click');
					}
					//關閉介面
					if ($('#search_cr_open').hasClass('show')) {
						$('#search_cr .btn-outline-white').trigger('click');
					}
					
					//帶入資料(預覽畫面)
					let printNotes = $("#printNotes");
					printNotes.find(".f_sphpon").text(entity.find(".sphpon").text());//工單
					printNotes.find(".f_sphbpmnb").text(entity.find(".sphbpmnb").text());//BOM號
					printNotes.find(".f_model_product_ver").text(entity.find(".sphbpmmodel").text());//產品型號
					printNotes.find(".f_sphoname").text(entity.find(".sphocountry").text()+"("+entity.find(".sphoname").text()+")");//國家+客戶名稱
					printNotes.find(".f_sphonb").text(entity.find(".sphonb").text());//訂單號 
					printNotes.find(".f_sphoqty").text(entity.find(".sphoqty").text());//數量
					printNotes.find(".f_sphsdate").text(entity.find(".sphsdate").text().split(" ")[0]);//預計開工
					printNotes.find(".f_sphhdate").text(entity.find(".sphhdate").text().split(" ")[0]);//預計出貨
					printNotes.find(".f_created").text('Created On: '+other.methods.getTodayDate());//建立日期
					printNotes.find(".f_creator").text('Creator: '+entity.find(".syscuser").text());//單據負責人
					printNotes.find(".f_pm_owner").text('PM: '+entity.find(".sphbpsuser").text());//BOM負責人
					//
					printNotes.find(".f_sphpmnote").text(entity.find(".sphpmnote").text()) ;//BOM/PM注意事項
					
					
					
					//帶入資料(填寫畫面)
					let modifycard = $("#modify_card");
					//Product Information
					if(entity.find(".sphindate").text()===""){
						modifycard.find("#c_sphindate input").val(entity.find(".sphsdate").text().split(" ")[0]);//預投產					
					}else{
						modifycard.find("#c_sphindate input").val(entity.find(".sphindate").text().split(" ")[0]);//實際頭線
					}
					//
					$('#c_sphline select').val(entity.find(".sphline").text());
					$('#c_sphworkstation select').val(entity.find(".sphworkstation").text());
					$('#c_sphlable select').val(entity.find(".sphlable").text());
					$('#c_sphpontype select').val(entity.find(".sphpontype").text());
					$('#c_sphwarranty select').val(entity.find(".sphwarranty").text());
					
					//產品參數配置Ex:["組件號(Parts No)_Parts No","驗證碼(MFG Part No)_MFG Part No"]
					if(entity.find(".sphbpsnv").text()!==""){
						let sphbpsnv = JSON.parse(entity.find(".sphbpsnv").text());
						sphbpsnv.forEach((item) => {
							if(item!==null){
								if(item.split("_")[0]!==null && item.split("_")[0] ==="組件號(Parts No)"){
								modifycard.find("#c_sphpartno input").val(item.split("_")[1]);
								}
								if(item.split("_")[0]!==null && item.split("_")[0] ==="驗證碼(MFG Part No)"){
								modifycard.find("#c_sphmfgpartno input").val(item.split("_")[1]);
								}
							}						
						});						
					}
					if(entity.find(".sphmfgpartno").text()!==""){
						modifycard.find("#c_sphmfgpartno input").val(entity.find(".sphmfgpartno").text());
					}
					if(entity.find(".sphpartno").text()!==""){
						modifycard.find("#c_sphpartno input").val(entity.find(".sphpartno").text());
					}
					
					//Product Ver
					let sphbsh = entity.find(".sphbsh").text();
					if(sphbsh!==null &&sphbsh!==''){
						let pr_s_item = JSON.parse(sphbsh)['pr_s_item'];
						if(pr_s_item!=null){
							modifycard.find("#c_mbiosver input").val(pr_s_item["BIOS"]);//BIOS
							modifycard.find("#c_mnvramver input").val(pr_s_item["NV_RAM"]);//NV_RAM
							modifycard.find("#c_mmbver input").val(pr_s_item["MB_Ver"]);//MB_Ver
							modifycard.find("#c_mmbecn input").val(pr_s_item["MB_ECN"]);//MB_ECN
							
							modifycard.find("#c_pecver input").val(pr_s_item["EC"]);//EC
							modifycard.find("#c_posver input").val(pr_s_item["OS"]);//OS
							modifycard.find("#c_pmodelver input").val(pr_s_item["Model"]);//model
							//
							modifycard.find("#c_sphprnote1 textarea").val(pr_s_item["Note1"]);//Note1
							modifycard.find("#c_sphprnote2 textarea").val(pr_s_item["Note2"]);//Note2									
						}
					}
					modifycard.find("#c_sphpmnote textarea").val(entity.find(".sphpmnote").text());//BOM/PM注意事項
					
					//
					modifycard.find("#c_pmodelver input").val(entity.find(".sphbpmmodel").text());//MODEL
					 
					//Product Information
					modifycard.find("#c_sphbpmnb input").val(entity.find(".sphbpmnb").text());//公司BOM
					modifycard.find("#c_sphobpmnb input").val(entity.find(".sphobpmnb").text());//客戶BOM
					modifycard.find("#c_sphbpmmodel input").val(entity.find(".sphbpmmodel").text());//產品型號
					modifycard.find("#c_sphname input").val(entity.find(".sphname").text());//產品名稱
					modifycard.find("#c_sphspecification input").val(entity.find(".sphspecification").text());//產品規格
					
					JsBarcode("#printNotes .f_sphpon_qrc svg", entity.find(".sphpon").text(), {//工單Code
						format: "CODE39",   // 條碼類型，可改成 code39, EAN13 等
						lineColor: "#000",   // 線條顏色
						width: 1,            // 線條寬度
						height: 16,          // 條碼高度
						displayValue: false,   // 是否顯示文字
						margin: 1,             // 四邊統一邊距（預設是 10）
						marginTop: 4,           // 上邊距
						marginBottom: 6,       // 下邊距（若顯示文字，建議拉開一點）
						marginLeft: 15,         // 左邊距
						marginRight: 5         // 右邊距
					 });

					$("#sphpon input").val(entity.find(".sphpon").text());//工單
					$("#sphonb input").val(entity.find(".sphonb").text());//訂單
					let dF = new Date(entity.find(".sphhdate").text());
					let dateF = dF.getFullYear() + "-";
					dateF += ((dF.getMonth() + 1) < 10 ? "0" + (dF.getMonth() + 1) : (dF.getMonth() + 1)) + "-";
					dateF += (dF.getDate() < 10 ? "0" + (dF.getDate()) : dF.getDate());
					$("#sphhdate input").val(dateF);//出貨日
					//
					$("#sphoname input").val(entity.find(".sphoname").text());//客戶
					$("#sphocountry input").val(entity.find(".sphocountry").text());//國家
					$("#sphobpmnb input").val(entity.find(".sphobpmnb").text());//客戶BOM
					//
					$("#sphbpmnb input").val(entity.find(".sphbpmnb").text());//品號
					$("#sphbpmmodel input").val(entity.find(".sphbpmmodel").text());//型號
					$("#sphoqty input").val(entity.find(".sphoqty").text());//數量
					//
					$("#sphscnote textarea").text(entity.find(".sphscnote").text());
					//選項-----
					let sphscpackage = JSON.parse(entity.find(".sphscpackage").text());
					for (let x = 0; x < sphscpackage.length; x++) {
						$("#sphscpackage_value" + (x + 1)).val(sphscpackage[x].split("<_>")[0]);
						let isChecked = sphscpackage[x].split("<_>")[1] === "true";
						$("#sphscpackage_checkbox" + (x + 1)).prop("checked", isChecked);
					}
					$("#bomDefinition input").val("一般模式");
					//
					//產品資訊
					let bpmbisitem = entity.find(".sphbisitem").text();//產品資訊
					let sphbisitemJson = JSON.parse(bpmbisitem);
					let items = sphbisitemJson['items'];
					if (items != null) {
						Object.keys(items).forEach(function (i) {
							//console.log(items[i]['bisgname'] + ":" + items[i]['bisfname'] + ":" + items[i]['bisqty']);
							//寫入
							let bisgname = items[i]['bisgname'];
							let bisnb = items[i]['bisnb'];
							let bisfname = JSON.parse(items[i]['bisfname']).join(', ');
							let bisqty = Number(items[i]['bisqty']);
							let del = items[i]['del'];
							//每個項目(有?沒有?)
							if (bisqty > 0) {
								let htmlc = '<b>' + bisgname + ' </b>' + bisfname + ' ' + (bisqty > 1 ? '(x' + bisqty + ")" : "");
								if (del) {
									htmlc = "<del  style='color: #ccc; '>" + htmlc + "</del>";
								}
								let sphbisitemEx = $('#sphbisitemEx_val').clone();
								sphbisitemEx.removeAttr("id");
								sphbisitemEx.removeClass("d-none").addClass("sphbisitemList");
								sphbisitemEx.attr("title", bisgname + "<_>" + bisfname + "<_>" + bisnb + "<_>" + bisqty);
								sphbisitemEx.html(htmlc);
								$('#allBOM').append(sphbisitemEx);
							} else {
								let htmlc = '<b> ' + bisgname + ' </b>' + bisfname;
								let sphbisitemExNot = $('#sphbisitemExNot_val').clone();
								sphbisitemExNot.removeAttr("id");
								sphbisitemExNot.removeClass("d-none").addClass("sphbisitemList");
								sphbisitemExNot.attr("title", bisgname + "<_>" + bisfname + "<_>" + bisnb + "<_>" + bisqty)
								sphbisitemExNot.html(htmlc);
								$('#sphbisitemExNot_val').after(sphbisitemExNot);
							}
						});
						//console.log(sphbisitemJson);
					}
					//負責人
					let sysmuser = entity.find(".sysmuser").text();
					$("#sphbpsuser_val").text(sysmuser);
					//PM 備註
					let sphpmnote = entity.find(".sphpmnote").text();
					$("#sphpmnote_val").text(sphpmnote);


				});
				//自訂項目-查詢
				$(document).off("input", "#search_c #searchSelectItems");
				$('#search_c #searchSelectItems').on('input', function () {
					const keyword = $(this).val().toLowerCase();
					$('#bom_items option').each(function () {
						$(this).toggle($(this).text().toLowerCase().includes(keyword));
					});
				});

				//自訂項目-新增
				$(document).off("click", "#search_c #btn_bom_item_add");
				$('#search_c #btn_bom_item_add').on('click', function () {
					$(".sphbisitemList").each(function (index) {
						if ($(this).text().includes($("#bom_items").select().val())) {
							console.log(index + " : " + $(this).html());
							$(this).find("del").contents().unwrap();
							//.contents()：選取 <del> 標籤的內容，包括文字或其他子節點。
							//.unwrap()：移除目標標籤，但保留內容。
						}
					});
					//自定義才能使用
					if ($("#bomDefinition select").val() === "definition" && $('#bom_items_qty').val() > 0) {
						$("#bomDefinition select").attr("disabled", "disabled");
						//每個項目
						let bom_items = $('#bom_items option:selected').attr("title");
						let bisgname = bom_items.split("<_>")[0];
						let bisfname = bom_items.split("<_>")[1];
						let bisnb = bom_items.split("<_>")[2];
						let bisqty = $('#bom_items_qty').val();
						//
						let htmlc = '<b>' + bisgname + ' </b>' + bisfname + ' ' + (bisqty > 1 ? '(x' + bisqty + ")" : "");
						let sphbisitemEx = $('#sphbisitemEx_val').clone();
						sphbisitemEx.removeAttr("id");
						sphbisitemEx.removeClass("d-none").addClass("sphbisitemList");
						sphbisitemEx.attr("title", bisgname + "<_>" + bisfname + "<_>" + bisnb + "<_>" + bisqty);
						sphbisitemEx.html(htmlc);
						$('#sphbisitemEx_val').after(sphbisitemEx);
						$("#bom_items_qty").val(0);
						$("#bomDefinition_val").text("自訂義模式");

					}
				});
				//自訂項目-移除
				$(document).off("click", "#search_c #btn_bom_item_remove");
				$('#search_c #btn_bom_item_remove').on('click', function () {
					$(".sphbisitemList").each(function (index) {
						if ($(this).text().includes($("#bom_items").select().val())) {
							console.log(index + " : " + $(this).html());
							$(this).html("<del  style='color: #ccc; '>" + $(this).html() + "</del>");
						}
					});
					//自定義才能使用
					if ($("#bomDefinition select").val() === "definition" && $('#bom_items_qty').val() < 0) {
						$("#bomDefinition select").attr("disabled", "disabled");
						//移除項目
						$(".sphbisitemList").each(function (index) {
							if ($(this).text().includes($('#bom_items option:selected').val())) {
								$(this).remove();
								$("#bom_items_qty").val(0);
							}
						});
					}
				});

				//清除所有資料
				$(document).off("click", "#search_c #btn_allClear");
				$(document).on("click", "#search_c #btn_allClear", function (event) {
					console.log("btn_allClear");
					//還原
					//上方
					$("#sphpon_val").text("");//工單
					$("#sphonb_val").text("");//訂單
					$("#sphhdate_val").text("");//出貨日
					//
					$("#sphoname_val").text("");//客戶
					$("#sphocountry_val").text("");//國家
					//
					$("#sphbpmnb_val").text("");//品號
					$("#sphbpmmodel_val").text("");//型號
					$("#sphoqty_val").text("");//數量
					//
					$("#c_sphbpmnbDf select").val("");//切換預設
					
					
					//
					$(".btnAutoOrder input").val("");
					$(".sphbisitemList").remove();
					//$("#sphscnote_val").text("「Ex:NPI_EE/NPI_NE及PLT人員須到現場確認技轉狀況，產線須提出技轉報告」");
					//$("#sphpmnote_val").text("「Ex:產品狀態:技轉中」");
					//選項
					for (let x = 1; x <= 9; x++) {
						$("#sphscpackage_checkbox" + x).prop("checked", false);
						$("#pkg_checkbox" + x + " input").attr("checked", false);
					}
					//下面初始化
					$("#fromwho_val").text("");
					$("#sphbpsuser_val").text("");
					$("#bomDefinition select").val("bom");
					$("#bomDefinition select").removeAttr("disabled", "disabled");
					//
					$("#searchSelectItems").val("");
					$("#bom_items").val("");
					$("#bom_items_qty").val(0);
					$("#sphoqty input").val(0);//生產數

					$("#bomDefinition_val").text("一般模式");
					$("#sphscnote textarea").text("");
					
					//表單清除
					let printNotes = $("#printNotes");
					printNotes.find(".f_sphpon").text('');//工單
					printNotes.find(".f_sphbpmnb").text('');//BOM號
					printNotes.find(".f_model_product_ver").text('');//產品型號
					printNotes.find(".f_sphoname").text('');//國家+客戶名稱
					printNotes.find(".f_sphonb").text('');//訂單號 
					printNotes.find(".f_sphoqty").text('');//數量
					printNotes.find(".f_sphsdate").text('');//預計開工
					printNotes.find(".f_sphhdate").text('');//預計出貨
					printNotes.find(".f_created").text('Created On: ');//建立日期
					printNotes.find(".f_creator").text('Creator: ');//單據負責人
					printNotes.find(".f_sphpmnote").text('');//BOM/PM注意事項
					printNotes.find(".f_pm_owner").text('PM: ');//BOM負責人
					printNotes.find(".f_p_sn svg").text('');//QRCode
					printNotes.find(".f_sphpon_qrc svg").text('');//QRCode
					 
				});

				//監聽-打印
				$(document).off("click", "#search_c #btn_printerForm");
				$(document).on("click", "#search_c #btn_printerForm", function (event) {
					console.log("btn_printerForm");

					// 取得 HTML 模板
					const content = $("#printNotes").clone();
					content.children("div").first().css({
						zoom: 1.3,
					});
					
					const rawHtml = content;
					
					let c_sphxnbText = $("#c_sphxnb input").val();//固定
					let c_sphfnbText = parseInt($("#c_sphfnb input").val());//浮動
					let c_sphfnbLength = $("#c_sphfnb input").val().length;//長度
					let maxValue = Math.pow(10, c_sphfnbLength) - 1;//次方-1 Ex:99999
					const total = parseInt($('#printNotes .f_sphoqty').text().replace(/,/g, ''));  // 實際數量
					const batchSize = 200;     // 每批 200 筆
					let batchIndex = 0;
					
					function printBatch() {
						if (batchIndex * batchSize >= total){
							other.methods.btn_saveForm(3);
							return; // 所有都印完了
						}
							

						let contentHtml = "";
						// 防呆：確保長度合理
						if (!Number.isInteger(c_sphfnbLength) || c_sphfnbLength <= 0) {
						    console.warn("無效的 c_sphfnbLength，已預設為 4");
						    c_sphfnbLength = 4;
						}
						
						for (let i = 1; i <= batchSize && (batchIndex * batchSize + i) <= total; i++) {
							//c_sphfnbText->補0->c_sphfnbStr 
							let c_sphfnbStr = String(c_sphfnbText).padStart(c_sphfnbLength, '0');
							let fullCode = c_sphxnbText + c_sphfnbStr;
							// 防呆：確保條碼內容非空
						    if (!fullCode || fullCode.length === 0) {
						        console.warn("條碼內容為空，已跳過");
						        continue;
						    }
						    // 取得 svg 元素並清除舊內容
						    let svgElement = rawHtml.find(".f_p_sn svg")[0];
						    while (svgElement.firstChild) {
						        svgElement.removeChild(svgElement.firstChild);
						    }
							//轉Qrcode 
							JsBarcode(svgElement, fullCode, {//產品SN號 Code
								format: "CODE39",   // 條碼類型，可改成 code39, EAN13 等
								lineColor: "#000",   // 線條顏色
								width: 0.7,            // 線條寬度
								height: 25,          // 條碼高度
								displayValue: true,   // 是否顯示文字
								margin: 1,             // 四邊統一邊距（預設是 10）
								marginTop: 8,           // 上邊距
								marginBottom: 3,       // 下邊距（若顯示文字，建議拉開一點）
								marginLeft: 10,         // 左邊距
								marginRight: 2,        // 右邊距
								fontSize: 12,              // 調整文字大小（預設為 20）
								font: "Arial",             // 指定字型（可用 CSS 字型名稱）
								fontOptions: "bold",       // 字型樣式："bold", "italic", "bold italic"
								textMargin: 3,             // 條碼與文字之間的間距（預設 2）
								textAlign: "center",       // 對齊方式："left", "center", "right"
								marginBottom: 2           // 若文字高度加大，建議增加底部邊距避免擠壓
							 });
							// 儲存條碼 HTML
						    contentHtml += rawHtml.html()
							// 累加，並檢查是否超過最大值
						    c_sphfnbText++;
						    if (c_sphfnbText > maxValue) {
						        c_sphfnbText = 1;
						    }
						}
						
						// 開啟一個新視窗-> 在新視窗中寫入 HTML
						let printWindow = window.open("", "_blank", "width=800,height=800");
						printWindow.document.open();
						printWindow.document.write("<!DOCTYPE html>" +
							"<html>" +
							"<head><title>打印內容</title>" +
							'<link rel="stylesheet" href="./thirdparty/css/jquery-ui-1.13.2.min.css" />' +
							'<link rel="stylesheet" href="./thirdparty/css/bootstrap-5.2.3.min.css" />' +
							'<link rel="stylesheet" href="./thirdparty/css/bootstrap-datetimepicker.min.css" />' +
							'<link rel="stylesheet" href="./thirdparty/bootstrap-icons-1.10.5/font/bootstrap-icons.min.css">' +
							"<style>" +
							'body {width: 210mm; height: 297mm; margin: 0; padding: 0;overflow: auto;font-family: Arial, sans-serif;}' +
							/*限用表格*/
							'.only_brm {' +
							'	border-right: 1px solid #000000;border-bottom: 1px solid #000000;' +
							'}' +
							'.only_br {	border-right: 1px solid #000000;}' +
							'.only_lr {	width: 12px;text-align: center;writing-mode: vertical-lr;font-size: 8px;border: 1px solid #000000;}' +
							'@media print{.noprint{display:none;}}'+
							"</style></head><body>"  + contentHtml + "</body>" +
							"<script type='text/javascript'> console.log('測試');</sc"+"ript>"+
							"</html>");
							setTimeout(function () {
								printWindow.focus(); // 建議先聚焦，某些瀏覽器否則會阻擋
								printWindow.print();
								// 延遲 1 秒再印下一批+載完成後打印
							}, 2000);
							
							setTimeout(printBatch, 3000); // 調整間隔時間（列印太快會導致視窗過多）
						batchIndex++;
					}
					
					printBatch(); // 開始第一批
				});

				//監聽-查詢
				$(document).off("click", "#search_c #btn_send");
				$(document).on("click", "#search_c #btn_send", function (event) {
					console.log("btn_send");
					other.methods.searchSend(0, null);

					if ($("#btn_send_auto").prop("checked")) {
						other.data.btn_send_auto = setTimeout(function () {
							$("#search_c #btn_send").trigger("click");
						}, 30000);
					} else {
						clearTimeout(other.data.btn_send_auto);
					}
				});
				//監聽-查詢(促發)
				$(document).off("keyup", "#searchItem input");
				$(document).on("keyup", "#searchItem input", function (e) {
					if (e.key === 'Enter' || e.keyCode === 13) {
						$(e.currentTarget).select();
						$("#search_c #btn_send").trigger("click");
					}
				});
				//監聽-清除查詢
				$(document).off("click", "#search_c #btn_clearAll");
				$(document).on("click", "#search_c #btn_clearAll", function (event) {
					console.log("btn_clearAll");
					$("#searchItem input").val("");
					$("#searchItem select").val("");

				});
				//監聽-選擇周年度-流水號
				$(document).off("change", "#c_sphbpmnbDf select");
				$(document).on("change", "#c_sphbpmnbDf select", function (event) {
					console.log("c_sphbpmnbDf option");
					const selectedOption = $(this).find("option:selected");
					//週期
					if(selectedOption.attr("mrnyyww")!=null){
						$('#c_sphbpmnbDf #mrnyyww').val(selectedOption.attr("mrnyyww"));
					}
					//序號
					if(selectedOption.attr("mrn0000")!=null){			
						$('#c_sphbpmnbDf #mrn0000').val(selectedOption.attr("mrn0000"));
					}
					//帶入客製化
					let selectedValues = "";
					$('#c_sphbpmnbDf .resultMRN select').each(function () {
					    selectedValues+=$(this).val();
					});
					selectedValues+=$('#c_sphbpmnbDf #mrnyyww').val();
					$('#c_sphxnb input').val(selectedValues);
					$('#c_sphfnb input').val($('#c_sphbpmnbDf #mrn0000').val());
					//觸發感測
					$('#c_sphxnb input').val(selectedValues).trigger('input');
					console.log(selectedValues);
				});
				//時間格式
				other.methods.datetimepickerDate();

			},
			datetimepickerDate() {
				//日期時間格式
				//$('.datetimepicker').remove();
				$('#search_c_item .datetimepicker_date').datetimepicker({
					format: 'yyyy-mm-dd hh:ii:00',
					pickerPosition: 'bottom-right',
					//minView:1,
					// hoursDisabled: [00, 1, 2, 3, 4, 5, 6],
					minuteStep: 30,
					autoclose: true,
					endDate: '+1d',
					datesDisabled: '+1d',
					todayBtn: true,
					bootcssVer: 5,
					//......可以同上項目代碼自定義設置
				});
				//時間格式
				$('#search_c_item .datetimepicker_time').datetimepicker({
					format: 'hh:ii',
					startView: 1,
					minuteStep: 30,
					pickDate: false,
					autoclose: true,
					timeFormat: 'hh:mm',
				});
			},
			//==========================修改資料==========================
			handleSubmit(event) {
				event.preventDefault(); // 防止表單預設提交
				const action = event.submitter.value;
				if (action === "btn_intoForm") {
					other.methods.btn_intoForm();
					other.data.btn_intoForm = true;
				} else if (action === "btn_saveForm") {
					other.methods.btn_saveForm(3);
				}else if (action === "btn_unlockForm") {
					other.methods.btn_saveForm(2);
				}
			},
			//預覽資料// 完成->流程卡(準備生產)=3 (生產中)=4 (生產結束)=5
			btn_intoForm() {
				//預覽內容
				console.log("btn_intoForm");
				//單據內容				
				let c_sphlineText = $('#c_sphline select option:selected').text();     // 產線: 選中的顯示文字
				let c_sphlineValue = $('#c_sphline select').val();                     // 產線:選中的 value
				$('#printNotes .f_sphline').text('production:'+c_sphlineText);					 
				$('#printNotes .f_sphline').attr('title',c_sphlineValue);
				
				let c_sphworkstationText = $('#c_sphworkstation select option:selected').text();     // 工作站: 選中的顯示文字
				let c_sphworkstationValue = $('#c_sphworkstation select').val();                     // 工作站:選中的 value
				$('#printNotes .f_sphworkstation').text('station:'+c_sphworkstationText);
				$('#printNotes .f_sphworkstation').attr('title',c_sphworkstationValue);
				//c_sphlable //標籤
				//c_sphpontype //製令單類
				//c_sphwarranty //保固
				$('#printNotes .f_sphsdate').text($('#c_sphindate input').val());//投入時間
				//
				$('#printNotes .f_sphprnote1').text($('#c_sphprnote1 textarea').val());//1.備註資訊
				$('#printNotes .f_sphprnote2').text($('#c_sphprnote2 textarea').val());//2.備註資訊
				$('#printNotes .f_sphpmnote').text($('#c_sphpmnote textarea').val());//產品備註資訊
				
				$('#printNotes .f_sphline').attr('title',c_sphlineValue);//工作站
				
				
				//版本
				$('#printNotes .f_mbver_ecn').text($('#c_mmbver input').val()+"／"+$('#c_mmbecn input').val());//MB:Ver+EC
				$('#printNotes .f_mbiosver').text($('#c_mbiosver input').val());//BIOS版本
				$('#printNotes .f_nvramver').text($('#c_mnvramver input').val());//NVRAM
				$('#printNotes .f_pecver').text($('#c_pecver input').val());//EC
				$('#printNotes .f_posver').text($('#c_posver input').val());//OS
				$('#printNotes .f_model_product_ver').text($('#c_pmodelver input').val());//型號
				
				//SN區間
				let printNotes = $('#printNotes');//預覽物件
				let c_sphxnbText = $("#c_sphxnb input").val();//固定
				let c_sphfnbText = $("#c_sphfnb input").val();//浮動
				
				JsBarcode("#printNotes .f_p_sn svg",c_sphxnbText+c_sphfnbText, {//產品SN號 Code
					format: "CODE39",   // 條碼類型，可改成 code39, EAN13 等
					lineColor: "#000",   // 線條顏色
					width: 0.7,            // 線條寬度
					height: 25,          // 條碼高度
					displayValue: true,   // 是否顯示文字
					margin: 1,             // 四邊統一邊距（預設是 10）
					marginTop: 8,           // 上邊距
					marginBottom: 3,       // 下邊距（若顯示文字，建議拉開一點）
					marginLeft: 10,         // 左邊距
					marginRight: 2,        // 右邊距
					fontSize: 12,              // 調整文字大小（預設為 20）
					font: "Arial",             // 指定字型（可用 CSS 字型名稱）
					fontOptions: "bold",       // 字型樣式："bold", "italic", "bold italic"
					textMargin: 3,             // 條碼與文字之間的間距（預設 2）
					textAlign: "center",       // 對齊方式："left", "center", "right"
					marginBottom: 2           // 若文字高度加大，建議增加底部邊距避免擠壓
				 });
				
				//帶回資料
				let n = $("#search_cr_open tbody input:checked").attr("alt").replaceAll("row_", "");
				let entity = $(".valTbodyTr_" + n);
					
				//軟體配置
				let pr_s = {};
				let pr_s_item = {};
				pr_s_item["BIOS"] = $('#c_mbiosver input').val();
				pr_s_item["NV_RAM"] = $('#c_mnvramver input').val();
				pr_s_item["MB_Ver"] = $('#c_mmbver input').val();
				pr_s_item["MB_ECN"] = $('#c_mmbecn input').val();
				pr_s_item["OS"] = $('#c_posver input').val();
				pr_s_item["EC"] = $('#c_pecver input').val();
				
				pr_s_item["Model"] = $('#c_pmodelver input').val();
				pr_s_item["Note1"] =  $('#c_sphprnote1 textarea').val();
				pr_s_item["Note2"] =  $('#c_sphprnote2 textarea').val();
				
				pr_s["pr_s_item"] = pr_s_item;
				entity.find(".sphbsh").text(JSON.stringify(pr_s));//軟硬體
				//
				entity.find(".sphssn").text(c_sphxnbText+c_sphfnbText);//開始SN
				let f_sphoqty = parseInt($('#printNotes .f_sphoqty').text());//開始SN+數量 
				f_sphoqty = parseInt(c_sphfnbText)+f_sphoqty-1;//去除第一台
				f_sphoqty = String(f_sphoqty).padStart(4, '0');//補足4位數 
				entity.find(".sphesn").text(c_sphxnbText+f_sphoqty);//結束SN
				entity.find(".sphpmnote").text($('#c_sphscnote textarea').val());//PM備註
				//
				entity.find(".sphindate").text($('#c_sphindate input').val());//實際投入時間
				entity.find(".sphline").text($('#c_sphline select').val());//產線選擇
				entity.find(".sphworkstation").text($('#c_sphworkstation select').val());//工作站選擇
				entity.find(".sphlable").text($('#c_sphlable select').val());//標籤選擇
				entity.find(".sphpontype").text($('#c_sphpontype select').val());//製令單選擇
				entity.find(".sphwarranty").text($('#c_sphwarranty select').val());//保固選擇
				//
				entity.find(".sphprnote1").text($('#c_sphprnote1 textarea').val());//note1
				entity.find(".sphprnote2").text($('#c_sphprnote2 textarea').val());//note2
				entity.find(".sphpmnote").text($('#c_sphpmnote textarea').val());//noties PM備註
				//
				entity.find(".sphpartno").text($('#c_sphpartno input').val());//
				entity.find(".sphmfgpartno").text($('#c_sphmfgpartno input').val());//工廠認證(MFGPNo)
				
				entity.find(".sphrsn").text("");
				//SN選定?
				let c_sn = true;
				$("#c_sphbpmnbDf select").each(function (index) {
					let mrnid = $(this).find('option:selected').attr('mrnid');
					if(mrnid !== null && mrnid !== undefined){
						entity.find(".sphrsn").text(mrnid+"_"+$('#c_sphxnb input').val()+"_"+$('#c_sphfnb input').val());//SN規則ID_固定_浮動
						c_sn = false;
					}
				});
				//自訂?
				if(c_sn){
					entity.find(".sphrsn").text("_"+$('#c_sphxnb input').val()+"_"+$('#c_sphfnb input').val());
				}
				
			
				
			},
			//存檔資料
			btn_saveForm(sphprogress) {
				//必須先預覽->才能存檔
				if(other.data.btn_intoForm !== true){
					nav_alert.methods.alertshow("warning", "[622] Please 'Preview' first! [Warning]!!");
					return null;
				}
				
				//預覽內容
				console.log("btn_saveForm");
				console.log(other.data.entityFormatJson);
				let entityJson = other.data.entityFormatJson;
				let n = $("#search_cr_open tbody input:checked").attr("alt").replaceAll("row_", "");
				let entity = $(".valTbodyTr_" + n);
				let entityDateTime = other.data.entityDateTime;
				//解鎖?鎖定?
				entity.find(".sphprogress").text(sphprogress);
				//
				$(entity).find('.valTbodytd').each(function (index) {
					let className = $(this).attr('class').replaceAll("fixedC1", "").replaceAll("d-none", "").replaceAll("valTbodytd", "").replaceAll(" ", "");
					let val = $(this).text();
					//是否時間格式?
					if (entityDateTime.indexOf(className) >= 0) {
						entityJson[className] =	new Date(val).getTime();
					}else{
						entityJson[className] = val;					
					}
					console.log(className+":"+val);
				});
				
				
				
				//傳送準備
				console.log("modifySend:" + new Date());
				let entityFormatJson = {};
				let entityJsons = [];//回傳一般資料
				let entityDetailJsons = [];//回傳細節資料
				let data = {};
				let req_data = {};
				let searchPageSet = {};
				let type = "PUT";
				let action = "AU";
				//
				entityJsons.push(entityJson);
				data['entityJson'] = JSON.stringify(entityJsons);
				data['entityDetailJson'] = JSON.stringify(entityDetailJsons);
				data['callBackFunction'] = "other_modify";
				console.log(entityJsons);
				console.log(entityDetailJsons);

				//包裝
				req_data['data'] = data;
				req_data['url'] = $('#nav_functional_unit').attr('title') + ".basil." + action;//AC/AD....
				req_data['type'] = type;//POST/PUT/DELETE...
				main.methods.ajaxSend(req_data, true);
				return false;
			},
			//現在時間
			getTodayDate() {
			    const today = new Date();
			    const yyyy = today.getFullYear();
			    const mm = String(today.getMonth() + 1).padStart(2, '0'); // 月份從 0 開始
			    const dd = String(today.getDate()).padStart(2, '0');
			    return `${yyyy}-${mm}-${dd}`;
			},
			//==========================傳送資料==========================
			searchSend(batch, order) {
				let entityJson = other.data.entityFormatJson;//格式
				let data = {};
				let req_data = {};
				let searchPageSet = {};
				//查詢
				$("#searchItem .searchVal").each(function (index) {
					console.log(index + " : " + $(this).attr("id") + " : " + $(this).val());
					if ($(this).hasClass('datetimepicker_date') && $(this).val() != "") {
						entityJson[$(this).attr("id")] = new Date($(this).val()).getTime();
					} else {
						entityJson[$(this).attr("id")] = $(this).val() == "" ? null : $(this).val();
					}
				});
				data['entityJson'] = JSON.stringify(entityJson);
				//換頁
				searchPageSet['total'] = other.data.searchPageSet.total;//批次數量
				searchPageSet['batch'] = batch;//第幾批次
				data['searchPageSet'] = JSON.stringify(searchPageSet);
				data['callBackFunction'] = "other_search";
				//包裝
				req_data['data'] = data;
				req_data['url'] = $('#nav_functional_unit').attr('title') + ".basil.AR";
				if (order != null) {
					req_data['url'] = $('#nav_functional_unit').attr('title') + ".basil.ARO";
				}
				req_data['type'] = "POST";
				main.methods.ajaxSend(req_data, true);
				//時間格式
				other.methods.datetimepickerDate();
			},
			//==========================資料載入==========================
			searchReLoad() {
				console.log("searchReLoad_Start:" + new Date());
				//還原
				$('#search_c .valTbodytd').text("");
				$('#search_c .exTbodyTh input').attr("disabled", "disabled");
				$('#search_c .exTbodyTh input').attr("title", "IKey_GKey");
				$('#search_c .exTbodyTh input').prop("checked", false);
				//版面預設
				
				if (!$('#search_cr_open').hasClass('show')) {
					$('#search_cr .btn-outline-white').trigger('click');
				}
				//編輯畫面
				if ($('#modify_cr_open').hasClass('show') && !other.data.btn_order) {
					$('#modify_cr .btn-outline-white').trigger('click');
				}


				//Step5.帶入資料
				let marks = other.data.marks;
				let entityJsons = other.data.searchPageSet.entityJsons;
				let entityDetailJsons = other.data.searchPageSet.entityDetailJsons;
				let entityIKey = other.data.entityIKey;
				let entityGKey = other.data.entityGKey;
				let entityDateTime = other.data.entityDateTime;
				let pageSize = other.data.searchPageSet.pageSize;//每頁數量(1-20)
				let pageNew = other.data.searchPageSet.pageNew - 1;//單前頁碼(1-50)
				let pageSN = pageSize * pageNew;//目前分頁->資料戳記
				for (let x = 0; x < pageSize; x++) {
					//筆數還夠
					if (pageSN + x < entityJsons.length) {
						let entity = entityJsons[pageSN + x];//((目前頁碼-1)*每頁數量)+x
						let iKey = "";
						let gKey = "";
						Object.keys(entity).forEach(function (k) {
							//欄位計數
							let valTrNb = x + 1;
							$('#search_c .valTbodyTr_' + valTrNb + ' th input').removeAttr("disabled");
							//是否IKEY?
							if (entityIKey == k) {iKey = entity[k];}
							//是否GKEY?
							if (entityGKey == k) {gKey = entity[k];}
							//是否時間格式?
							if (entityDateTime.indexOf(k) >= 0) {
								let dF = new Date(entity[k]);
								let dateF = dF.getFullYear() + "-";
								dateF += ((dF.getMonth() + 1) < 10 ? "0" + (dF.getMonth() + 1) : (dF.getMonth() + 1)) + "-";
								dateF += (dF.getDate() < 10 ? "0" + (dF.getDate()) : dF.getDate()) + " ";
								dateF += (dF.getHours() < 10 ? "0" + dF.getHours() : dF.getHours()) + ":";
								dateF += (dF.getMinutes() < 10 ? "0" + dF.getMinutes() : dF.getMinutes()) + ":";
								dateF += (dF.getSeconds() < 10 ? "0" + dF.getSeconds() : dF.getSeconds());
								$('#search_c .valTbodyTr_' + valTrNb + ' .' + k).text(dateF);
							} else {
								$('#search_c .valTbodyTr_' + valTrNb + ' .' + k).text(entity[k]);
							}
							//marks標記?
							$('#search_c .valTbodyTr_' + valTrNb + ' input').attr("title", iKey + "_" + gKey);
							//帶入
							for (let m = 0; m < marks.length; m++) {
								if (marks[m].Ikey_Gkey == iKey + "_" + gKey) {
									$('#search_c .valTbodyTr_' + valTrNb + ' input').prop("checked", true);
									break;
								}
							}
						});
					}
				}
				//下面清單
				for (let x = 0; x < pageSize; x++) {
					//筆數還夠
					if (pageSN + x < entityDetailJsons.length) {
						let entity = entityDetailJsons[pageSN + x];//((目前頁碼-1)*每頁數量)+x
						let iKey = "";
						let gKey = "";
						Object.keys(entity).forEach(function (k) {
							//欄位計數
							let valTrNb = x + 1;
							$('#search_c .valTbodyDetailTr_' + valTrNb + ' th input').removeAttr("disabled");
							//是否IKEY?
							if (entityIKey == k) {iKey = entity[k];}
							//是否GKEY?
							if (entityGKey == k) {gKey = entity[k];}
							//是否時間格式?
							if (entityDateTime.indexOf(k) >= 0) {
								let dF = new Date(entity[k]);
								let dateF = dF.getFullYear() + "-";
								dateF += ((dF.getMonth() + 1) < 10 ? "0" + (dF.getMonth() + 1) : (dF.getMonth() + 1)) + "-";
								dateF += (dF.getDate() < 10 ? "0" + (dF.getDate()) : dF.getDate()) + " ";
								dateF += (dF.getHours() < 10 ? "0" + dF.getHours() : dF.getHours()) + ":";
								dateF += (dF.getMinutes() < 10 ? "0" + dF.getMinutes() : dF.getMinutes()) + ":";
								dateF += (dF.getSeconds() < 10 ? "0" + dF.getSeconds() : dF.getSeconds());
								$('#search_c .valTbodyDetailTr_' + valTrNb + ' .' + k).text(dateF);
							} else {
								$('#search_c .valTbodyDetailTr_' + valTrNb + ' .' + k).text(entity[k]);
							}

							//marks標記?
							$('#search_c .valTbodyDetailTr_' + valTrNb + ' input').attr("title", iKey + "_" + gKey);
							//帶入
							for (let m = 0; m < marks.length; m++) {
								if (marks[m].Ikey_Gkey == iKey + "_" + gKey) {
									$('#search_c .valTbodyDetailTr_' + valTrNb + ' input').prop("checked", true);
									break;
								}
							}
						});
					}
				}

				//確認自動加載
				if (other.data.btn_order) {
					other.data.btn_order = false;
					//還原
					$(".btnAutoOrder input").val("");
					$(".sphbisitemList").remove();

					//例遍 欄位
					let entity = entityJsons[0];
					Object.keys(entity).forEach(function (k) {
						//btnAutoOrder
						//略過 sphscpackage / 
						if (k === "sphscpackage") {
							//包裝備註
							return; // 跳過本次迭代
						} else if (k === "sphscnote") {
							//生管 備註
							$("#" + k + " textarea").text(entity[k]);
							return; // 跳過本次迭代
						} else if (k === "sphpmnote") {
							//PM 備註
							$("#sphpmnote_val").text(entity[k]);
						} else if (k === "sphbpsuser") {
							//負責人
							$("#sphbpsuser_val").text(entity[k]);
						} else if (k === "sphbisitem") {
							//產品資訊
							let sphbisitemJson = JSON.parse(entity[k]);
							let items = sphbisitemJson['items'];

							if (items != null) {
								Object.keys(items).forEach(function (i) {
									//console.log(items[i]['bisgname'] + ":" + items[i]['bisfname'] + ":" + items[i]['bisqty']);
									//寫入
									let bisgname = items[i]['bisgname'];
									let bisnb = items[i]['bisnb'];
									let bisfname = JSON.parse(items[i]['bisfname']).join(', ');
									let bisqty = Number(items[i]['bisqty']);
									//每個項目(有?沒有?)
									if (bisqty > 0) {
										let htmlc = '<b>' + bisgname + ' </b>' + bisfname + ' ' + (bisqty > 1 ? '(x' + bisqty + ")" : "");
										let sphbisitemEx = $('#sphbisitemEx_val').clone();
										sphbisitemEx.removeAttr("id");
										sphbisitemEx.removeClass("d-none").addClass("sphbisitemList");
										sphbisitemEx.attr("title", bisgname + "<_>" + bisfname + "<_>" + bisnb + "<_>" + bisqty);
										sphbisitemEx.html(htmlc);
										$('#allBOM').append(sphbisitemEx);
									} else {
										let htmlc = '<b> ' + bisgname + ' </b>' + bisfname;
										let sphbisitemExNot = $('#sphbisitemExNot_val').clone();
										sphbisitemExNot.removeAttr("id");
										sphbisitemExNot.removeClass("d-none").addClass("sphbisitemList");
										sphbisitemExNot.attr("title", bisgname + "<_>" + bisfname + "<_>" + bisnb + "<_>" + bisqty);
										sphbisitemExNot.html(htmlc);
										$('#sphbisitemExNot_val').after(sphbisitemExNot);
									}
								});
								//console.log(sphbisitemJson);
							}
						}
						console.log(k + ":" + entity[k]);
						//是否時間格式?
						if (entityDateTime.indexOf(k) >= 0) {
							let dF = new Date(entity[k]);
							let dateF = dF.getFullYear() + "-";
							dateF += ((dF.getMonth() + 1) < 10 ? "0" + (dF.getMonth() + 1) : (dF.getMonth() + 1)) + "-";
							dateF += (dF.getDate() < 10 ? "0" + (dF.getDate()) : dF.getDate());

							$("#" + k + " input").val(dateF);
						} else {
							$("#" + k + " input").val(entity[k]);
						}
					});
				}
				console.log("searchReLoad_OK:" + new Date());
			},
			//==========================回傳接收==========================
			otherReturn() {
				//查詢回傳
				console.log("searchReturn:" + new Date());
				//Step4.分頁歸位
				if (main.resq_data['entityJson'].length > 0) {
					let searchPageSet = JSON.parse(main.resq_data['searchPageSet']);
					other.data.searchPageSet.total = searchPageSet['total'];
					other.data.searchPageSet.batch = searchPageSet['batch'];
					other.data.searchPageSet.pageNew = 1; //單前頁碼(1-50)
					other.data.marks = {};//有選取的IKeyGKey
					other.data.markDetails = {};//有選取的IKeyGKey
					other.data.btn_intoForm = false;//預覽檢查
					//Step5.帶入資料
					if (main.resq_data['entityJson'] != "") {
						other.data.searchPageSet.entityJsons = JSON.parse(main.resq_data['entityJson']);
					}
					if (main.resq_data['entityDetailJson'] != "") {
						other.data.searchPageSet.entityDetailJsons = JSON.parse(main.resq_data['entityDetailJson']);
					}
					other.methods.searchReLoad();
				}
			},
			otherModifyReturn() {
				console.log("otherModifyReturn");
				let whois = main.resq_data['callBackValue'];
				//是存檔才更新
				if(whois==="Save"){
					//帶回資料
					let n = $("#search_cr_open tbody input:checked").attr("alt").replaceAll("row_", "");
					let entity = $(".valTbodyTr_" + n);				
					//成功後須更新選項值
					$("#c_sphbpmnbDf select").each(function (index) {
						let mrnid = $(this).find('option:selected').attr('mrnid');
						if(mrnid !== null && mrnid !== undefined){
							//取得目前選項
							let mrn0000 = parseInt($(this).find('option:selected').attr('mrn0000')) || 0;
							let sphoqty = parseInt(entity.find(".sphoqty").text()) || 0;
							let result = mrn0000 + sphoqty;
							// 若超過 9999，模擬循環從 0001 開始
							result = result % 10000;
							if (result === 0) result = 1;

							// 補 4 碼 0 的字串
							let resultStr = result.toString().padStart(4, '0');
							$(this).find('option:selected').attr('mrn0000',resultStr);
						}
					});
				}
				$("#btn_send").trigger('click');
				$('#btn_allClear').trigger('click');

			},
			//==========================初始化==========================
			destroy() {
				//銷毀
				$(".datetimepicker").remove();
				$(document).off("input change paste", "#c_sphxnb input,#c_sphfnb input");
				$(document).off("input", "#search_c #searchSelectItems");
				$(document).off("click", "#search_c #btn_clearAll");
				$(document).off("keyup", "#searchItem input");
				$(document).off("click", "#search_c #btn_send");
				$(document).off("click", "#search_c #btn_printerForm");
				$(document).off("click", "#search_c #exthDetailAll");
				$(document).off("click", "#search_c #exthAll");
				$(document).off("click", "#search_c #btn_allClear");
				$(document).off("click", "#search_c #btn_production");
				//
				$(document).off("change", "#search_c #search_cr_open .exTbodyTh input");
				console.log("other.html(destroy)");
			},
		},
	};
</script>