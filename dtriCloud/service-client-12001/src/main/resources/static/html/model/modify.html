<style>
/*Table 寬度滾動*/
#modify_c .table-responsive {
	display: block;
	width: 1px;
	overflow-x: auto;
}
/*Table 表格固定*/
#modify_c .f_c_1 {
	left: 0px;
	position: sticky;
}

#modify_c .f_c_2 {
	left: 30px;
	position: sticky;
}

#modify_c .f_c_3 {
	left: 60px;
	position: sticky;
}
/*Table 自動換行*/
#modify_c .table-responsive th, #modify_c .table-responsive td {
	text-overflow: ellipsis;
	white-space: nowrap;
	overflow: hidden;
}
/*Table 每隔表格內_框線*/
#modify_c .table-bordered td, #modify_c .table-bordered th {
	border: 1px solid #1b76fd;
	padding: 2px;
}

/*Table 表格外框線*/
#modify_c #modify_c_batch_revision table {
	min-height: 95px;
	border-collapse: separate;
	border-spacing: 0px;
}
/*Table 表格外框線*/
#modify_c #modify_c_list table {
	min-height: 95px;
	border-collapse: separate;
	border-spacing: 0px;
}
/*Table 表格內 背景色*/
#modify_c .table-white {
	--bs-table-bg: #fff;
}
/*直立式呈現邊字*/
#modify_c .wlr {
	writing-mode: vertical-lr;
	width: 20px;
}
/*標題色彩*/
#modify_c .title_color {
	background-color: #cfe2ff;
}
/*checkbox_33*/
#modify_c .checkbox_33 {
	width: 33px;
	height: 33px;
}
</style>

<div id="modify_c" class="row m-0 p-0">
	<!-- 批次修正 -->
	<div class="col-lg-12  p-0 m-0">
		<div id="modify_c_batch_revision" class="col-12 p-1">
			<div class="col-12 p-0 m-0 lh-1 text-start rounded-top bg-success text-white">
				<i class="btn btn-outline-white p-0 pr-1 pl-1 bi bi-dash-square" data-bs-toggle="collapse" data-bs-target=".modify_c_batch_revision_open" aria-expanded="false" style="width: 22px; height: 24px;"></i>
			</div>
			<div class="row m-0 collapse show modify_c_batch_revision_open" id="">
				<b class="p-0 m-0 lh-1 wlr bg-success text-white"> Batch revision Data </b>
				<div class="col border border-primary m-0 p-0 shadow-sm">
					<!-- 範例內容 -->
					<div class="col p-1 m-0 row d-none">
						<b class="p-0 m-0 lh-1 wlr border border-primary rounded-start bg-success text-white"> Ex </b>
						<table id="modify_c_ex" class="col m-0 p-0 border border-primary rounded-end table table-striped table-hover table-sm table-bordered border-primary table-responsive table-style shadow-sm">
							<thead class="table-primary">
								<tr>
									<th id="modify_c_ex_tm" class="f_c_1" style="min-width: 30px;">AD</th>
									<th id="modify_c_ex_tp" class="f_c_2" style="min-width: 30px;">CP</th>
									<th id="modify_c_ex_tkey" class="f_c_3" style="min-width: 200px;">Key</th>
									<th id="modify_c_ex_th" style="min-width: 200px;">Textarea_text</th>
									<th style="min-width: 200px;">Input_text</th>
									<th style="min-width: 200px;">Input_number</th>
									<th style="min-width: 200px;">Input_date</th>
									<th style="min-width: 200px;">Input_datetime</th>
									<th style="min-width: 200px;">Input_checkbox</th>
									<th style="min-width: 200px;">Input_password</th>
									<th style="min-width: 200px;">Input_file</th>
									<th style="min-width: 200px;">Input_download</th>
									<th style="min-width: 200px;">Select_text</th>
								</tr>
							</thead>
							<tbody class="table-white">
								<tr>
									<th id="modify_c_ex_vm" class="f_c_1" style="max-width: 30px;">
										<div class="col-12 m-0 p-0">
											<i class="btn btn-outline-danger p-0 bi bi-dash-square d-none" style="width: 24px; height: 24px;"></i>
											<div class="d-none"></div>
											<i class="btn btn-outline-success p-0 bi bi-plus-square" style="width: 24px; height: 24px;"></i>
										</div>
									</th>
									<th id="modify_c_ex_vp" class="f_c_2" style="max-width: 30px;">
										<div class="col-12 m-0 p-0">
											<i class="btn btn-outline-primary p-0 bi bi-stickies" title="_" style="width: 24px; height: 24px;"></i>
										</div>
									</th>
									<th id="modify_c_ex_vkey" style="max-width: 200px;" class="f_c_3"><div class="col-12 m-0 p-1">Key</div></th>
									<td style="max-width: 200px" id="modify_c_ex_tt"><textarea class="col-12 m-0 p-1 border border-dark form-control" rows="1"></textarea></td>
									<td style="max-width: 200px" id="modify_c_ex_it"><input class="col-12 m-0 p-1 border border-dark form-control" type="text" value="" placeholder="Ex:"></td>
									<td style="max-width: 200px" id="modify_c_ex_in"><input class="col-12 m-0 p-1 border border-dark form-control" type="number" value="" placeholder="Ex:"></td>
									<td style="max-width: 200px" id="modify_c_ex_id"><input class="col-12 m-0 p-1 border border-dark form-control datetimepicker_date" type="text" value="" placeholder="Ex:"></td>
									<td style="max-width: 200px" id="modify_c_ex_t"><input class="col-12 m-0 p-1 border border-dark form-control datetimepicker_time" type="text" value="" placeholder="Ex:"></td>
									<td style="max-width: 200px" id="modify_c_ex_icb"><input class="col-12 m-0 p-1 border border-dark form-check-input checkbox_33" type="checkbox" value="" placeholder="Ex:"></td>
									<td style="max-width: 200px" id="modify_c_ex_ic"><input class="col-12 m-0 p-1 border border-dark form-control" type="password" value="" placeholder="Ex:"></td>
									<td style="max-width: 200px" id="modify_c_ex_ip"><input class="col-12 m-0 p-1 border border-dark form-control" type="file" value="" placeholder="Ex:"></td>
									<td style="max-width: 200px" id="modify_c_ex_ii"><i class="col-12 m-0 p-1 btn btn-outline-dark bi bi-cloud-download"></i></td>
									<td style="max-width: 200px" id="modify_c_ex_st"><select class="col-12 m-0 p-1 border border-dark form-select">
											<option class="modify_st_ex" value="">請選擇(N/A)</option>
									</select></td>
								</tr>
							</tbody>
						</table>
					</div>
					<!-- 表頭批次處理 -->
					<div id="batchThAll" class="col p-1 m-0 row">
						<b class="p-0 m-0 lh-1 wlr border border-primary rounded-start bg-success text-white"> Data </b>
						<table class="col m-0 p-0 border border-primary rounded-end table table-striped table-hover table-sm table-bordered border-primary table-responsive table-style shadow-sm">
							<thead id="batchThn" class="table-primary">
								<tr>
								</tr>
							</thead>
							<tbody id="batchThv" class="table-white">
								<tr>
								</tr>
							</tbody>
						</table>
					</div>
					<!-- 取代批次處理 -->
					<div id="batchTrhAll" class="col-md-12 p-1 m-0 row">
						<b class="p-0 m-0 lh-1 wlr border border-danger rounded-start bg-danger text-white" style="font-size: 12px">Replace Data</b>
						<table class="col m-0 p-0 border border-danger rounded-end table table-striped table-hover table-sm table-bordered border-primary table-responsive table-style shadow-sm">
							<thead id="batchTrhn" class="table-danger">
								<tr>
								</tr>
							</thead>
							<tbody id="batchTrhv" class="table-white">
								<tr>
								</tr>
							</tbody>
						</table>
					</div>
				</div>
			</div>
		</div>
		<div id="modify_c_batch_revision" class="col-12 p-1">
			<div class="col-12 p-0 m-0 lh-1 text-start rounded-top bg-success text-white">
				<i class="btn btn-outline-white p-0 pr-1 pl-1 bi bi-dash-square" data-bs-toggle="collapse" data-bs-target=".modify_c_batch_revision_open" aria-expanded="false" style="width: 22px; height: 24px;"></i>
			</div>
			<div class="row m-0 collapse modify_c_batch_revision_open" id="">
				<b class="p-0 m-0 lh-1 wlr bg-success text-white"> Batch revision Detail </b>
				<div class="col border border-primary m-0 p-0 shadow-sm">
					<!-- 表身批次處理 -->
					<div id="batchTdAll" class="col-md-12 p-1 m-0 row">
						<b class="p-0 m-0 lh-1 wlr border border-primary rounded-start bg-success text-white"> Detail </b>
						<table class="col m-0 p-0 border border-primary rounded-end table table-striped table-hover table-sm table-bordered border-primary table-responsive table-style shadow-sm">
							<thead id="batchTdn" class="table-primary">
								<tr>
								</tr>
							</thead>
							<tbody id="batchTdv" class="table-white">
								<tr>
								</tr>
							</tbody>
						</table>
					</div>

					<!-- 取代批次處理 -->
					<div id="batchTrdAll" class="col-md-12 p-1 m-0 row">
						<b class="p-0 m-0 lh-1 wlr border border-danger rounded-start bg-danger text-white" style="font-size: 12px">Replace Detail</b>
						<table class="col m-0 p-0 border border-danger rounded-end table table-striped table-hover table-sm table-bordered border-primary table-responsive table-style shadow-sm">
							<thead id="batchTrdn" class="table-danger">
								<tr>
								</tr>
							</thead>
							<tbody id="batchTrdv" class="table-white">
								<tr>
								</tr>
							</tbody>
						</table>
					</div>
				</div>
			</div>
		</div>
	</div>

	<!-- 控制面板 -->
	<div id="modify_c_controller" class="col-lg-12 p-1">
		<div class="col-12 p-0 m-0 lh-1 text-start rounded-top bg-primary text-white">
			<i class="btn btn-outline-white p-0 pr-1 pl-1 bi bi-dash-square" data-bs-toggle="collapse" data-bs-target="#modify_c_controller_open" aria-expanded="false" style="width: 22px; height: 24px;"></i>
		</div>
		<div class="row m-0 collapse show" id="modify_c_controller_open">
			<b class="p-0 m-0 lh-1 wlr bg-primary text-white"> Console </b>
			<div class="col border border-primary row m-0 p-0 shadow-sm justify-content-between">
				<div class="col-md-3 p-1">
					<div class=" border border-secondary rounded">
						<div class="title_color fw-bolder rounded-top">State</div>
						<div id="modify_c_state" title="AC" class="p-1 m-0 h2 fw-bold text-center text-danger">＞Create＜</div>
					</div>
				</div>
				<div id="" class="col-md-3 p-1 ">
					<div class=" border border-secondary rounded modify_c_batch_revision_open collapse show">
						<div class="title_color fw-bolder rounded-top">Batch Data</div>
						<div class="row m-0">
							<button id="modify_c_date_overwrite" type="button" class="lh-1 col p-1 m-1 btn btn-sm btn-outline-success">
								<b>Overwrite<br>()
								</b>
							</button>
							<button id="modify_c_date_replace" type="button" class="lh-1 col p-1 m-1 btn btn-sm btn-outline-danger">
								<b>Replace<br>()
								</b>
							</button>
							<button id="modify_c_date_clearAll" type="button" class="lh-1 col p-1 m-1 btn btn-sm btn-outline-warning">
								<b>Clear<br>all()
								</b>
							</button>
						</div>
					</div>
				</div>
				<div id="" class="col-md-3 p-1 ">
					<div class=" border border-secondary rounded modify_c_batch_revision_open collapse">
						<div class="title_color fw-bolder rounded-top">Batch Detail</div>
						<div class="row m-0">
							<button id="modify_c_detail_overwrite" type="button" class="lh-1 col p-1 m-1 btn btn-sm btn-outline-success">
								<b>Overwrite<br>()
								</b>
							</button>
							<button id="modify_c_detail_replace" type="button" class="lh-1 col p-1 m-1 btn btn-sm btn-outline-danger">
								<b>Replace<br>()
								</b>
							</button>
							<button id="modify_c_detail_clearAll" type="button" class="lh-1 col p-1 m-1 btn btn-sm btn-outline-warning">
								<b>Clear<br>all()
								</b>
							</button>
						</div>
					</div>
				</div>
				<div class="col-md-2 p-1">
					<div class=" border border-secondary rounded">
						<div class="title_color fw-bolder rounded-top">Execution</div>
						<div class="row m-0">
							<button id="modify_c_save" type="submit" class="lh-1 col p-1 m-1 btn btn-sm btn-outline-primary">
								<b>Save<br>(*)
								</b>
							</button>
							<button id="modify_c_cancelAll" type="button" class="lh-1 col p-1 m-1 btn btn-sm btn-outline-warning">
								<b>Cancel<br>all()
								</b>
							</button>
						</div>
					</div>
				</div>
			</div>
		</div>
	</div>
	<form class="p-0" onsubmit="return modify.sendSave();">
		<!-- 一般多筆修正 -->
		<div id="modify_c_list" class="col-12 p-1">
			<div class="col-12 p-0 m-0 lh-1  text-start rounded-top bg-info text-white">
				<i class="btn btn-outline-white p-0 pr-1 pl-1 bi bi-dash-square" data-bs-toggle="collapse" data-bs-target="#modify_c_list_open" aria-expanded="false" style="width: 22px; height: 24px;"></i>
			</div>
			<div class="row m-0 collapse show" id="modify_c_list_open">
				<b class="p-0 m-0 lh-1 wlr bg-info text-white"> Modify list </b>
				<div id="modify_data" class="col border border-primary m-0 p-0 shadow-sm">
					<!-- 表頭修正 -->
					<div id="modifyThAll" class="col p-1 m-0 row">
						<b class="p-0 m-0 lh-1 wlr border border-primary rounded-start bg-info text-white"> Data </b>
						<table class="col m-0 p-0 border border-primary rounded-end table table-striped table-hover table-sm table-bordered border-primary table-responsive table-style shadow-sm">
							<thead id="modifyThn" class=" table-primary">

							</thead>
							<tbody id="modifyThv" class="table-white">

							</tbody>
						</table>
					</div>
					<!-- 表身批次處理 -->
					<div id="modifyTdAll" class="col p-1 m-0 row">
						<b class="p-0 m-0 lh-1 wlr border border-primary rounded-start bg-info text-white"> Detail </b>
						<table class="col m-0 p-0 border border-primary rounded-end table table-striped table-hover table-sm table-bordered border-primary table-responsive table-style shadow-sm">
							<thead id="modifyTdn" class="table-primary">

							</thead>
							<tbody id="modifyTdv" class="table-white">

							</tbody>
						</table>
					</div>
					<!-- 隔一筆群組資料-分隔線 -->
					<div id="nextOne" class="d-none col-md-12 p-0 m-0 bg-info text-center fw-bold text-white" style="font-size: 12px">Next one</div>

				</div>
			</div>
		</div>
	</form>
</div>
<script type="text/javascript">
//宣告
//console.log("modify.html(init)");
modify={
	//資料
	data:{
		entityDateTime:"",//時間欄位
		entityFormatJson:"",//格式 
	},	
	//方法
	methods:{
		create(){
			//Step0.初始化
			console.log("modify.html(created)");
			//修改項目 
			//console.log(searchSetJson['resultDetailThead']);
			//console.log(searchSetJson['resultThead']);
			modify.data.entityDateTime = main.resq_data['entityDateTime'];
			modify.data.entityFormatJson = JSON.parse(main.resq_data['entityFormatJson']);
			
			var searchSetJson = JSON.parse(main.resq_data['searchSet']);
			var searchSet = searchSetJson['searchSet'];
			var resultThead = searchSetJson['resultThead'];
			var resultDetailThead = searchSetJson['resultDetailThead'];
			//Step1.修改標題-排序
			resultThead = main.methods.orderedSort(resultThead);
			resultDetailThead = main.methods.orderedSort(resultDetailThead);
			//Step2.修改標題-資料
			//一般
			var check1=true;
			Object.keys(resultThead).forEach(function(k){
				//如果有翻譯
				var cloneBht = $($("#modify_c_ex_tkey").clone());
				cloneBht.attr("id","");
				cloneBht.removeClass("f_c_3");
				//Step2-1.標題
				cloneBht.css('minWidth',resultThead[k].width+"px");
				//Step2-2.翻譯(Batch(H/B) Modify(H/B))
				if(resultThead[k].cellLanguage!=''){
					cloneBht.text(JSON.parse(resultThead[k].cellLanguage)[$('#menu_login_language').text()]);
				}else{
					cloneBht.text(resultThead[k].cellName);
				}
				//Step2-3.欄位類型?
				var cloneBhv = "";
				switch(resultThead[k].m_type){
					case"text":
						cloneBhv = $($("#modify_c_ex_it").clone());
						break;
					case"textarea":
						cloneBhv = $($("#modify_c_ex_tt").clone());
						break;
					case"number":
						cloneBhv = $($("#modify_c_ex_in").clone());
						break;
					case"datetime":
						cloneBhv = $($("#modify_c_ex_id").clone());
						break;
					case"time":
						cloneBhv = $($("#modify_c_ex_t").clone());
						break;
					case"checkbox":
						cloneBhv = $($("#modify_c_ex_icb").clone());
						break;
					case"password":
						cloneBhv = $($("#modify_c_ex_ic").clone());
					break;
					case"file":
						cloneBhv = $($("#modify_c_ex_ip").clone());
					break;
					case"select":
						cloneBhv = $($("#modify_c_ex_st").clone());
						//比對是否有匹配選項
						for(var t=0;t<searchSet.length;t++){
							if(searchSet[t].searchName==resultThead[k].cellName && searchSet[t].type == 'select'){
								//console.log(searchSet[t].select);
								var select = searchSet[t];
								//選項
								for(var s = 0;s<select['select'].length;s++){
									var key = select['select'][s].split("_")[0];
									var val = select['select'][s].split("_")[1];
									selectEx = $($('.modify_st_ex').clone());
									selectEx.removeClass("modify_st_ex");
									selectEx.removeAttr("selected");
									selectEx.text(key);
									selectEx.val(val);
									selectEx.appendTo(cloneBhv.find('select'));
								}	
								cloneBhv.find('.modify_st_ex').removeClass("modify_st_ex");
								break;
							}
						}
						break;
					default:
						cloneBhv = $($("#modify_c_ex_it").clone());
						break;
				}
				
				cloneBhv.attr("id","");
				cloneBhv.removeClass("f_c_3");
				//Step2-4.第一筆?
				if(check1){
					check1= false;
					cloneBht.addClass("f_c_1");
					cloneBhv.addClass("f_c_1");
				}
				//Step2-5.如果隱藏
				if(resultThead[k].m_show==0){
					cloneBht.addClass('d-none');
					cloneBhv.addClass('d-none');
				}
				//Step2-6.如果固定?
				if(resultThead[k].m_fixed==1){
					cloneBhv.find("select").attr('disabled','disabled');
					cloneBhv.find("input").attr('disabled','disabled');
					cloneBhv.find("textarea").attr('disabled','disabled');
				}
				//Step2-7.如果預設值?
				cloneBhv.find("select").val(resultThead[k].m_defval);
				cloneBhv.find("input").val(resultThead[k].m_defval);
				cloneBhv.find("textarea").val(resultThead[k].m_defval);
				//Step2-7.如果提示值?
				cloneBhv.find("select").attr("placeholder",resultThead[k].m_placeholder);
				cloneBhv.find("input").attr("placeholder",resultThead[k].m_placeholder);
				cloneBhv.find("textarea").attr("placeholder",resultThead[k].m_placeholder);
				//Step2-8.定義Class?
				cloneBhv.find("select").addClass(resultThead[k].cellName).addClass('entityVal').attr("title",resultThead[k].cellName);
				cloneBhv.find("input").addClass(resultThead[k].cellName).addClass('entityVal').attr("title",resultThead[k].cellName);
				cloneBhv.find("textarea").addClass(resultThead[k].cellName).addClass('entityVal').attr("title",resultThead[k].cellName);
				cloneBhv.css('maxWidth',resultThead[k].width+"px");
				//Step2-N.創建
				cloneBht.appendTo($("#batchThn tr"));
				cloneBhv.appendTo($("#batchThv tr"));
			});
			//細節 
			check1=true;
			if(JSON.stringify(resultDetailThead)=='{}'){
				$('#modifyTdAll').addClass('d-none');
			}
			
			Object.keys(resultDetailThead).forEach(function(k){//如果有翻譯
				var cloneBdt = $($("#modify_c_ex_tkey").clone());
				cloneBdt.attr("id","");
				cloneBdt.removeClass("f_c_3");
				//Step2-1.標題
				cloneBdt.css('minWidth',resultThead[k].width+"px");
				//Step2-2.翻譯(Batch(H/B) Modify(H/B))
				if(resultThead[k].cellLanguage!=''){
					cloneBdt.text(JSON.parse(resultThead[k].cellLanguage)[$('#menu_login_language').text()]);
				}else{
					cloneBdt.text(resultThead[k].cellName);
				}
				//Step2-3.欄位類型?
				var cloneBdv = "";
				switch(resultThead[k].m_type){
					case"text":
						cloneBdv = $($("#modify_c_ex_it").clone());
						break;
					case"textarea":
						cloneBdv = $($("#modify_c_ex_tt").clone());
						break;
					case"number":
						cloneBdv = $($("#modify_c_ex_in").clone());
						break;
					case"datetime":
						cloneBdv = $($("#modify_c_ex_id").clone());
						break;
					case"time":
						cloneBdv = $($("#modify_c_ex_t").clone());
						break;
					case"checkbox":
						cloneBdv = $($("#modify_c_ex_icb").clone());
						break;
					case"password":
						cloneBdv = $($("#modify_c_ex_ic").clone());
					break;
					case"file":
						cloneBdv = $($("#modify_c_ex_ip").clone());
					break;
					case"select":
						cloneBdv = $($("#modify_c_ex_st").clone());
						//比對是否有匹配選項
						for(var t=0;t<searchSet.length;t++){
							if(searchSet[t].searchName==resultThead[k].cellName && searchSet[t].type == 'select'){
								//console.log(searchSet[t].select);
								var select = searchSet[t];
								//選項
								for(var s = 0;s<select['select'].length;s++){
									var key = select['select'][s].split("_")[0];
									var val = select['select'][s].split("_")[1];
									selectEx = $($('.modify_st_ex').clone());
									selectEx.removeClass("modify_st_ex");
									selectEx.removeAttr("selected");
									selectEx.text(key);
									selectEx.val(val);
									selectEx.appendTo(cloneBdv.find('select'));
								}	
								cloneBdv.find('.modify_st_ex').removeClass("modify_st_ex");
								break;
							}
						}
						break;
					default:
						cloneBdv = $($("#modify_c_ex_it").clone());
						break;
				}
				cloneBdv.attr("id","");
				cloneBdv.removeClass("f_c_3");
				//Step2-4.第一筆?
				if(check1){
					check1= false;
					cloneBdt.addClass("f_c_1");
					cloneBdv.addClass("f_c_1");
				}
				//Step2-5.如果隱藏
				if(resultThead[k].m_show==0){
					cloneBdt.addClass('d-none');
					cloneBdv.addClass('d-none');
				}
				//Step2-6.如果固定?
				if(resultThead[k].m_fixed==1){
					cloneBdv.find("select").attr('disabled','disabled');
					cloneBdv.find("input").attr('disabled','disabled');
					cloneBdv.find("textarea").attr('disabled','disabled');
				}
				//Step2-7.如果預設值?
				cloneBdv.find("select").val(resultThead[k].m_defval);
				cloneBdv.find("input").val(resultThead[k].m_defval);
				cloneBdv.find("textarea").val(resultThead[k].m_defval);
				//Step2-7.如果提示值?
				cloneBdv.find("select").attr("placeholder",resultThead[k].m_placeholder);
				cloneBdv.find("input").attr("placeholder",resultThead[k].m_placeholder);
				cloneBdv.find("textarea").attr("placeholder",resultThead[k].m_placeholder);
				//Step2-8.定義Class?
				cloneBdv.find("select").addClass(resultThead[k].cellName).addClass('entityVal').attr("title",resultThead[k].cellName);;
				cloneBdv.find("input").addClass(resultThead[k].cellName).addClass('entityVal').attr("title",resultThead[k].cellName);;
				cloneBdv.find("textarea").addClass(resultThead[k].cellName).addClass('entityVal').attr("title",resultThead[k].cellName);;
				cloneBdv.css('maxWidth',resultThead[k].width+"px");
				//Step2-N.創建
				cloneBdt.appendTo($("#batchTdn tr"));
				cloneBdv.appendTo($("#batchTdv tr"));
			});
			
			//複寫-Replace Data/Detail
			$('#batchThn tr').clone().appendTo("#batchTrhn");
			$('#batchThv tr').clone().appendTo("#batchTrhv");
			$('#batchTdn tr').clone().appendTo("#batchTrdn");
			$('#batchTdv tr').clone().appendTo("#batchTrdv");
			
			//修改-Modify list
			$('#batchThn tr').clone().appendTo("#modifyThn");
			$('#batchThv tr').clone().appendTo("#modifyThv");
			$("#modifyThn .f_c_1").removeClass("f_c_1").addClass("f_c_3");
			$("#modifyThv .f_c_1").removeClass("f_c_1").addClass("f_c_3");
			$('#modify_c_ex_tp').clone().attr("id","").prependTo("#modifyThn tr");
			$('#modify_c_ex_tm').clone().attr("id","").prependTo("#modifyThn tr");
			$('#modify_c_ex_vp').clone().attr("id","").prependTo("#modifyThv tr");
			$('#modify_c_ex_vm').clone().attr("id","").prependTo("#modifyThv tr");
			$('#modifyThv tr').addClass('modifyThvEx');
			$('#modifyThv tr input').addClass("d-none");
			$('#modifyThv tr select').addClass("d-none");
			$('#modifyThv tr textarea').addClass("d-none");
			
			$('#batchTdn tr').clone().appendTo("#modifyTdn");
			$('#batchTdv tr').clone().appendTo("#modifyTdv");
			$("#modifyTdn .f_c_1").removeClass("f_c_1").addClass("f_c_3");
			$("#modifyTdv .f_c_1").removeClass("f_c_1").addClass("f_c_3");
			$('#modify_c_ex_tp').clone().attr("id","").prependTo("#modifyTdn tr");
			$('#modify_c_ex_tm').clone().attr("id","").prependTo("#modifyTdn tr");
			$('#modify_c_ex_vp').clone().attr("id","").prependTo("#modifyTdv tr");
			$('#modify_c_ex_vm').clone().attr("id","").prependTo("#modifyTdv tr");
			$('#modifyTdv tr').addClass('modifyTdvEx');
			$('#modifyTdv tr input').addClass("d-none");
			$('#modifyTdv tr select').addClass("d-none");
			$('#modifyTdv tr textarea').addClass("d-none");
			//時間格式
			modify.methods.datetimepickerDate();

			//監聽-Modify list
			//Data
			$(document).off("click", "#modifyThAll .modifyThvEx .bi-plus-square");//++
			$(document).on("click", "#modifyThAll .modifyThvEx .bi-plus-square", function (event) {
				console.log("modifyThAll bi-plus-square");
				var modifyThvEx = $('.modifyThvEx').clone();
				modifyThvEx.removeClass('modifyThvEx');
				modifyThvEx.find(".bi-plus-square").addClass('d-none');
				modifyThvEx.find(".bi-dash-square").removeClass('d-none');
				modifyThvEx.addClass('modifyThvM');
				modifyThvEx.find('input').removeClass("d-none");
				modifyThvEx.find('select').removeClass("d-none");
				modifyThvEx.find('textarea').removeClass("d-none");
				modifyThvEx.appendTo("#modifyThv");
				modify.methods.datetimepickerDate();
				
			});
			$(document).off("click", "#modifyThAll .modifyThvM .bi-dash-square");//--
			$(document).on("click", "#modifyThAll .modifyThvM .bi-dash-square", function (event) {
				console.log("modifyThAll bi-dash-square");
				$(event.target.parentElement.parentElement.parentElement).remove();
			});
			$(document).off("click", "#modifyThAll .modifyThvM .bi-stickies");//copy
			$(document).on("click", "#modifyThAll .modifyThvM .bi-stickies", function (event) {
				console.log("modifyThAll bi-stickies");
				var copy = $(event.target.parentElement.parentElement.parentElement).clone();
				//Data : 將現有ID /GID 清除
				var id = copy.find('.bi-stickies').attr('title').split("_")[0];
				var gid = copy.find('.bi-stickies').attr('title').split("_")[1];
				if(id!=""){copy.find('.'+id).val("");}
				if(gid!=""){copy.find('.'+gid).val("");}
				
				copy.removeClass('modifyTdvEx');
				copy.removeClass('modifyThvEx');
				copy.find(".bi-plus-square").addClass('d-none');
				copy.find(".bi-dash-square").removeClass('d-none');
				copy.addClass('modifyThvM');
				console.log();
				copy.appendTo("#modifyThv");
				modify.methods.datetimepickerDate();
				
			});
			//Detail
			$(document).off("click", "#modifyTdAll .modifyTdvEx .bi-plus-square");//++
			$(document).on("click", "#modifyTdAll .modifyTdvEx .bi-plus-square", function (event) {
				console.log("modifyTdAll bi-plus-square");
				var modifyTdvEx = $('.modifyTdvEx').clone(); 
				modifyTdvEx.removeClass('modifyTdvEx');
				modifyTdvEx.find(".bi-plus-square").addClass('d-none');
				modifyTdvEx.find(".bi-dash-square").removeClass('d-none');
				modifyTdvEx.addClass('modifyTdvM');
				modifyTdvEx.find('input').removeClass("d-none");
				modifyTdvEx.find('select').removeClass("d-none");
				modifyTdvEx.find('textarea').removeClass("d-none");
				modifyTdvEx.appendTo("#modifyTdv");
				modify.methods.datetimepickerDate();
			});
			$(document).off("click", "#modifyTdAll .modifyTdvM .bi-dash-square");//--
			$(document).on("click", "#modifyTdAll .modifyTdvM .bi-dash-square", function (event) {
				console.log("modifyTdAll bi-dash-square");
				$(event.target.parentElement.parentElement.parentElement).remove();
			});
			$(document).off("click", "#modifyTdAll .modifyTdvM .bi-stickies");//copy
			$(document).on("click", "#modifyTdAll .modifyTdvM .bi-stickies", function (event) {
				console.log("modifyTdAll bi-stickies");
				var copy = $(event.target.parentElement.parentElement.parentElement).clone();
				//Detail : 將現有ID 
				var id = copy.find('.bi-stickies').attr('title').split("_")[0];
				var gid = copy.find('.bi-stickies').attr('title').split("_")[1];
				if(id!=""){copy.find('.'+id).val("");}
				
				copy.removeClass('modifyTdvEx');
				copy.find(".bi-plus-square").addClass('d-none');
				copy.find(".bi-dash-square").removeClass('d-none');
				copy.addClass('modifyTdvM');
				copy.insertBefore(".gkey_"+copy.find('.'+gid).val());//添加在該群組範圍內
				modify.methods.datetimepickerDate();
			});
			
			//複寫Date
			$(document).off("click", "#modify_c_date_overwrite");
			$(document).on("click", "#modify_c_date_overwrite", function (event) {
				console.log("modify_c_date_overwrite");
				$('#batchThv .entityVal').each(function( index ) {
					  console.log( index + ": "+$( this ).attr('title')+": " + $( this ).val() );
					  //覆蓋內容
					  if($( this ).attr('disabled')!='disabled' && $( this ).val()!='' && $( this ).val()!=null){
						  $('#modifyThAll .'+$( this ).attr('title')).val($( this ).val());
					  }
				});
			});
			//複寫Date->取代->
			$(document).off("click", "#modify_c_date_replace");
			$(document).on("click", "#modify_c_date_replace", function (event) {
				console.log("modify_c_date_replace");
				$('#batchThv .entityVal').each(function( index ) {
					  console.log( index + ": "+$( this ).attr('title')+": " + $( this ).val() );
					  if($( this ).attr('disabled')!='disabled' && $( this ).val()!='' && $( this ).val()!=null){
						  var batchVal = $( this ).val();
						  var replaceVal = $('#batchTrhv .'+$( this ).attr('title')).val();
						  //關鍵字取代
						  if(replaceVal!="" &&replaceVal!=null){
							  $('#modifyThAll .'+$( this ).attr('title')).each(function( indexCell ) {
								  $( this ).val($( this ).val().replaceAll(replaceVal,batchVal));
							  });				  
						  }
					  }
				});
				$('#batchThv .entityVal').val('');
				$('#batchTrhv .entityVal').val('');
			});
			//複寫Date->清除
			$(document).off("click", "#modify_c_date_clearAll");
			$(document).on("click", "#modify_c_date_clearAll", function (event) {
				console.log("modify_c_date_clearAll");
				$('#batchThv .entityVal').val('');
				$('#batchTrhv .entityVal').val('');
			});
			
			//複寫Detail
			$(document).off("click", "#modify_c_detail_overwrite");
			$(document).on("click", "#modify_c_detail_overwrite", function (event) {
				console.log("modify_c_detail_overwrite");
				$('#batchTdv .entityVal').each(function( index ) {
				console.log( index + ": "+$( this ).attr('title')+": " + $( this ).val() );
				if($( this ).attr('disabled')!='disabled' && $( this ).val()!='' && $( this ).val()!=null){
						if($( this ).attr('disabled')!='disabled'){
							$('#modifyTdAll .'+$( this ).attr('title')).val($( this ).val());
						}
					}
				});
			});
			//複寫Detail->取代->
			$(document).off("click", "#modify_c_detail_replace");
			$(document).on("click", "#modify_c_detail_replace", function (event) {
				console.log("modify_c_detail_replace"); 
				$('#batchTdv .entityVal').each(function( index ) { 
					  console.log( index + ": "+$( this ).attr('title')+": " + $( this ).val() );
					  if($( this ).attr('disabled')!='disabled' && $( this ).val()!='' && $( this ).val()!=null){
						  var batchVal = $( this ).val();
						  var replaceVal = $('#batchTrdv .'+$( this ).attr('title')).val();
						  //關鍵字取代
						  if(replaceVal!="" &&replaceVal!=null){
							  $('#modifyTdAll .'+$( this ).attr('title')).each(function( indexCell ) {
								  if($( this ).attr('disabled')!='disabled'){
									  $( this ).val($( this ).val().replaceAll(replaceVal,batchVal));								  
								  }
							  });
						  }
					  }
				});
				$('#batchTdv .entityVal').val('');
				$('#batchTrdv .entityVal').val('');
			});
			//複寫Detail->清除
			$(document).off("click", "#modify_c_detail_clearAll");
			$(document).on("click", "#modify_c_detail_clearAll", function (event) {
				console.log("modify_c_detail_clearAll");
				$('#batchTdv .entityVal').val('');
				$('#batchTrdv .entityVal').val('');
			});
			
			//Execution
			$(document).off("click", "#modify_c_save");
			$(document).on("click", "#modify_c_save", function (event) {
				console.log("modify_c_save");
				modify.methods.searchSend();
			});
			$(document).off("click", "#modify_c_cancelAll");
			$(document).on("click", "#modify_c_cancelAll", function (event) {
				console.log("modify_c_cancelAll");
				$('.modifyThvM').remove();
				$('.modifyTdvM').remove();
				$('.nextOne').remove();
				$('#modify_c_state').text("＞Create＜");
				$('#modify_c_state').attr('title','AC');
				 
			});
			
		},
		//==========================處理資料==========================
		modify(order,datas,dataDetails,entityDateTime,ikey,gkey){
			console.log("=====order:"+order+"=====");
			console.log(datas);
			console.log(dataDetails);
			$('.modifyThvM').remove();
			$('.modifyTdvM').remove();
			$('.nextOne').remove();
			
			$('#modify_title').trigger('click');
			$('#modify_c_state').text("＞Create＜");
			$('#modify_c_state').attr('title','AC');
			
			switch(order){
			case "saveAs":
			case "modify":
			case "invalid":
			case "delete":
				//一般
				if(datas.length>0){
					for(var d=0;d<datas.length;d++){
						var modifyThvEx = $('.modifyThvEx').clone();
						modifyThvEx.find('input').removeClass("d-none");
						modifyThvEx.find('select').removeClass("d-none");
						modifyThvEx.find('textarea').removeClass("d-none");
						modifyThvEx.find('.bi-stickies').attr("title",ikey+"_"+gkey);
						modifyThvEx.find(".bi-plus-square").addClass('d-none');
						modifyThvEx.find(".bi-dash-square").removeClass('d-none');
						modifyThvEx.removeClass('modifyThvEx');
						modifyThvEx.addClass('modifyThvM');
						var dataOne =  datas[d];
						//每個欄位 >對應< 資料
						Object.keys(dataOne).forEach(function(k){
							//是否時間格式?
							var value = dataOne[k];
							if(entityDateTime.indexOf(k)>=0){
								 var dF = new Date(dataOne[k]);
								 value = dF.getFullYear()+"-"+(dF.getMonth()+1)+"-"+dF.getDate()+" "+
								 dF.getHours()+":"+dF.getMinutes()+":"+dF.getSeconds();
							}
							modifyThvEx.find("."+k).val(value);
						});
						modifyThvEx.appendTo("#modifyThv");						
					}
				}
				//細節
				if(dataDetails.length>0){
					var newGkey=dataDetails[0][gkey];
					var newIkey=dataDetails[0][ikey];
					//分隔線
					var nextOneTr = $("<tr><td></td></tr>");
					nextOneTr.find("td").attr("colspan",(Object.keys(dataDetails[0]).length+2));
					nextOneTr.addClass("nextOne");
					var nextOne = $("#nextOne").clone().removeAttr("id").removeClass("d-none");
					nextOne.appendTo(nextOneTr.find("td")); 
					
					for(var d=0;d<dataDetails.length;d++){
						var modifyTdvEx = $('.modifyTdvEx').clone();
						modifyTdvEx.find('input').removeClass("d-none");
						modifyTdvEx.find('select').removeClass("d-none");
						modifyTdvEx.find('textarea').removeClass("d-none");
						modifyTdvEx.find('.bi-stickies').attr("title",ikey+"_"+gkey);
						modifyTdvEx.find(".bi-plus-square").addClass('d-none');
						modifyTdvEx.find(".bi-dash-square").removeClass('d-none');
						modifyTdvEx.removeClass('modifyTdvEx');
						modifyTdvEx.addClass('modifyTdvM');
						var dataDetailOne =  dataDetails[d];
						//每個欄位 >對應< 資料
						Object.keys(dataDetailOne).forEach(function(k){
							//是否時間格式?
							var value = dataDetailOne[k];
							if(entityDateTime.indexOf(k)>=0){
								 var dF = new Date(dataDetailOne[k]);
								 value = dF.getFullYear()+"-"+(dF.getMonth()+1)+"-"+dF.getDate()+" "+
								 dF.getHours()+":"+dF.getMinutes()+":"+dF.getSeconds();
							}
							modifyTdvEx.find("."+k).val(value);
						});
						
						//分隔資料線-中間
						if(newGkey!=dataDetails[d][gkey] && gkey!=null &&gkey!=""){
							newGkey = dataDetails[d][gkey];
							nextOneTr.clone().addClass('gkey_'+dataDetails[d-1][gkey]).appendTo("#modifyTdv");
						}
						modifyTdvEx.appendTo("#modifyTdv");
					}
					//分隔資料線-最後
					nextOneTr.clone().addClass('gkey_'+dataDetails[dataDetails.length-1][gkey]).appendTo("#modifyTdv");
				}
				break;
			}
			//區分
			switch(order){
			case "create":
				$('#modify_c_state').text("＞Create＜");
				$('#modify_c_state').attr('title','AC');
				break;
			case "saveAs":
				$('#modify_c_state').text("＞saveAs＜");
				$('#modify_c_state').attr('title','AC');
				break;
			case "modify":
				$('#modify_c_state').text("＞Modify＜");
				$('#modify_c_state').attr('title','AU');
				break;
			case "invalid":
				$('#modify_c_state').text("＞Invalid＜");
				$('.modifyThvM input').attr("disabled","disabled");
				$('.modifyThvM select').attr("disabled","disabled");
				$('.modifyThvM textarea').attr("disabled","disabled");
				$('.modifyTdvM input').attr("disabled","disabled");
				$('.modifyTdvM select').attr("disabled","disabled");
				$('.modifyTdvM textarea').attr("disabled","disabled");
				$('#modify_c_state').attr('title','AD');
				break;
			case "delete":
				$('#modify_c_state').text("＞Delete＜");
				$('.modifyThvM input').attr("disabled","disabled");
				$('.modifyThvM select').attr("disabled","disabled");
				$('.modifyThvM textarea').attr("disabled","disabled");
				$('.modifyTdvM input').attr("disabled","disabled");
				$('.modifyTdvM select').attr("disabled","disabled");
				$('.modifyTdvM textarea').attr("disabled","disabled");
				$('#modify_c_state').attr('title','DD');
				break;
			}
			//時間格式
			modify.methods.datetimepickerDate();
		},
		//傳送
		searchSend(){
			var entityFormatJson = {};
			var entityJsons = [];//回傳一般資料
			var entityDetailJsons= [];//回傳細節資料
			var entityDateTime = modify.data.entityDateTime;
			var data={};
			var req_data={};
			var searchPageSet={};
			var action = $('#modify_c_state').attr('title');
			//一般資料->每一筆資料
			$('.modifyThvM').each(function(index){ 
				//每一格欄位
				entityFormatJson = {};
				$(this).find('.entityVal').each(function(index){ 
					var val = $(this).val();
					//可能是時間格式
					if(entityDateTime.indexOf($(this).attr("title"))>=0){
						val = new Date(val).getTime();	
					}
				 	entityFormatJson[$(this).attr("title")] = val;
				});
				entityJsons.push(entityFormatJson);
			 
			});
			//細節資料->每一筆資料
			$('.modifyTdvM').each(function(index){ 
				//每一格欄位
				entityFormatJson = {};
				$(this).find('.entityVal').each(function(index){ 
					var val = $(this).val();
					//可能是時間格式
					if(entityDateTime.indexOf($(this).attr("title"))>=0){
						val = new Date(val).getTime();	
					}
					entityFormatJson[$(this).attr("title")] = val;
				});
				entityDetailJsons.push(entityFormatJson);
			});
			
			data['entityJson'] = JSON.stringify(entityJsons);
			data['entityDetailJson'] = JSON.stringify(entityDetailJsons);
			console.log(entityJsons);
			console.log(entityDetailJsons);
			
			
			//包裝
			req_data['data'] = data;
			req_data['url'] = "system_config.basil."+$('#modify_c_state').attr('title');
			req_data['type'] = "POST";
			main.methods.ajaxSend(req_data);
			
		},
		datetimepickerDate(){
			//日期時間格式
			$('#modify_c .datetimepicker_date').datetimepicker({
				format: 'yyyy-mm-dd hh:ii:00',
				pickerPosition: 'bottom-right',
				//minView:1,
				// hoursDisabled: [00, 1, 2, 3, 4, 5, 6],
				minuteStep: 30,
				autoclose: true,
				endDate: '+1d',
				datesDisabled: '+1d',
				todayBtn: true,
				bootcssVer:5,
				//......可以同上項目代碼自定義設置
			});
			//時間格式
            $('#modify_c .datetimepicker_time').datetimepicker({
                format: 'hh:ii',
                startView: 1,
                minuteStep: 30,
                pickDate: false,
                autoclose: true,
                timeFormat: 'hh:mm',
            });
		},
		destroy() {
			//銷毀
			console.log("modify.html(destroy)");
			
		},
	},	
};
</script>