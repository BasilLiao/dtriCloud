<style>
/*Table 寬度滾動*/
#search_c .table-responsive {
	display: block;
	width: 100%;
	overflow-x: auto;
}
/*Table 自動隱藏*/
#search_c .table-responsive th, #search_c .table-responsive td {
	text-overflow: ellipsis;
	white-space: nowrap;
	overflow: hidden;
}
/*Table 表格固定*/
#search_c .fixedC1 {
	left: 0px;
	position: sticky;
}
/*Table 每隔表格內_框線*/
#search_c .table-bordered td, #search_c .table-bordered th {
	border: 1px solid #1b76fd;
	padding: 2px;
}
/*Table 表格外框線*/
#search_c #search_c_result table {
	min-height: 645px;
	border-collapse: separate;
	border-spacing: 0px;
}
/*Table 表格外框線*/
#search_c #search_c_result_detail table {
	max-height: 645px;
	border-collapse: separate;
	border-spacing: 0px;
}
/*Table 表格內 背景色*/
#search_c .table-white {
	--bs-table-bg: #fff;
}
/*覆寫換色*/
.table-hover>tbody>tr:hover>* {
	--bs-table-accent-bg: #0d6efd40;
	color: var(--bs-table-hover-color);
}
/*標題色彩*/
#search_c .title_color {
	background-color: #cfe2ff;
}
/*直立式呈現邊字*/
#search_c .wlr {
	writing-mode: vertical-lr;
	width: 20px;
}

/*checkbox_24*/
#search_c .checkbox_24 {
	width: 24px;
	height: 24px;
}
</style>
<div id="search_c">
	<!-- 查詢面板 -->
	<div id="search_c_item" class="col-12 p-1">
		<div class="col-12 p-0 m-0 lh-1 text-start rounded-top bg-success text-white">
			<i class="btn btn-outline-white p-0 pr-1 pl-1 bi bi-dash-square" data-bs-toggle="collapse" data-bs-target="#search_c_item_open" aria-expanded="false" style="width: 22px; height: 24px;"></i>
		</div>
		<div class="row m-0 collapse show" id="search_c_item_open">
			<b class="p-0 m-0 lh-1 wlr bg-success text-white"> Search </b>
			<div class="col border border-primary  row m-0 p-0 shadow-sm">
				<div class="col-md-1 p-1">
					<div class=" border border-secondary rounded">
						<div class="title_color fw-bolder rounded-top">Search1</div>
						<div class="p-1">
							<input class="col-12 m-0 p-1 border border-dark form-control" type="text" id="ex_id" name="ex_name" placeholder="Ex:123" autofocus>
						</div>
					</div>
				</div>
				<div class="col-md-1 p-1">
					<div class=" border border-secondary rounded">
						<div class="title_color fw-bolder rounded-top">Search2</div>
						<div class="p-1">
							<select class="col-12 m-0 p-1 border border-dark form-select" id="ex_id2" name="ex_name2">
								<option value="" selected="selected">select(請選擇)</option>
								<option></option>
							</select>
						</div>
					</div>
				</div>
			</div>
		</div>
	</div>
	<!-- 控制面板 -->
	<div id="search_c_controller" class="col-12 p-1 ">
		<div class="col-12 p-0 m-0 lh-1 text-start rounded-top bg-primary text-white">
			<i class="btn btn-outline-white p-0 pr-1 pl-1 bi bi-dash-square" data-bs-toggle="collapse" data-bs-target="#search_c_controller_open" aria-expanded="false" style="width: 22px; height: 24px;"></i>
		</div>
		<div id="search_c_controller_open" class="row m-0 collapse show">
			<b class="p-0 m-0 lh-1 wlr bg-primary text-white"> Console </b>
			<div class="col border border-primary row m-0 p-0 shadow-sm justify-content-between">
				<div class="col-md-4 p-1">
					<div class=" border border-secondary rounded">
						<div class="title_color fw-bolder rounded-top">Execution</div>
						<div class="row m-0">
							<button type="button" class="lh-1 col p-1 m-1 btn btn-sm btn-outline-secondary" data-bs-toggle="collapse" data-bs-target="#search_c_result_detail_open" aria-expanded="false">
								<b>Detail<br>()
								</b>
							</button>
							<button type="button" class="lh-1 col p-1 m-1 btn btn-sm btn-outline-primary">
								<b>Create<br>new(AC)
								</b>
							</button>
							<button type="button" class="lh-1 col p-1 m-1 btn btn-sm btn-outline-success">
								<b>Save<br>as...(AC)
								</b>
							</button>
							<button type="button" class="lh-1 col p-1 m-1 btn btn-sm btn-outline-warning">
								<b>Modify<br>(AU)
								</b>
							</button>
							<button type="button" class="lh-1 col p-1 m-1 btn btn-sm btn-outline-danger">
								<b>Invalid<br>(AD)
								</b>
							</button>
							<button type="button" class="lh-1 col p-1 m-1 btn btn-sm btn-outline-dark">
								<b>Delete<br>(DD)
								</b>
							</button>
						</div>
					</div>
				</div>
				<div class="col-md-2 p-1">
					<div class=" border border-secondary rounded">
						<div class="title_color fw-bolder rounded-top">Special</div>
						<div class="row m-0">
							<button type="button" class="lh-1 col p-1 m-1 btn btn-sm btn-outline-primary">
								<b>Mark<br>cancel()
								</b>
							</button>
							<button type="button" class="lh-1 col p-1 m-1 btn btn-sm btn-outline-info">
								<b>Printer<br>form()
								</b>
							</button>
							<button type="button" class="lh-1 col p-1 m-1 btn btn-sm btn-outline-success">
								<b>Compare<br>()
								</b>
							</button>
						</div>
					</div>
				</div>
				<div class="col-md-2 p-1">
					<div class=" border border-secondary rounded">
						<div class="title_color fw-bolder rounded-top">Search</div>
						<div class="row m-0">
							<button type="button" class="lh-1 col p-1 m-1 btn btn-sm btn-outline-primary">
								<b>Send<br>(AR)
								</b>
							</button>
							<button type="button" class="lh-1 col p-1 m-1 btn btn-sm btn-outline-success">
								<b>Clear<br>all()
								</b>
							</button>
						</div>
					</div>
				</div>
				<div class="col-md-2 p-1">
					<div class=" border border-secondary rounded">
						<div class="title_color fw-bolder rounded-top">Page</div>
						<div class="row m-0">
							<button type="button" class="lh-1 col p-1 m-1 btn btn-sm btn-outline-primary">
								<b>＜＜<br>Page
								</b>
							</button>
							<input id="numberPage" class="lh-base col p-1 m-1" name="page" type="number" placeholder="1-50" value="1" />
							<button type="button" class="lh-1 col p-1 m-1 btn btn-sm btn-outline-primary">
								<b>＞＞<br>Page
								</b>
							</button>
						</div>
					</div>
				</div>
			</div>
		</div>
	</div>
	<!-- 查詢結果 -->
	<div id="search_c_result" class="col-12 m-0 p-1">
		<div class="col-12 p-0 m-0 lh-1 text-start rounded-top bg-info text-white">
			<i class="btn btn-outline-white p-0 pr-1 pl-1 bi bi-dash-square" data-bs-toggle="collapse" data-bs-target="#search_c_result_open" aria-expanded="false" style="width: 22px; height: 24px;"></i>
		</div>
		<div id="search_c_result_open" class="row m-0 collapse show">
			<b class="p-0 m-0 lh-1 wlr bg-info text-white"> Result </b>
			<table class="col m-0 p-0 border border-primary table table-striped table-hover table-sm table-bordered border-primary table-responsive table-style shadow-sm">
				<thead class="table-primary">
					<tr>
						<th class="fixedC1" style="min-width: 40px;">
							<div>
								<button id="exTheadthAll" type="button" class="lh-1 col p-1 m-0 btn btn-sm btn-outline-dark">
									<b>M</b>
								</button>
							</div>
						</th>
						<th class="exTheadth d-none" style="min-width: 100px;">N/A</th>
					</tr>
				</thead>
				<tbody class="table-white">
					<tr class="exTbodyTr">
						<th class="fixedC1 exTbodyTh" style="max-width: 40px;">
							<div>
								<input disabled="disabled" alt="row_x" title="IKey_GKey" type="checkbox" class="m-0 form-check-input checkbox_24 border border-dark">
							</div>
						</th>
						<td class="exTbodytd d-none" style="max-width: 100px"></td>
					</tr>
				</tbody>
			</table>
		</div>
	</div>
	<!-- 查詢-細節結果 -->
	<div id="search_c_result_detail" class="col-12 m-0 p-1">
		<div class="col-12 p-0 m-0 lh-1 text-start rounded-top bg-secondary text-white">
			<i class="btn btn-outline-white p-0 pr-1 pl-1 bi bi-dash-square" data-bs-toggle="collapse" data-bs-target="#search_c_result_detail_open" aria-expanded="false" style="width: 22px; height: 24px;"></i>
		</div>
		<div id="search_c_result_detail_open" class="row m-0 collapse">
			<b class="p-0 m-0 lh-1 wlr  bg-secondary text-white"> Result detail </b>
			<table class=" col m-0 p-0 border border-primary  table table-striped table-hover table-sm table-bordered border-primary table-responsive table-style shadow-sm">
				<thead class="table-primary">
					<tr>
						<th class="fixedC1" style="min-width: 40px;">
							<div>
								<button type="button" class="lh-1 col p-1 m-0 btn btn-sm btn-outline-dark">
									<b>M</b>
								</button>
							</div>
						</th>
						<th style="min-width: 100px;">N/A</th>

					</tr>
				</thead>
				<tbody class="table-white">
					<tr class="exDetailTbodyTr">
						<th class="fixedC1 exDetailTbodyTh" style="max-width: 40px;">
							<div>
								<input type="checkbox" alt="row_x" title="IKey_GKey" class="m-0 form-check-input checkbox_24 border border-dark">
							</div>
						</th>
						<td style="max-width: 1000px">Mark</td>
					</tr>

				</tbody>
			</table>
		</div>
	</div>
</div>
<script type="text/javascript">
//宣告
//console.log("search.html(init)");
main.web_body.search={
	//資料
	data:{
		marks:[],//有選取的IKeyGKey

	},	
	//方法
	methods:{
		create(){
			//Step1.初始化
			console.log("search.html(created)");
			//查詢結果
			var searchSetJson = JSON.parse(main.resq_data['searchSet']);
			console.log(searchSetJson);
			
			//Step1.查詢結果標題-排序
			var resultThead = searchSetJson['resultThead'];
			resultThead = main.methods.orderedSort(resultThead);
			
			//Step2.查詢結果標題-資料
			var check1=true;
			Object.keys(resultThead).forEach(function(k){
				//console.log(k + ' - ' + resultThead[k]);
				//複製格式
				var exTheadth = $($('.exTheadth').clone());
				var exTbodytd = $($('.exTbodytd').clone());
				exTheadth.removeClass('exTheadth');
				exTheadth.removeClass('d-none')
				exTheadth.addClass('titTheadth');
				//
				exTbodytd.removeClass('exTbodytd');
				exTbodytd.removeClass('d-none')
				exTbodytd.addClass('valTbodytd');
				exTbodytd.addClass(resultThead[k].cellName);
				//固定第一格式
				if(check1 && resultThead[k].show==1){
					check1=false;
					exTheadth.addClass('fixedC1');
					exTheadth.css('left',"40px");
					exTbodytd.addClass('fixedC1');
					exTbodytd.css('left',"40px");
				}
				//如果有翻譯
				if(resultThead[k].cellLanguage!=''){
					exTheadth.text(JSON.parse(resultThead[k].cellLanguage)[$('#menu_login_language').text()]);
					exTheadth.css('minWidth',resultThead[k].width+"px");
					exTbodytd.css('maxWidth',resultThead[k].width+"px");
				}else{
					exTheadth.text(resultThead[k].cellName);
					exTheadth.css('minWidth',resultThead[k].width+"px");
					exTbodytd.css('maxWidth',resultThead[k].width+"px");
				}
				//如果隱藏
				if(resultThead[k].show==0){
					exTheadth.addClass('d-none');
					exTbodytd.addClass('d-none');
				}
				
				
				//添加
				$('.exTheadth').before(exTheadth);
				$('.exTbodytd').before(exTbodytd);
			});
			
			//Step3.查詢內容-格式
			for(var b=1;b<=20;b++){
				var exTbodyTr = $($('.exTbodyTr').clone());
				exTbodyTr.removeClass('exTbodyTr');
				exTbodyTr.removeClass('d-none');
				exTbodyTr.addClass('valTbodyTr_'+b);
				exTbodyTr.find('input').attr("alt","row_"+b);
				$('.exTbodyTr').before(exTbodyTr);
			}
			$('.exTbodyTr').addClass('d-none');
			
			//Step4.帶入資料
			var entityJsons = JSON.parse(main.resq_data['entityJson']);
			var entityIKey = main.resq_data['entityIKeyGKey'].split("_")[0];
			var entityGKey = main.resq_data['entityIKeyGKey'].split("_")[1];
			var entityDateTime = main.resq_data['entityDateTime'];
			console.log(entityJsons);
			var x = 0;//起始戳記
			var y= 20;//每頁數量
			for(x;x<y;x++){
				//筆數還夠
				if(x< entityJsons.length){
					var entity = entityJsons[x];
					var iKey = "";
					var gKey = "";
					Object.keys(entity).forEach(function(k){
						
						$('.valTbodyTr_'+x+' input').removeAttr("disabled");
						//是否IKEY?
							if(entityIKey==k){iKey= entity[k];}	
						//是否GKEY?
							if(entityGKey==k){gKey= entity[k];}	
						//是否時間格式?
						if(entityDateTime.indexOf(k)>=0){
							 var dF = new Date(entity[k]);
							 var dateF = dF.getFullYear()+"-"+(dF.getMonth()+1)+"-"+dF.getDate()+" "+dF.getHours()+":"+dF.getMinutes()+":"+dF.getSeconds();
							$('.valTbodyTr_'+x+' .'+k).text(dateF);
						}else{
							$('.valTbodyTr_'+x+' .'+k).text(entity[k]);
						}
						$('.valTbodyTr_'+x+' input').attr("title",iKey+"_"+gKey);
					});
				}
			}
			
			//監聽-換頁數
			$(document).off("change", "#numberPage");
			$(document).on("change", "#numberPage", function () {
				 if ($(this).val() > 50){$(this).val(50);}
		         else if ($(this).val() < 1){ $(this).val(1);}      
			});
			//監聽-選取資料
			$(document).off("change", ".exTbodyTh input");
			$(document).on("change", ".exTbodyTh input", function (event) {
				var Ikey_Gkey = event.target.title;
				var check = event.target.checked;
				var mark = {};
				//標記-選取|解除
				if(check==true){
					mark['Ikey_Gkey'] = Ikey_Gkey;
					main.web_body.search.data.marks.push(mark);
				}else{
					for(var k in main.web_body.search.data.marks) {
						if( main.web_body.search.data.marks[k]['Ikey_Gkey'] == Ikey_Gkey){
							main.web_body.search.data.marks.splice(k, 1);
							break;
						};
					}
				}
				console.log(main.web_body.search.data.marks);				
			});
			//監聽-全選資料
			$(document).off("click", "#exTheadthAll");
			$(document).on("click", "#exTheadthAll", function (event) {
				//都有勾選?
				var clickAll = true;
				$(".exTbodyTh").each(function(){
					if($(this).find("input").attr("disabled")!="disabled" && $(this).find("input").prop("checked")==false){
						$(this).find("input").trigger("click");
						clickAll = false;
					}
				});
				//全部取消?
				if(clickAll){
					$(".exTbodyTh").find("input").trigger("click");
				}
			});
		},
		destroy() {
			//銷毀
			$(document).off("click", "#exTheadthAll");
			$(document).off("change", "#numberPage");
			$(document).off("change", ".exTbodyTh input");
			console.log("search.html(destroy)");
			
		},
	},	
};
</script>