SELECT --OK 製令單  A511 廠內製令單/A512 委外製令單/A521 廠內重工單/A522 委外領料單
    ROW_NUMBER() OVER(order by INVMB.MB001) AS MOCTA_ID,
	(MOCTA.TA026+'-'+MOCTA.TA027+'-'+MOCTA.TA028) AS TA026_TA027_TA028,--訂單項
	(MOCTA.TA001+'-'+MOCTA.TA002)AS TA001_TA002,--製令單
	MOCTA.TA006, --產品品號
	MOCTA.TA029,--生館備註
	MOCTA.TA050,--訂單生產加工包裝資訊(客戶資訊)
	INVMAB.MA003,--產品機型
	MOCTB.TB015, --預計領料日
	MOCTA.TA009, --預計開工日
	MOCTA.TA010, --預計完工日
	MOCTA.TA011,--確認結單?1.未生產,2.已發料,3.生產中,Y.已完工,y.指定完工
	MOCTB.TB004,--需領用
	MOCTB.TB005,--已領用
	(MOCTB.TB004 - MOCTB.TB005) AS TB004_TB005, --需領用-已領用(正數 預計領 / 負數已領用量)
	
	INVMB.MB001, --品號
	INVMB.MB002, --品名
	INVMB.MB003, --規格
	INVMB.MB017, --倉別代號
	INVMB.MB032, --供應商代號
	INVMB.MB036, --固定前置天數
	INVMB.MB039, --最低補量
	INVMB.MB040, --補貨倍量
	COALESCE(CMSMC.MC002,'') AS MC002, --倉別名稱
	COALESCE(PURMA.MA002,'') AS MA002, --供應商名稱
	'製令類' AS TK000,
	MOCTB.CREATE_DATE,--建立單據時間
	MOCTB.MODI_DATE,--修改單據時間
	MOCTB.CREATOR--建立單據者
FROM 
	[DTR_TW].[dbo].MOCTA AS MOCTA --製令單頭
	LEFT JOIN 
	[DTR_TW].[dbo].MOCTB AS MOCTB --製令單身
	ON (MOCTA.TA001 + MOCTA.TA002) = (MOCTB.TB001 + MOCTB.TB002)
	LEFT JOIN 
	(SELECT  *
		FROM (SELECT
		  MA.MA003,
		  MB.MB008,
		  MB.MB001
		FROM [DTR_TW].[dbo].INVMB AS MB 
		LEFT JOIN [DTR_TW].[dbo].INVMA AS MA 
		  ON MB.MB008 = MA.MA002 
		WHERE MA.MA003 IS NOT NULL) AS INVMAB)AS INVMAB  --成品皆關聯(品號基本資料檔)
	ON INVMAB.MB001 = MOCTA.TA006 
	LEFT JOIN 
	[DTR_TW].[dbo].INVMB AS INVMB --倉庫別
	ON MOCTB.TB003 = INVMB.MB001 
	LEFT JOIN 
	[DTR_TW].[dbo].CMSMC AS CMSMC --基本資料
	ON INVMB.MB017 = CMSMC.MC001 
	LEFT JOIN 
	[DTR_TW].[dbo].PURMA AS PURMA --廠商
	ON PURMA.MA001 = INVMB.MB032 
WHERE 
	MOCTB.TB018 = 'Y' --確認碼
	AND (TA011 = '1' OR TA011 = '2' OR TA011 = '3') 
	AND (MOCTA.TA001='A511' OR MOCTA.TA001='A512' OR MOCTA.TA001='A521' OR MOCTA.TA001='A522')
	AND (MOCTB.CREATE_DATE >= CONVERT(VARCHAR(8), GETDATE()-30, 112) 
	OR MOCTB.MODI_DATE = CONVERT(VARCHAR(8), GETDATE(), 112))
	--AND (MOCTA.TA001+'-'+MOCTA.TA002) = 'A521-231218001'
ORDER BY 
	MOCTA.TA001+MOCTA.TA002 ASC, --工單號
	INVMB.MB001 ASC,--物料
	MOCTA.TA009 ASC --時間


SELECT --OK 進貨單 A341 國內進貨單/ A342 國外進貨單/ A343 台北進貨單/ A345 無採購進貨單
	ROW_NUMBER() OVER(order by PURTH.TH001) AS PURTH_ID,
	(PURTH.TH011+'-'+PURTH.TH012+'-'+PURTH.TH013) AS TH011_TH012_TH013,--採購單
	(PURTH.TH001+'-'+PURTH.TH002) AS TH001_TH002,--進貨單
	PURTH.TH003,--進貨單序號
	CEILING(PURTH.TH007) AS TH007, --數量
	PURTH.TH009, --庫別
	PURTH.TH014, --驗收時間
	PURTH.TH028, --檢驗狀態0.免檢,1.待驗,2.合格,3.不良,4.特採
	PURTH.TH030, --簽核確認碼 Y/N/V
	PURTH.TH050, --簽核狀態:0.待處理,1.簽核中,2.退件,3.已核准,4.取消確認中,5.作廢中,6.取消作廢中,N.不執行電子簽核[DEF:N]
	
	INVMB.MB001, --品號
	INVMB.MB002, --品名
	INVMB.MB003, --規格
	INVMB.MB017, --主要-倉別代號
	INVMB.MB032, --供應商代號
	INVMB.MB036, --固定前置天數
	INVMB.MB039, --最低補量
	INVMB.MB040, --補貨倍量
	CMSMC.MC002, --主要-倉別名稱
	COALESCE(PURMA.MA002,'') AS MA002, --供應商名稱
	'入料類'  AS TK000,
	PURTH.CREATE_DATE,--建立單據時間
	PURTH.MODI_DATE,--修改單據時間
	PURTH.CREATOR--建立單據者
FROM 
	[DTR_TW].[dbo].PURTH AS PURTH --進貨單身
	LEFT JOIN 
	[DTR_TW].[dbo].INVMB AS INVMB --倉庫別
	ON PURTH.TH004 = INVMB.MB001 
	LEFT JOIN 
	[DTR_TW].[dbo].CMSMC AS CMSMC --基本資料
	ON INVMB.MB017 = CMSMC.MC001 
	LEFT JOIN 
	[DTR_TW].[dbo].PURMA AS PURMA --廠商
	ON PURMA.MA001 = INVMB.MB032 
WHERE 
	PURTH.TH028 != '3' 
	AND (PURTH.TH030 LIKE 'N' OR PURTH.TH030 LIKE 'Y' )
	AND PURTH.TH007 > 0 
	AND (PURTH.TH001 ='A341' OR PURTH.TH001 ='A342' OR PURTH.TH001 ='A343' OR PURTH.TH001 ='A345' )
	AND (PURTH.CREATE_DATE >= CONVERT(VARCHAR(8), GETDATE()-30, 112) 
	OR PURTH.MODI_DATE = CONVERT(VARCHAR(8), GETDATE(), 112))
ORDER BY 
	INVMB.MB001 ASC,--物料
	PURTH.TH014 ASC, --時間
	PURTH.TH001+'-'+PURTH.TH002+PURTH.TH003 ASC --進貨單號




SELECT --OK 領/退料單 A541 廠內領料單/ A542 補料單/A543 超領單/ A551 委外領料單/ A561 廠內退料單/ A571 委外退料單
	ROW_NUMBER() OVER(order by MOCTE.TE001) AS MOCTE_ID,
	MOCTE.TE001+'-'+TRIM(MOCTE.TE002)+'-'+MOCTE.TE003 AS TE001_TE002_TE003,--出料單號
	(MOCTA.TA001+'-'+MOCTA.TA002) AS TA001_TA002,--製令單
	MOCTA.TA006,--產品品號
	MOCTA.TA009,--預計開工
	MOCTA.TA010, --預計完工日
	MOCTA.TA015,--產品套數
	MOCTA.TA021,--生產產線別
	MOCTA.TA034,--產品品名
	MOCTA.TA035,--產品規格
	MOCTC.TC007,--領單頭備註
	CEILING(MOCTB.TB004-MOCTB.TB005) AS TB004,--需領用
	CEILING(MOCTE.TE005) AS TE005,--(退料用),--物料領退用量
	MOCTB.TB005,--已領用
	MOCTE.TE008 AS TB009,--庫別
	MOCTC.TC008,--單據性質別54.廠內領料,55.託外領料,56.廠內退料,57.託外退料
	MOCTC.TC016,--簽核狀態碼0.待處理,1.簽核中,2.退件,3.已核准,4.取消確認中,5.作廢中,6.取消作廢中,N.不執行電子簽核[DEF:N]傳送次數[DEF:0]
	MOCTE.TE013,--領料說明(可領用量)
	MOCTE.TE014,--備註(來料時間 or 匹配進貨單)
	MOCTE.TE019,--簽核確認碼 Y/N/V

	INVMB.MB001, --品號
	INVMB.MB002, --品名
	INVMB.MB003, --規格
	INVMB.MB017, --主要-倉別代號
	INVMB.MB032, --供應商代號
	INVMB.MB036, --固定前置天數
	INVMB.MB039, --最低補量
	INVMB.MB040, --補貨倍量
	CMSMC.MC002, --主要-倉別名稱
	COALESCE(PURMA.MA002,'') AS MA002, --供應商名稱
	'入料類'  AS TK000,
	MOCTE.CREATE_DATE,--建立單據時間
	MOCTE.MODI_DATE,--修改單據時間
	MOCTE.CREATOR--建立單據者
FROM 
	[DTR_TW].[dbo].MOCTE AS MOCTE
	LEFT JOIN 
	[DTR_TW].[dbo].MOCTB AS MOCTB --製令單身
	ON (MOCTE.TE011+'_'+TRIM(MOCTE.TE012)+'_'+MOCTE.TE004) = (MOCTB.TB001+'_'+TRIM(MOCTB.TB002)+'_'+MOCTB.TB003)
	LEFT JOIN 
	[DTR_TW].[dbo].MOCTA AS MOCTA --製令單頭
	ON (MOCTB.TB001+'-'+TRIM(MOCTB.TB002)) =(MOCTA.TA001+'-'+MOCTA.TA002) 
	LEFT JOIN 
	[DTR_TW].[dbo].MOCTC AS MOCTC --製令單別
	ON (MOCTC.TC001+'-'+TRIM(MOCTC.TC002)) =(MOCTE.TE001+'-'+TRIM(MOCTE.TE002)) 
	LEFT JOIN 
	[DTR_TW].[dbo].INVMB AS INVMB --倉庫別
	ON MOCTE.TE004 = INVMB.MB001 
	LEFT JOIN 
	[DTR_TW].[dbo].CMSMC AS CMSMC --基本資料
	ON INVMB.MB017 = CMSMC.MC001 
	LEFT JOIN 
	[DTR_TW].[dbo].PURMA AS PURMA --廠商
	ON PURMA.MA001 = INVMB.MB032 
WHERE
	(MOCTE.CREATE_DATE >= CONVERT(VARCHAR(8), GETDATE()-30, 112) 
	OR MOCTE.MODI_DATE = CONVERT(VARCHAR(8), GETDATE(), 112))
	AND (MOCTB.TB004-MOCTB.TB005 > 0 
	AND (MOCTE.TE001 = 'A541' OR MOCTE.TE001 = 'A542' OR MOCTE.TE001 = 'A543' OR MOCTE.TE001 = 'A551' OR MOCTE.TE001 = 'A561' OR  MOCTE.TE001 = 'A571')
	OR (MOCTE.TE005 >0 AND (MOCTE.TE001 = 'A543' OR MOCTE.TE001 = 'A561' OR MOCTE.TE001 = 'A571')))	
	--AND TE001+'-'+TRIM(TE002) = 'A541-240507024'
ORDER BY
	MOCTC.TC008 asc,
	(MOCTE.TE001 + MOCTE.TE002+MOCTE.TE003) asc


SELECT	--OK 生產入庫 A581
	ROW_NUMBER() OVER(order by MOCTF.TF001) AS MOCTF_ID,
	(MOCTG.TG001+ '-' + TRIM(MOCTG.TG002) +'-'+ MOCTG.TG003) AS TG001_TG002_TG003,--入庫單
	MOCTG.TG014+'-'+MOCTG.TG015 AS TG014_TG015,--製令單
	MOCTG.TG010,-- 入庫別
	MOCTG.TG011, --入庫數量
	MOCTG.TG016, --入庫代驗(1.待驗,Y.檢驗合格,N.檢驗不合格,0.免檢)
	MOCTG.TG020, --備註
	MOCTG.TG022,--簽核確認碼 Y/N/V
	MOCTF.TF014,--簽核狀態碼0.待處理,1.簽核中,2.退件,3.已核准,4.取消確認中,5.作廢中,6.取消作廢中,N.不執行電子簽核[DEF:N]傳送次數[DEF:0]
	MOCTF.TF003, --入庫時間
	MOCTF.TF005,--單頭備註

	INVMB.MB001, --品號
	INVMB.MB002, --品名
	INVMB.MB003, --規格
	INVMB.MB017, --主要-倉別代號
	INVMB.MB032, --供應商代號
	INVMB.MB036, --固定前置天數
	INVMB.MB039, --最低補量
	INVMB.MB040, --補貨倍量
	CMSMC.MC002, --主要-倉別名稱
	COALESCE(PURMA.MA002,'') AS MA002, --供應商名稱
	'入料類'  AS TK000,
	MOCTF.CREATE_DATE,--建立單據時間
	MOCTF.MODI_DATE,--修改單據時間
	MOCTF.CREATOR--建立單據者
FROM 
	[DTR_TW].[dbo].MOCTF--入庫單頭
	LEFT JOIN 
	[DTR_TW].[dbo].MOCTG AS MOCTG --入庫單身
	ON (MOCTF.TF001+'-'+TRIM(MOCTF.TF002)) =(MOCTG.TG001+'-'+TRIM(MOCTG.TG002)) 
	LEFT JOIN 
	[DTR_TW].[dbo].INVMB AS INVMB --倉庫別
	ON MOCTG.TG004 = INVMB.MB001 
	LEFT JOIN 
	[DTR_TW].[dbo].CMSMC AS CMSMC --基本資料
	ON INVMB.MB017 = CMSMC.MC001 
	LEFT JOIN 
	[DTR_TW].[dbo].PURMA AS PURMA --廠商
	ON PURMA.MA001 = INVMB.MB032 
WHERE 
	MOCTF.TF014 ='3' OR MOCTF.TF014 ='N' 
	AND MOCTG.TG011 >0
	AND (MOCTG.CREATE_DATE >= CONVERT(VARCHAR(8), GETDATE()-30, 112) 
	OR MOCTG.MODI_DATE = CONVERT(VARCHAR(8), GETDATE(), 112))
ORDER BY
	(MOCTG.TG001+ '-' + TRIM(MOCTG.TG002) +'-'+ MOCTG.TG003)  ASC


SELECT	-- OK 委外進貨 A591
	ROW_NUMBER() OVER(order by MOCTI.TI001) AS MOCTH_ID,
	(MOCTI.TI001+'-'+TRIM(MOCTI.TI002)+'-'+MOCTI.TI003) AS TI001_TI002_TI003,--委外進貨單
	(MOCTI.TI013+'-'+TRIM(MOCTI.TI014)) AS TI013_TI014,--製令單
	MOCTI.TI007,--進貨數量
	MOCTI.TI009,--進貨庫別
	MOCTI.TI035,--1.待驗,Y(2).檢驗合格,N(3).檢驗不合格,0.免檢
	MOCTI.TI037,--確認碼 Y/N/V
	MOCTI.TI048, --簽核狀態碼0.待處理,1.簽核中,2.退件,3.已核准,4.取消確認中,5.作廢中,6.取消作廢中,N.不執行電子簽核[DEF:N]
	MOCTH.TH005,--加工廠商之代號

	INVMB.MB001, --品號
	INVMB.MB002, --品名
	INVMB.MB003, --規格
	INVMB.MB017, --主要-倉別代號
	INVMB.MB032, --供應商代號
	INVMB.MB036, --固定前置天數
	INVMB.MB039, --最低補量
	INVMB.MB040, --補貨倍量
	CMSMC.MC002, --主要-倉別名稱
	COALESCE(PURMA.MA002,'') AS MA002, --供應商名稱
	'入料類'  AS TK000,
	MOCTI.CREATE_DATE,--建立單據時間
	MOCTI.MODI_DATE,--修改單據時間
	MOCTI.CREATOR--建立單據者

FROM
	[DTR_TW].[dbo].MOCTH
	LEFT JOIN 
	[DTR_TW].[dbo].MOCTI AS MOCTI --委外單身
	ON (MOCTH.TH001+'-'+TRIM(MOCTH.TH002)) =(MOCTI.TI001+'-'+TRIM(MOCTI.TI002)) 
	LEFT JOIN 
	[DTR_TW].[dbo].INVMB AS INVMB --倉庫別
	ON MOCTI.TI004 = INVMB.MB001 
	LEFT JOIN 
	[DTR_TW].[dbo].CMSMC AS CMSMC --基本資料
	ON INVMB.MB017 = CMSMC.MC001 
	LEFT JOIN 
	[DTR_TW].[dbo].PURMA AS PURMA --廠商
	ON PURMA.MA001 = INVMB.MB032 
WHERE
	MOCTI.TI001 is not null
	AND MOCTI.TI007 > 0
	AND (MOCTI.TI048 ='N' OR MOCTI.TI048='3')
	AND (MOCTI.TI001='A591')
	AND (MOCTI.CREATE_DATE >= CONVERT(VARCHAR(8), GETDATE()-30, 112) 
	OR MOCTI.MODI_DATE = CONVERT(VARCHAR(8), GETDATE(), 112))
ORDER BY
	(MOCTI.TI001+'-'+TRIM(MOCTI.TI002)+'-'+MOCTI.TI003)   ASC




SELECT	--OK 借出 A131+借入單A141
	ROW_NUMBER() OVER(order by INVTG.TG001) AS INVTG_ID,
	(INVTG.TG001+'-'+TRIM(INVTG.TG002)+'-'+INVTG.TG003) AS TG001_TG002_TG003,---借出單
	INVTF.TF015,--借出對象
	INVTG.TG007,--轉出庫別
	INVTG.TG008,--轉入庫別
	INVTG.TG009,--數量
	INVTG.TG022,--確認碼Y:已確認,N:未確認,U:確認失敗,V:作廢
	INVTF.TF028,--簽核狀態碼0.待處理,1.簽核中,2.退件,3.已核准,4.取消確認中,5.作廢中,6.取消作廢中,N.不執行電子簽核[DEF:N]
	
	INVMB.MB001, --品號
	INVMB.MB002, --品名
	INVMB.MB003, --規格
	INVMB.MB017, --主要-倉別代號
	INVMB.MB032, --供應商代號
	INVMB.MB036, --固定前置天數
	INVMB.MB039, --最低補量
	INVMB.MB040, --補貨倍量
	CMSMC.MC002, --主要-倉別名稱
	COALESCE(PURMA.MA002,'') AS MA002, --供應商名稱
	'領料類'  AS TK000,
	INVTG.CREATE_DATE,--建立單據時間
	INVTG.MODI_DATE,--修改單據時間
	INVTG.CREATOR--建立單據者
FROM 
	[DTR_TW].[dbo].INVTF
	LEFT JOIN 
	[DTR_TW].[dbo].INVTG AS INVTG ---借出單身
	ON (INVTG.TG001+'-'+TRIM(INVTG.TG002)) =(INVTF.TF001+'-'+TRIM(INVTF.TF002))
	LEFT JOIN 
	[DTR_TW].[dbo].INVMB AS INVMB --倉庫別
	ON INVTG.TG004 = INVMB.MB001 
	LEFT JOIN 
	[DTR_TW].[dbo].CMSMC AS CMSMC --基本資料
	ON INVMB.MB017 = CMSMC.MC001 
	LEFT JOIN 
	[DTR_TW].[dbo].PURMA AS PURMA --廠商
	ON PURMA.MA001 = INVMB.MB032 
WHERE
	INVTG.TG022!='V'
	AND INVTG.TG001 is not null
	AND INVTG.TG009 > 0
	AND ((INVTG.TG001='A131' AND INVTG.TG022='Y') OR INVTG.TG001='A141')
	AND (INVTG.CREATE_DATE >= CONVERT(VARCHAR(8), GETDATE()-30, 112) 
	OR INVTG.MODI_DATE = CONVERT(VARCHAR(8), GETDATE(), 112))
ORDER BY
	(INVTG.TG001+'-'+TRIM(INVTG.TG002)+'-'+INVTG.TG003)  ASC





SELECT	--OK 借出歸還A151+借入歸還單A161
	ROW_NUMBER() OVER(order by INVTI.TI001) AS INVTH_ID,
	(INVTI.TI001+'-'+TRIM(INVTI.TI002)+'-'+INVTI.TI003) AS TI001_TI002_TI003,---借出歸還單
	(INVTI.TI014+'-'+TRIM(INVTI.TI015)+'-'+INVTI.TI016) AS TI014_TI015_TI016,--來源
	INVTI.TI009, --數量
	INVTI.TI022,--確認碼Y:已確認,N:未確認,U:確認失敗,V:作廢
	INVTI.TI007,--轉出庫別
	INVTI.TI008,--轉入庫別
	INVTH.TH006,--對象
	INVTH.TH027,--0.待處理,1.簽核中,2.退件,3.已核准,4.取消確認中,5.作廢中,6.取消作廢中,N.不執行電子簽核[DEF:N]
	INVMB.MB001, --品號
	INVMB.MB002, --品名
	INVMB.MB003, --規格
	INVMB.MB017, --主要-倉別代號
	INVMB.MB032, --供應商代號
	INVMB.MB036, --固定前置天數
	INVMB.MB039, --最低補量
	INVMB.MB040, --補貨倍量
	CMSMC.MC002, --主要-倉別名稱
	COALESCE(PURMA.MA002,'') AS MA002, --供應商名稱
	'領料類'  AS TK000,
	INVTI.CREATE_DATE,--建立單據時間
	INVTI.MODI_DATE,--修改單據時間
	INVTI.CREATOR--建立單據者
FROM 
	[DTR_TW].[dbo].INVTH
	LEFT JOIN 
	[DTR_TW].[dbo].INVTI AS INVTI ---歸還單身
	ON (INVTH.TH001+'-'+TRIM(INVTH.TH002)) =(INVTI.TI001+'-'+TRIM(INVTI.TI002))
	LEFT JOIN 
	[DTR_TW].[dbo].INVMB AS INVMB --倉庫別
	ON INVTI.TI004 = INVMB.MB001 
	LEFT JOIN 
	[DTR_TW].[dbo].CMSMC AS CMSMC --基本資料
	ON INVMB.MB017 = CMSMC.MC001 
	LEFT JOIN 
	[DTR_TW].[dbo].PURMA AS PURMA --廠商
	ON PURMA.MA001 = INVMB.MB032 
WHERE
	INVTI.TI001 is not null
	AND INVTI.TI009 > 0
	AND (INVTI.TI001='A151' OR INVTI.TI001='A161')
	AND (INVTI.CREATE_DATE >= CONVERT(VARCHAR(8), GETDATE()-30, 112) 
	OR INVTI.MODI_DATE = CONVERT(VARCHAR(8), GETDATE(), 112))
ORDER BY
	(INVTI.TI001+'-'+TRIM(INVTI.TI002)+'-'+INVTI.TI003)  ASC



SELECT --OK 調撥/費用/A111-A112-A115-A119-A121
	ROW_NUMBER() OVER(order by INVTA.TA001) AS INVTA_ID,
	(INVTB.TB001+'-'+TRIM(INVTB.TB002)+'-'+INVTB.TB003) as TB001_TB002_TB003,--單號
	INVTB.TB007,--數量
	INVTB.TB012,--出庫
	INVTB.TB013,--入庫
	INVTB.TB018,--確認碼 Y/N/V
	INVTA.TA005,--備註
	INVTA.TA016,--簽核碼0.待處理,1.簽核中,2.退件,3.已核准,4.取消確認中,5.作廢中,6.取消作廢中,N.不執行電子簽核[DEF:N]
	INVMB.MB001, --品號
	INVMB.MB002, --品名
	INVMB.MB003, --規格
	INVMB.MB017, --主要-倉別代號
	INVMB.MB032, --供應商代號
	INVMB.MB036, --固定前置天數
	INVMB.MB039, --最低補量
	INVMB.MB040, --補貨倍量
	CMSMC.MC002, --主要-倉別名稱
	COALESCE(PURMA.MA002,'') AS MA002, --供應商名稱
	'領料類'  AS TK000 ,
	INVTB.CREATE_DATE,--建立單據時間
	INVTB.MODI_DATE,--修改單據時間
	INVTB.CREATOR--建立單據者
FROM 
	[DTR_TW].[dbo].INVTA
	LEFT JOIN 
	[DTR_TW].[dbo].INVTB AS INVTB ---異動單據單身檔
	ON (INVTA.TA001+'-'+TRIM(INVTA.TA002)) =(INVTB.TB001+'-'+TRIM(INVTB.TB002))
	LEFT JOIN 
	[DTR_TW].[dbo].INVMB AS INVMB --倉庫別
	ON INVTB.TB004 = INVMB.MB001 
	LEFT JOIN 
	[DTR_TW].[dbo].CMSMC AS CMSMC --基本資料
	ON INVMB.MB017 = CMSMC.MC001 
	LEFT JOIN 
	[DTR_TW].[dbo].PURMA AS PURMA --廠商
	ON PURMA.MA001 = INVMB.MB032 
WHERE
	INVTB.TB001 is not null
	AND INVTB.TB007 != 0
	AND ((INVTB.TB001 ='A111' AND INVTB.TB018='Y') 
	OR (INVTB.TB001 ='A112'AND INVTB.TB018='Y') 
	OR (INVTB.TB001 ='A115'AND INVTB.TB018='N') 
	OR (INVTB.TB001 ='A119' AND INVTB.TB018='Y') 
	OR ((INVTB.TB001 ='A121'AND INVTB.TB018='Y') OR (INVTB.TB001 ='A121'AND INVTB.TB018='Y')))
	AND (INVTB.CREATE_DATE >= CONVERT(VARCHAR(8), GETDATE()-30, 112) 
	OR INVTB.MODI_DATE = CONVERT(VARCHAR(8), GETDATE(), 112))
ORDER BY
	(INVTB.TB001+'-'+TRIM(INVTB.TB002)+'-'+INVTB.TB003)  ASC

	
SELECT --OK 組合單/A421
	ROW_NUMBER() OVER(order by BOMTD.TD001) AS BOMTD_ID,
	(BOMTE.TE001+'-'+TRIM(BOMTE.TE002)+'-'+BOMTE.TE003) as TE001_TE002_TE003,--單號
	BOMTE.TE004,--(-)元件號
	BOMTE.TE007,--(-)出庫
	BOMTE.TE008,--(-)元件數量
	BOMTE.TE010,--(-)確認碼 Y/N/V
	BOMTD.TD004,--(+)成品號
	BOMTD.TD007,--(+)成品數量
	BOMTD.TD010,--(+)入庫
	BOMTD.TD016,--(+)簽核碼0.待處理,1.簽核中,2.退件,3.已核准,4.取消確認中,5.作廢中,6.取消作廢中,N.不執行電子簽核[DEF:N]
	
	INVMB.MB001, --品號
	INVMB.MB002, --品名
	INVMB.MB003, --規格
	INVMB.MB017, --主要-倉別代號
	INVMB.MB032, --供應商代號
	INVMB.MB036, --固定前置天數
	INVMB.MB039, --最低補量
	INVMB.MB040, --補貨倍量
	CMSMC.MC002, --主要-倉別名稱
	COALESCE(PURMA.MA002,'') AS MA002, --供應商名稱
	'領料類'  AS TK000,
	BOMTE.CREATE_DATE,--建立單據時間
	BOMTE.MODI_DATE,--修改單據時間
	BOMTE.CREATOR--建立單據者
FROM 
	[DTR_TW].[dbo].BOMTD
	LEFT JOIN 
	[DTR_TW].[dbo].BOMTE AS BOMTE ---組合單據單身檔
	ON (BOMTD.TD001+'-'+TRIM(BOMTD.TD002)) =(BOMTE.TE001+'-'+TRIM(BOMTE.TE002))
	LEFT JOIN 
	[DTR_TW].[dbo].INVMB AS INVMB --(+)倉庫別
	ON BOMTD.TD004 = INVMB.MB001 
	LEFT JOIN 
	[DTR_TW].[dbo].CMSMC AS CMSMC --基本資料
	ON INVMB.MB017 = CMSMC.MC001 
	LEFT JOIN 
	[DTR_TW].[dbo].PURMA AS PURMA --廠商
	ON PURMA.MA001 = INVMB.MB032 
WHERE
	BOMTE.TE001 is not null
	AND BOMTE.TE008 > 0
	AND BOMTE.TE001='A421' 
	AND (BOMTE.CREATE_DATE >= CONVERT(VARCHAR(8), GETDATE()-30, 112) 
	OR BOMTE.MODI_DATE = CONVERT(VARCHAR(8), GETDATE(), 112))
ORDER BY
	(BOMTE.TE001+'-'+TRIM(BOMTE.TE002)+'-'+BOMTE.TE003)  ASC

		
SELECT --OK 拆解單/A431
	ROW_NUMBER() OVER(order by BOMTF.TF001) AS BOMTF_ID,
	(BOMTG.TG001+'-'+TRIM(BOMTG.TG002)+'-'+BOMTG.TG003) as TG001_TG002_TG003,--單號
	BOMTF.TF004,--(-)成品號
	BOMTF.TF007,--(-)成品數量
	BOMTF.TF008,--(-)出庫
	BOMTF.TF014,--(-)簽核碼0.待處理,1.簽核中,2.退件,3.已核准,4.取消確認中,5.作廢中,6.取消作廢中,N.不執行電子簽核[DEF:N]
	BOMTG.TG004,--(+)元件號
	BOMTG.TG007,--(+)入庫
	BOMTG.TG008,--(+)元件數量
	BOMTG.TG010,--(+)確認碼 Y/N/V
	INVMB.MB001, --品號
	INVMB.MB002, --品名
	INVMB.MB003, --規格
	INVMB.MB017, --主要-倉別代號
	INVMB.MB032, --供應商代號
	INVMB.MB036, --固定前置天數
	INVMB.MB039, --最低補量
	INVMB.MB040, --補貨倍量
	CMSMC.MC002, --主要-倉別名稱
	COALESCE(PURMA.MA002,'') AS MA002, --供應商名稱
	'領料類'  AS TK000,
	BOMTG.CREATE_DATE,--建立單據時間
	BOMTG.MODI_DATE,--修改單據時間
	BOMTG.CREATOR--建立單據者
FROM 
	[DTR_TW].[dbo].BOMTF
	LEFT JOIN 
	[DTR_TW].[dbo].BOMTG AS BOMTG ---組合單據單身檔
	ON (BOMTF.TF001+'-'+TRIM(BOMTF.TF002)) =(BOMTG.TG001+'-'+TRIM(BOMTG.TG002))
	LEFT JOIN 
	[DTR_TW].[dbo].INVMB AS INVMB --(+)倉庫別
	ON BOMTG.TG004 = INVMB.MB001 
	LEFT JOIN 
	[DTR_TW].[dbo].CMSMC AS CMSMC --基本資料
	ON INVMB.MB017 = CMSMC.MC001 
	LEFT JOIN 
	[DTR_TW].[dbo].PURMA AS PURMA --廠商
	ON PURMA.MA001 = INVMB.MB032 
WHERE
	BOMTG.TG001 is not null
	AND BOMTG.TG008 > 0
	AND BOMTG.TG001 = 'A431'
	AND (BOMTG.CREATE_DATE >= CONVERT(VARCHAR(8), GETDATE()-30, 112) 
	OR BOMTG.MODI_DATE = CONVERT(VARCHAR(8), GETDATE(), 112))
ORDER BY
	(BOMTG.TG001+'-'+TRIM(BOMTG.TG002)+'-'+BOMTG.TG003)  ASC


SELECT	--倉儲
	ROW_NUMBER() OVER(order by INVMB.MB001) AS INVTB_ID,
	INVMB.MB001, --品號
	INVMB.MB002, --品名
	INVMB.MB003, --規格

	INVMC.MC002, --倉別代號
	CMSMC.MC002 AS CMC002, --倉別名稱
	INVMC.MC003, --儲位位置
	FLOOR(INVMC.MC007) AS MC007, --儲位數量
	INVMB.MB017, --主要-倉別代號
	INVMB.MB032, --主要-供應商代號
	INVMB.MB036, --主要-固定前置天數
	INVMB.MB039, --主要-最低補量
	INVMB.MB040, --主要-補貨倍量
	COALESCE(PURMA.MA002,'') AS MA002 --供應商名稱
FROM 
	[DTR_TW].[dbo].INVMB  --倉庫別
	LEFT JOIN 
	[DTR_TW].[dbo].INVMC AS INVMC --品號庫別檔
	ON INVMB.MB001 = INVMC.MC001 
	LEFT JOIN 
	[DTR_TW].[dbo].CMSMC AS CMSMC --基本資料
	ON INVMC.MC002 = CMSMC.MC001 
	LEFT JOIN 
	[DTR_TW].[dbo].PURMA AS PURMA --廠商
	ON PURMA.MA001 = INVMB.MB032 
--WHERE
	--INVMC.MC007 is not null
	-- (INVMC.MC007 <1 AND INVMC.MC007 >0)
	--INVMB.MB001 ='90-209-W110000'

ORDER BY
	INVMB.MB001 ASC,
	INVMC.MC002 ASC,
	INVMC.MC003 ASC


SELECT	--OK 銷貨單單 A231/A232
	ROW_NUMBER() OVER(order by COPTH.TH001) AS COPTH_ID,
	(COPTH.TH001+ '-' + TRIM(COPTH.TH002) +'-'+ COPTH.TH003) AS TH001_TH002_TH003,--銷貨單
	COPTH.TH007,-- 出庫別
	COPTH.TH008, --出庫數量
	COPTH.TH018, --備註
	COPTH.TH020,--簽核確認碼 Y/N/V
	COPTG.TG047,--簽核狀態碼0.待處理,1.簽核中,2.退件,3.已核准,4.取消確認中,5.作廢中,6.取消作廢中,N.不執行電子簽核[DEF:N]傳送次數[DEF:0]
	COPTG.TG042, --單據日期時間
	COPTG.TG020,--單頭備註
	COPTG.TG007,--客戶對象

	INVMB.MB001, --品號
	INVMB.MB002, --品名
	INVMB.MB003, --規格
	INVMB.MB017, --主要-倉別代號
	INVMB.MB032, --供應商代號
	INVMB.MB036, --固定前置天數
	INVMB.MB039, --最低補量
	INVMB.MB040, --補貨倍量
	CMSMC.MC002, --主要-倉別名稱
	COALESCE(PURMA.MA002,'') AS MA002, --供應商名稱
	'領料類'  AS TK000,
	COPTG.CREATE_DATE,--建立單據時間
	COPTG.MODI_DATE,--修改單據時間
	COPTG.CREATOR --建立單據者
FROM 
	[DTR_TW].[dbo].COPTG--銷貨單頭
	LEFT JOIN 
	[DTR_TW].[dbo].COPTH AS COPTH --銷貨單身
	ON (COPTG.TG001+'-'+TRIM(COPTG.TG002)) =(COPTH.TH001+'-'+TRIM(COPTH.TH002)) 
	LEFT JOIN 
	[DTR_TW].[dbo].INVMB AS INVMB --倉庫別
	ON COPTH.TH004 = INVMB.MB001 
	LEFT JOIN 
	[DTR_TW].[dbo].CMSMC AS CMSMC --基本資料
	ON INVMB.MB017 = CMSMC.MC001 
	LEFT JOIN 
	[DTR_TW].[dbo].PURMA AS PURMA --廠商
	ON PURMA.MA001 = INVMB.MB032 
WHERE 
	COPTH.TH008 > 0
	AND (COPTH.TH001='A231' OR COPTH.TH001='A232')  
	AND (COPTH.CREATE_DATE >= CONVERT(VARCHAR(8), GETDATE()-30, 112) 
	OR COPTH.MODI_DATE = CONVERT(VARCHAR(8), GETDATE(), 112))
ORDER BY
	(COPTH.TH001+ '-' + TRIM(COPTH.TH002) +'-'+ COPTH.TH003)  ASC

	

